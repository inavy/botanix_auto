import"./chunk-O2YW3UOK.js";import{a as vt}from"./chunk-X7WJST25.js";import{a as Lt}from"./chunk-Q35A52ZT.js";import{b as St,n as Ct}from"./chunk-YC3K6KSF.js";import"./chunk-5VYKPDIW.js";import{a as gt}from"./chunk-T4SJQSS7.js";import"./chunk-XWRXEU7I.js";import"./chunk-3V4N3SLP.js";import"./chunk-CHH4UZQE.js";import"./chunk-JTVJ673F.js";import"./chunk-EC67JB7S.js";import"./chunk-WINPS5JO.js";import"./chunk-BNPYGBEA.js";import{a as It}from"./chunk-75JFJJ6E.js";import"./chunk-WOF2MG5G.js";import"./chunk-6QV7GAE5.js";import"./chunk-QT2MBFKK.js";import"./chunk-MUF5KFVU.js";import"./chunk-BSWNOA7X.js";import"./chunk-NWOIYLOG.js";import"./chunk-JLHU3WBU.js";import"./chunk-WPUSOCZ5.js";import"./chunk-6NFIXY6G.js";import"./chunk-IGLJY5RQ.js";import"./chunk-BOYKE4FM.js";import"./chunk-UF32D7MW.js";import"./chunk-CR7XMKUK.js";import"./chunk-SSZF4QIS.js";import"./chunk-M24SOKF4.js";import"./chunk-SSTSMCPU.js";import"./chunk-LF7H3MNC.js";import"./chunk-KCCATSGJ.js";import"./chunk-BQUWM53Y.js";import"./chunk-XEXJRJUY.js";import"./chunk-3DNJNRLL.js";import"./chunk-FPIWIEGC.js";import{a as ht,e as K}from"./chunk-3MOQA4IF.js";import"./chunk-2I7TRLZ4.js";import"./chunk-25SZ52UW.js";import"./chunk-3VDT32YX.js";import"./chunk-RNBNCNHM.js";import"./chunk-ZUBJ4HSQ.js";import"./chunk-NRDSUSOX.js";import"./chunk-OLBL2ESK.js";import"./chunk-WFHUBXJH.js";import"./chunk-YL2OEBEM.js";import"./chunk-UBREW6HU.js";import"./chunk-33LBA2KN.js";import"./chunk-NPTEYWCZ.js";import"./chunk-BYUE2OWP.js";import"./chunk-PCTAUYQN.js";import"./chunk-ZW25VTKR.js";import"./chunk-OZL64JKT.js";import"./chunk-SF4X4VPT.js";import"./chunk-EUVFIXQT.js";import"./chunk-WJQMDYRJ.js";import"./chunk-OANAR4PZ.js";import"./chunk-DY3DHSF2.js";import"./chunk-LZKLGZM5.js";import"./chunk-OVX2PTCV.js";import"./chunk-Y57SQLFF.js";import"./chunk-C6D3UGMF.js";import"./chunk-VHMLJAAA.js";import{i as bt,l as Tt,m as yt,s as At}from"./chunk-DS7KEGTF.js";import"./chunk-GWV4SS46.js";import"./chunk-YFSBCNC7.js";import"./chunk-OFUXQTAD.js";import"./chunk-AJGKE3VO.js";import"./chunk-NRCRSATA.js";import"./chunk-LANQTZFO.js";import"./chunk-NZHMCNZN.js";import"./chunk-CBDQQ72I.js";import{Qa as xt}from"./chunk-4HJMB7P7.js";import"./chunk-A2W6OJDL.js";import{m as wt}from"./chunk-U7RD3Z4E.js";import"./chunk-CJVER5MJ.js";import"./chunk-S5IEFQ34.js";import"./chunk-XHNZXPBB.js";import{K as pt}from"./chunk-ZTS7374H.js";import"./chunk-QXE433GW.js";import"./chunk-EY7FXYAJ.js";import{d as V,f as he}from"./chunk-B26CCOB3.js";import"./chunk-D2RJYC6D.js";import"./chunk-VMA4KAKW.js";import"./chunk-XJYCT5UP.js";import"./chunk-XIAMW27T.js";import{b as ft}from"./chunk-QYHQY2ME.js";import"./chunk-FT7VATMT.js";import{a as be}from"./chunk-YYAHGUV5.js";import"./chunk-QJGSL63Z.js";import"./chunk-7ZE3XWQE.js";import"./chunk-42AETIVN.js";import"./chunk-DKCCIZ3Q.js";import"./chunk-C77R5D6K.js";import{c as I}from"./chunk-HBMVMNWX.js";import{Fb as A,Gb as $,Lc as pe,Qc as _t,Tc as O,Vc as xe,Wc as E,X as J,Xa as me,Xc as we,cc as _e,xc as mt,ya as L}from"./chunk-IS2B3ORW.js";import"./chunk-YGSCKFAL.js";import{G as h,q as dt,w as z}from"./chunk-TDPA2BUG.js";import{m as X,pa as ce}from"./chunk-BJO2AFCW.js";import{M as ue,w as i}from"./chunk-OIAB2YVD.js";import{b as de}from"./chunk-QHMZGTYF.js";import"./chunk-X5EUMZZI.js";import"./chunk-PJSODKKF.js";import{U as ut,c as fe,ca as v}from"./chunk-VXVCGVBA.js";import"./chunk-G6JM4G2M.js";import{a as R}from"./chunk-DAL2TMJA.js";import"./chunk-IEDGM2AY.js";import"./chunk-DAX5D55P.js";import"./chunk-UAZMAR7J.js";import"./chunk-BQF3XODK.js";import"./chunk-I5RKKMWZ.js";import"./chunk-4LMFSJNF.js";import"./chunk-VNO3IDCT.js";import"./chunk-P5TEJB3G.js";import"./chunk-AXAVBTOG.js";import"./chunk-SEHRB2F7.js";import"./chunk-IH7OWVTK.js";import"./chunk-RF2WJL7B.js";import"./chunk-K5MXWGTT.js";import"./chunk-OTDALOBJ.js";import"./chunk-JCKY6H7C.js";import"./chunk-6AWMYHRK.js";import"./chunk-5VBNU5MN.js";import{f as y,m,n as w,o as _}from"./chunk-JEQEC2HU.js";m();_();var tt=y(R()),U=y(be());m();_();var W=y(R());m();_();var j=y(R());m();_();var Z={root:"_root_dowdc_1",header:"_header_dowdc_30"};function Te({children:p,hidden:N=!1}){return j.default.createElement(I.Box,{className:Z.root},j.default.createElement(Lt,{className:Z.header}),N?null:p)}var Et=Te;m();_();var e=y(R()),Pt=y(fe());ce();ue();de();he();pe();me();we();xe();_e();m();_();var c={root:"_root_1teux_1",title:"_title_1teux_46","fee-select":"_fee-select_1teux_52",feeSelect:"_fee-select_1teux_52",inner:"_inner_1teux_55","add-weight":"_add-weight_1teux_55",addWeight:"_add-weight_1teux_55","add-element-weight":"_add-element-weight_1teux_55",addElementWeight:"_add-element-weight_1teux_55",placeholder:"_placeholder_1teux_55",link:"_link_1teux_76",input:"_input_1teux_84","tip-txt":"_tip-txt_1teux_87",tipTxt:"_tip-txt_1teux_87",btn:"_btn_1teux_93"};var ye=50,Nt=600,Ae=546,Bt="inputLessThan546",kt="commonall_modal_btn_claim",Q="commonall_modal_btn_done",Ft="wallet_extension_fb_btn_retry",Ie="https://www.oklink.com/fractal-bitcoin/address/",ge=["wallet_extension_fb_desc_claim_all_utxo","wallet_extension_fb_desc_claim_delay","wallet_extension_fb_desc_claim_network_fee"],Mt=[{label:"wallet_extension_fb_select_network_fee_fast",value:"max"},{label:"wallet_extension_fb_select_network_fee_average",value:"normal"},{label:"wallet_extension_fb_select_network_fee_slow",value:"min"}];function Se(){let p=bt(),N=Tt(),et=At(),[g,Wt]=(0,e.useState)(Mt[0].value),[ot,Ut]=(0,e.useState)("0"),nt=yt(),B=(0,e.useMemo)(()=>(p?.addressType[J]||[]).map(o=>({label:o.address,value:o.address})),[p.walletId]),[b,rt]=(0,e.useState)(B[0]?.value||""),[S,x]=(0,e.useState)(!1);(0,e.useEffect)(()=>{let t=B[0]?.value;t&&(rt(t),x(!0))},[B]);let st=(0,e.useCallback)(t=>{let o=N(t),{share:n,pShare:r,mpcId:s,publicKey:a,deriveIndex:u}=o?.addressType?.bitcoin?.find(d=>d?.addressType===o?.selectedAddressType?.bitcoin)||{};return{publicKey:a,share:n,pShare:r,mpcId:s,deriveIndex:u}},[N]),Ht=(0,e.useCallback)(async(t,o)=>{let r=(await et(t))?.find(s=>s.address===o)?.privateKey;if(nt){let{getMidKey:s}=await ht(),{networks:a,private2Wif:u}=await K(),{share:d}=st(t),f=await s(Ct(d),0);return u(w.Buffer.from(f),a.bitcoin)}return r},[st,et,nt]),qt=(0,e.useCallback)(async(t,o)=>{let r=X(t,ye).map(s=>O(E.subscriptionFBRCMidAddr,s,{headers:o}));return Promise.all(r)},[]),[at,Dt]=(0,e.useState)([]),Yt=gt(),Gt=(0,e.useCallback)(async(t,o)=>{let{data:n}=await _t(E.getFBRCLossInscriptionInfo,{address:t},{headers:o});return n||[]},[]),Xt=(0,e.useCallback)(async(t,o,n)=>{let{networks:r,createInscriptionTxCtxData:s}=await K(),a=[];return t.forEach(u=>{let d={contentType:"text/plain;charset=utf-8",body:u.inscriptionJson,revealAddr:o},{commitTxAddress:f}=s(r.bitcoin,d,n);u.midAddress===f||(a.push(f),u.midAddress=f)}),a},[]),Jt=(0,e.useCallback)(async(t,o)=>{let n=t.map(({midAddress:d})=>({address:d,utxoType:St.TRANSFER})),r={coinId:L,utxoRequests:n},{data:s}=await O(E.getBTCUTXO,r,{headers:o});if(!s?.length)return[];let a=s.map((d,f)=>({...n[f],serviceCharge:0,coinAmount:d.canTransferAmount})),{data:u}=await O(E.getBTCUTXO,{coinId:L,utxoRequests:a},{headers:o});return u},[]),$t=(0,e.useCallback)(async({inscriptionInfoList:t,midAddrUtxoList:o,privateKey:n,selectedAddress:r,feeRate:s,walletId:a,serverWalletType:u})=>{let{networks:d,inscribeRefundFee:f}=await K(),l=0,k=[],q=0;for(let F=0;F<t.length;F++){let M=t[F],oe=o[F].utxoList.map(T=>({privateKey:n,txId:T.txHash,vOut:T.vout,amount:T.coinAmount,address:M.midAddress})),ne=[{contentType:"text/plain;charset=utf-8",body:M.inscriptionJson,revealAddr:r}],re={feeRate:s,inscriptionRefundFeeDataList:ne,changeAddress:r,middleAddress:M.midAddress,maxAmountOfInput:Nt},se=X(oe,Nt),D=0,Y=0;se.forEach(T=>{let ae={...re,inputs:T},P=0;T.forEach(le=>{P=A(P,le.amount)}),Y=A(Y,P);let{refundFeeTx:ie,refundFeeTxFee:G,dustChange:ct}=f(d.bitcoin,ae);if(ct&&ct<Ae)throw new Error(Bt);k.push({coinId:L,txType:ft.TRANS_IN,signedTx:ie,coinAmount:$(P,G),toAdr:r,fromAdr:M.midAddress,serviceCharge:G,accountId:a,walletType:u,txSource:mt.NORMAL}),D=A(D,G)}),l=A(l,Y),q=A(q,D)}return{claimAmount:$(l,q)||0,refundFeeTxList:k}},[]),zt=async(t,o)=>{let n=await Ht(p.walletId,t),r=await V().getRequestHeaders({walletId:p.walletId,needSign:!0,currency:"usd"}),s;try{s=(await Yt({coinId:L,address:t}))?.[o]}catch{return h.error({title:i("wallet_extension_fb_error_network_refresh"),duration:5}),{}}if(!n||!s)return{};let a=[];try{if(a=await Gt(t,r),!a.length)return{}}catch{return h.error({title:i("wallet_extension_fb_error_network_refresh"),duration:5}),{}}let u=await Xt(a,t,n);try{u.length&&await qt(u,r)}catch{return h.error({title:i("wallet_extension_fb_error_network_refresh"),duration:5}),{}}let d=[];try{let l=await Jt(a,r);if(!l.length)return{};d=l}catch{return h.error({title:i("wallet_extension_fb_error_network_refresh"),duration:5}),{}}let f;try{f=await $t({inscriptionInfoList:a,midAddrUtxoList:d,privateKey:n,selectedAddress:t,feeRate:s,walletId:p.walletId,serverWalletType:p.serverWalletType})}catch(l){let k=l.message===Bt?"wallet_extension_fb_error_dust_limit":"wallet_extension_fb_error_contact_support";return h.error({title:i(k),duration:5}),{}}return f},[C,H]=(0,e.useState)(kt),Vt=(0,e.useCallback)(async t=>{let o=t.value;o!==b&&([Q,Ft].includes(C)&&H(kt),x(!0),rt(o))},[b,C]),it=(0,e.useCallback)(async()=>{try{if(S)return;x(!0);let t=await V().getRequestHeaders({walletId:p.walletId,needSign:!0,currency:"usd"}),o=at.map(async({signedTx:n,...r})=>{let a={txHash:await It(J,n),signedTx:n,...r};return pt(a,{headers:t})});await Promise.all(o),x(!1),h.success({title:i("wallet_extension_fb_notification_view_status",{link:e.default.createElement(ut,{href:`${Ie}${b}`,className:c.link},i("wallet_extension_fb_notification_view_status_icu"))}),duration:5}),H(Q)}catch{h.error({title:i("wallet_extension_fb_notification_header_fail_claim"),duration:5}),x(!1),H(Ft)}},[S,p.walletId,at,b]),lt=vt(),Zt=(0,e.useCallback)(async()=>{if(C===Q){await lt();return}it()},[C,it,lt]);(0,e.useEffect)(()=>{zt(b,g).then(({refundFeeTxList:t=[],claimAmount:o=0})=>{x(!1),Ut(o),Dt(t)}).catch(()=>{x(!1)})},[b,g]);let jt=wt(ot,{decimals:8})||0,Qt=Number(ot)===0,te=(0,e.useCallback)(({value:t})=>{t!==g&&(Wt(t),x(!0))},[g]),ee=(0,e.useMemo)(()=>Mt.map(t=>({...t,label:i(t.label)})),[]);return e.default.createElement(I.Box,{className:c.root},e.default.createElement(z,{optionItemClassName:"break-all",titleClass:c.title,title:e.default.createElement("span",{className:c.title},i("wallet_extension_fb_header_switch_wallet_type")),value:b,options:B,onChange:Vt,searchable:!1,showSelectedIcon:!0,disabled:S}),e.default.createElement(z,{className:c.feeSelect,titleClass:c.title,title:e.default.createElement("span",{className:c.title},i("wallet_extension_fb_header_network_fee")),value:g,options:ee,onChange:te,searchable:!1,showSelectedIcon:!0,disabled:S}),e.default.createElement(dt,{className:c.input,inputClassName:c.placeholder,innerClassName:(0,Pt.default)(c.inner,c.addWeight,c.addElementWeight),title:e.default.createElement("span",{className:c.title},i("wallet_extension_fb_title_amount")),disabled:!0,placeholder:i("wallet_extension_fb_input_placeholder_num_fb",{num:jt}),value:""}),ge.map(t=>e.default.createElement("div",{className:c.tipTxt},i(t))),e.default.createElement(v,{className:c.btn,category:v.CATEGORY.fill,type:v.TYPE.highlight,size:v.SIZE.xl,loading:S,block:!0,onClick:Zt,disabled:Qt,loadingText:i("commonall_modal_btn_claim")},i(C)))}var Rt=Se;m();_();var Ot={root:"_root_1et89_1"};function Ce(){return W.default.createElement(Et,null,W.default.createElement(I.Box,{className:Ot.root},W.default.createElement(Rt,null)))}var Kt=Ce;var Mo=()=>tt.default.createElement(U.Switch,null,tt.default.createElement(U.Route,{path:xt,component:Kt,exact:!0}));export{Mo as default};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=FractalBRCFetchLoss-AA2YLUOI.js.map
