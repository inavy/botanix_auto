import{a as Oa,b as Bs,c as re,f as Ja,i as bo,j as vo,n as _r,o as Er,p as Rr,s as br,t as se}from"./chunk-BECDKZPI.js";import{a as Za,b as vr,c as tc,d as ec,e as oc,f as Lr,g as rc,h as sc}from"./chunk-6RN7QRT2.js";import{a as nc}from"./chunk-2KZZYSI5.js";import{h as Lo}from"./chunk-IHZLSNJE.js";import{a as qt}from"./chunk-TCK4KH7A.js";import{a as la,b as G}from"./chunk-3VL5K7XK.js";import{A as Us,C as Ka,L as kr,M as za,a as v,b as y,c as Ro,d as ct,e as Na,j as ye,k as Ma,l as ut,n as Fa,o as Ba,p as Ua,r as Va,s as Ar,u as Wa,v as Ga,w as Ut,x as Qa,y as Ha,z as ja}from"./chunk-GKGUF4PB.js";import{a as Ia,b as Ca,c as $,d as Tt,e as C,g as wa,h as so,i as Pa,j as xa,l as Ya,m as $a,n as Xa}from"./chunk-ENATTSEA.js";import{a as Ta,c as W}from"./chunk-Y6YYFXOD.js";import{a as U,b as Yn,c as ot}from"./chunk-3N45D4U2.js";import{a as fa,e as ga}from"./chunk-XCYZGVDR.js";import{a as to,b as pt,c as St,d as ua,n as F}from"./chunk-Y6TYNJA3.js";import{a as Sa,c as no}from"./chunk-ZML7M4AG.js";import{a as qa}from"./chunk-SXKGQ5LH.js";import{D as _a,E as Ea,F as ro,K as yr,M as Ra,N as ba,O as va,P as La,a as ya,h as Fs,k as Ir,l as Aa,o as oo,p as Cr,q as ka}from"./chunk-D6BE4A4F.js";import{a as jt,b as eo,d as da,e as Bt,h as ma,i as pa,k as H,l as ha,n as Ms}from"./chunk-HTIBXKUW.js";import{a as ca,b as f,d as Da}from"./chunk-RCA3QBWG.js";import{a as I,b as Ds,c as oe,d as at,f as z,g as Ce}from"./chunk-SSTSMCPU.js";import{$ as nt,$b as Pi,A as nr,B as ei,Cb as Ns,Cc as ta,D as B,Db as pi,Dc as ea,E as je,Eb as hr,F as Ke,Fb as hi,G as oi,Ga as ci,Gb as fi,Gc as oa,H as Ye,Hb as gi,Hc as ra,I as ge,Ib as Si,Ic as sa,J as Es,Ja as Os,Jb as Ti,Jc as na,K as Ao,Ka as Ps,Kb as Ii,Kc as ia,L as ri,La as ui,Lb as Ci,Lc as aa,M as Se,Ma as At,Mb as fr,Na as it,Nb as yi,Ob as Ai,P as X,Pb as ki,Q as Mt,Qb as _i,R as Ht,Rb as Ei,S as Zt,Sb as Ri,T as $e,Tb as bi,U as ir,Ub as gr,V as bt,W as ar,Wa as Eo,Wb as vi,X as si,Xa as V,Xb as Li,Ya as k,Yb as wi,_ as Rs,_a as li,_b as Oi,a as tr,aa as vt,ac as xi,b as er,ba as ni,bc as Sr,c as To,cc as Ni,d as Io,da as bs,dc as Di,e as or,ea as cr,ec as Mi,f as Co,fa as ur,fb as kt,fc as Fi,g as _s,ga as ko,gb as gt,gc as Bi,h as rr,hb as te,hc as Ui,i as He,ib as xs,ic as qi,j as $n,jb as di,jc as Vi,k as yo,kb as mi,kc as Tr,l as Xn,lc as Wi,mc as Gi,nc as Qi,o as mt,oa as Z,ob as pr,oc as Hi,p as rt,pa as Pt,pb as E,pc as ji,q as st,qa as Xe,qc as Ki,rb as ee,s as zn,sa as vs,sc as Yi,t as Jn,tc as $i,u as Q,v as sr,va as Ls,w as Zn,wa as ws,wc as Xi,x as ti,xa as ii,xc as zi,ya as ai,yc as Ji,zc as Zi}from"./chunk-LF7H3MNC.js";import{a as Hn,b as zt,c as So,d as jn,e as ft,f as Et,g as Jt,h as Kn,i as q,j as Rt,k as L,l as et}from"./chunk-7BIQTKIW.js";import{a as Te,b as _o,c as Ft,d as ze,e as Ie,f as Je,g as lr,h as dr,i as mr,j as Ze,k as R}from"./chunk-KCCATSGJ.js";import{a as ml}from"./chunk-QXE433GW.js";import{a as Ot}from"./chunk-YYAHGUV5.js";import{F as Qn,G as Qt,H as D,k as Gn}from"./chunk-TDPA2BUG.js";import{A as Rn,B as Zo,D as bn,F as Y,I as vn,J as me,K as go,N as Ln,Q as Is,S as wn,T as On,V as Pn,Y as pe,aa as xn,c as J,f as kn,ga as he,h as wt,ha as Cs,i as Yt,ia as Nn,j as S,ka as $t,la as ys,ma as As,oa as Dn,p as _n,pa as P,r as Qe,u as En,v as fo,x as zo,y as Jo}from"./chunk-BJO2AFCW.js";import{A as Bn,D as _,F as Un,I as qn,K as Vn,M,a as Mn,f as Fn,l as Gt,v as Xt,z as ks}from"./chunk-OIAB2YVD.js";import{ca as fe,e as Wn}from"./chunk-VXVCGVBA.js";import{a as x}from"./chunk-DAL2TMJA.js";import{f as b,h as s,m as u,o as l}from"./chunk-JEQEC2HU.js";u();l();var Ge=b(x()),dl=b(Ot());u();l();var ac=b(x());u();l();var wr=b(x());var ic=({children:a,rootStore:t})=>{let e=Yn(t),o=(0,wr.useMemo)(()=>(t.commonStore.rootStore=t,t.accountStore.rootStore=t,t),[t]);return wr.default.createElement(e.Provider,{value:o},a)};var cc=et(({swapRootStore:a,bridgeRootStore:t,children:e,initTab:o})=>{let{commonStore:{currentTab:r}}=a.getInstance(),n=o||r,i=a.getInstance();return n===E.BRIDGE&&(i=t.getInstance()),ac.default.createElement(ic,{rootStore:i},e)});u();l();var uc=b(x());M();function Or({children:a,...t}){return uc.default.createElement(Bn,{fetchConfig:ca.fetchConfig,...t},a)}u();l();u();l();u();l();u();l();var Ur=b(x());u();l();var xr=b(x());u();l();var Pr=b(ml());async function pl(a,t){let{devid:e}=await a.get("devid");return(o,r)=>{Pr.setDeviceId(e);let n=Pr.newInstance({site:"okex",product:o});return n.setApiEndpoint(`${t}/amplitude`),n.setCommonParams(Ca()),r(n),n}}async function qs(a,t){(await pl(a,t))("web3_trade",ya)}var hl=()=>{let[a,t]=(0,xr.useState)(!1);return(0,xr.useEffect)(()=>{let{getApiHostname:e}=R.global;qs(R.localStore,e()).then(()=>t(!0)).catch(()=>{})},[]),{initialized:a}},Nr=hl;u();l();u();l();var wo=b(x());var lc=a=>{let{params:t,replace:e}=so(),{autoSwitch:o,from:r}=t,[n,i]=(0,wo.useState)(""),[c,d]=(0,wo.useState)(!0),m=F.get(ci)||to;return o===Bs.BRIDGE&&!r.tokenContractAddress&&e({pathname:m,params:{...t,autoSwitch:void 0}}),(0,wo.useEffect)(()=>{a&&(async()=>{if(a===E.SWAP&&o===Bs.BRIDGE){let g=await re.judgeTabTypeByParams(t?.from,t?.to);g===E.BRIDGE&&e({pathname:St,params:{...t,autoSwitch:void 0}}),i(g),d(!1)}else i(a),d(!1)})().catch(()=>{})},[a]),{tabType:n,autoSwitching:c}};u();l();var Dr=b(x()),dc=b(Ot());var mc=()=>{let{pathname:a}=(0,dc.useLocation)(),[t,e]=(0,Dr.useState)("");return(0,Dr.useEffect)(()=>{switch(a){case to:case pt:e(E.SWAP);break;case St:e(E.BRIDGE);break;default:break}},[a]),t};u();l();var Vs=b(x());var pc=(a,t)=>{let{accountStore:e}=ot(),{params:o}=so(),{btcAddressType:r}=o;(0,Vs.useEffect)(()=>{e.setBtcAddressType(r)},[]);let n=Pa();(0,Vs.useEffect)(()=>{async function i(){let c=new re(a,o),{from:d,to:m,tab:p,inputAmount:g,error:T}=await c.initTokenPair(t);T||n(d,m,g,p)}a&&i().catch(()=>{})},[a])};u();l();var hc=b(x()),fc=b(Ot());var gc=a=>{let{fromToStore:t}=ot(),{from:e,to:o}=t,{params:r,replace:n}=so(),{pathname:i}=(0,fc.useLocation)(),c=xa();(0,hc.useEffect)(()=>{let d=c(e,o);d&&a&&[pt,St].includes(i)&&(new re(a).writeTabInfoToLocalStorage(d),n({params:{...d,feeConfig:r.feeConfig}}))},[e?.chainId,e?.tokenContractAddress,o?.chainId,o?.tokenContractAddress,a,i])};var fl=a=>{let t=mc(),{tabType:e}=lc(t);pc(e,a),gc(e)},Sc=fl;u();l();var Ic=b(x());u();l();function gl(a){return new Promise(t=>setTimeout(t,a))}async function io(a,t=3,e=0){let o;for(let r=0;r<t;r++)try{return await a()}catch(n){o=n,e&&r<t-1&&await gl(e)}throw o}function Sl(a,t,e){let o=$();return{promise:a(t,{...e,signal:o.signal}),cancel:()=>o.abort()}}function Tl(a,t,e){if(it())return Sl(a,t,e);let o=new AbortController,r=o.signal;return{promise:a(t,{...e,signal:r}),cancel:()=>o.abort()}}function Tc(a,t){return Tl(C.get,a,t)}function Cc(){let{accountStore:a,receiveAddressStore:t}=ot(),{address:e,setUserForbiddenBridge:o}=a,{receiveAddrObj:r,computedSwapHighLight:n}=t,{specifiedAddress:i}=r||{};(0,Ic.useEffect)(()=>{let c=()=>{};if(e&&n){let{promise:d,cancel:m}=Tc(Ki,{params:{userWalletAddress:e,receiveWalletAddress:i}});c=m,d.then(p=>{o(p?.data.blackListTypes||Se)}).catch(()=>{o(Se)})}else o(Se);return c},[e,o,i,n])}u();l();var yc=b(x());function Ws(){let{accountStore:{address:a}}=ot();(0,yc.useEffect)(()=>{y.setTags({address:a})},[a])}u();l();var Ac=b(x());var Il=()=>{let{accountStore:a,fromToStore:t,approveStore:e,recentTransactionStore:o,tokenModalStore:r}=ot();(0,Ac.useEffect)(()=>{let{computedAccountWalletAddresses:n}=a;return n&&(ct.addListen("error",()=>{e.onSocketError(),o.onSocketError(),t.setNeedBalanceLoading(!1),t.getSwapTokenBalance(),r.reloadTokenList()}),ct.addListen(Ro.DEX_PUSH_ENGINE,i=>{o.onSocket(i),e.onSocket(i)}),ct.addListen(Ro.WALLET_ASSET,i=>{i&&(r.updateAllTokenList(i),t.updateFromBalancePush(i))}),ct.init(n)),()=>{ct.removeAll(),ct.wsInstance&&n&&ct.logout(n)}},[a.computedAccountWalletAddresses,o.onSocket,r.updateAllTokenList,t.updateFromBalancePush,a,o,r])},kc=Il;u();l();var ne=b(x()),_c=b(Ot());var Cl=({currency:a,currentWallet:t,walletInfo:e,keyringIdentityTypeEnum:o,addressBookList:r,walletList:n,t:i,dispatch:c,currentTab:d,onBack:m})=>{let{commonStore:p,accountStore:g,recentTransactionStore:T,reset:A}=ot(),w=(0,_c.useHistory)();(0,ne.useEffect)(()=>{R.setRuntimeContext({history:w,toLocale:i,dispatch:c,walletInfo:e,onBack:m})},[i,w,c,e,m]),(0,ne.useEffect)(()=>{t&&g.setWalletConfig(t)},[t]),(0,ne.useEffect)(()=>(p.getUserUnit(a),p.fetchChainList({businessLine:1,currentTab:d}).catch(()=>{p.setChainListLoadError(!0)}),()=>{A()}),[]),(0,ne.useEffect)(()=>{g.setAddressBookList(r)},[r]),(0,ne.useEffect)(()=>{g.setWalletList(n)},[n]),(0,ne.useEffect)(()=>{g.setKeyringIdentityTypeEnum(o)},[o]),(0,ne.useEffect)(()=>{t.walletId?T.updatePendingOrders(t.walletId):T.setPendingOrders([])},[t.walletId,d]),Na()},Ec=Cl;u();l();var ht=b(x()),ie=b(Ot());u();l();var ao=b(x()),Br=b(Ot()),Uc=b(Da());u();l();var bc=b(x());u();l();var Rc=b(x());var yl=({visible:a,onBack:t=()=>{},params:e})=>{let{useCoin:o}=R.hooks,{coinId:r,receiveOnly:n,chainId:i,tokenContractAddress:c}=e,d=o(i,c);return a&&Rc.default.createElement(R.components.SupplyGas,{visible:a,closeCallback:t,coinId:r||d.coinId,receiveOnly:n})},Mr=yl;var Al=()=>{let{fromToStore:a}=ot(),{visibleAddFunds:t,addFundsParams:e,closeAddFunds:o}=a;return bc.default.createElement(Mr,{visible:t,params:e,onBack:()=>{o()}})},vc=et(Al);u();l();var Lc=b(x());var wc=()=>{let{fromToStore:a}=ot(),{closeAddFunds:t}=a;(0,Lc.useEffect)(()=>{t()},[])};u();l();var Oc=b(x());u();l();var Vt={wrapper:"_wrapper_1bvuq_1","extension-container":"_extension-container_1bvuq_5",extensionContainer:"_extension-container_1bvuq_5","telegram-container":"_telegram-container_1bvuq_9",telegramContainer:"_telegram-container_1bvuq_9","meme-telegram-container":"_meme-telegram-container_1bvuq_13",memeTelegramContainer:"_meme-telegram-container_1bvuq_13","right-icon":"_right-icon_1bvuq_17",rightIcon:"_right-icon_1bvuq_17"};function Pc(){return Oc.default.createElement(Fa,{iconStyle:{fontSize:24},tooltipProps:{show:!1},iconClassName:Vt.rightIcon})}u();l();var Nc=b(x()),Dc=b(Ot());var xc={[pt]:"swaptrade_card_swap_title_swap",[St]:"swaptrade_card_swap_title_swap",[Ft]:"swaptrade_extension_cinteraction_contract_interaction",[_o]:"swaptrade_recent_transaction_detail_dialog_title",[Ie]:"swaptrade_card_swap_title_swap",[Je]:"swaptrade_card_swap_title_swap",[lr]:"swaptrade_modal_select_crypto_title",[mr]:"swaptrade_select_token_header_third_token_reminder",[dr]:"swaptrade_trading_mode_header_settings"},kl=[ze,Ze],_l=a=>a.startsWith(Te)?f(xc[_o]):f(xc[a]),El=()=>{let a=(0,Dc.useLocation)();return(0,Nc.useMemo)(()=>({showNavigator:!kl.includes(a.pathname),title:_l(a.pathname)}),[a.pathname])},Fr=El;u();l();var Mc=b(x()),Fc=b(Ot());function Bc(){let a=(0,Fc.useLocation)(),t=Ba(),{isTelegramMiniApp:e}=R.global,o=a.pathname;return(0,Mc.useMemo)(()=>!e&&o===pt&&t,[e,o,t])}var Rl=[pt,St],bl=({children:a,onBack:t})=>{let{showNavigator:e,title:o}=Fr(),r=(0,Br.useLocation)(),n=(0,Br.useHistory)(),{isTelegramMiniApp:i}=R.global,{Navigator:c}=R.components,d=r.pathname.includes(Ft),m=Bc();wc();let p=()=>{d&&oo({...ut(),button_name:"back"}),t?t(n.goBack,Rl.includes(r.pathname)):n.goBack()};return ao.default.createElement("div",{className:(0,Uc.default)("universe-swap background-base-primary",Vt.wrapper)},e?ao.default.createElement(c,{title:o,onBack:p,closeable:m?{children:ao.default.createElement(Pc,null)}:!1}):null,ao.default.createElement("div",{className:i?Vt.telegramContainer:Vt.extensionContainer},a),ao.default.createElement(vc,null))},qc=et(bl);var vl=(0,ht.lazy)(()=>import("./Swap-DAVEMLK4.js")),Ll=(0,ht.lazy)(()=>import("./Bridge-6RFVX22O.js")),wl=(0,ht.lazy)(()=>import("./OrderDetail-AJQ6O76G.js")),Ol=(0,ht.lazy)(()=>import("./Contract-BHILITBP.js")),Pl=(0,ht.lazy)(()=>import("./Approve-5C536MII.js")),xl=(0,ht.lazy)(()=>import("./Solana-DI264TL2.js")),Nl=({onBack:a})=>{let t=(0,ie.useLocation)();return ht.default.createElement(qc,{onBack:a},ht.default.createElement(ht.Suspense,null,ht.default.createElement(ie.Switch,null,[{path:pt,component:vl,exact:!0},{path:St,component:Ll,exact:!0},{path:_o,component:wl,exact:!0},{path:Ft,component:Ol,exact:!0},{path:ze,component:Pl,exact:!0},{path:Ze,component:xl,exact:!0}].map((o,r)=>ht.default.createElement(ie.Route,{key:r,path:o.path,component:o.component,exact:o.exact})),ht.default.createElement(ie.Redirect,{from:to,to:{pathname:pt,search:t.search},strict:!0,exact:!0}))))},Vc=Nl;var Dl=({currency:a,currentWallet:t,keyringIdentityTypeEnum:e,addressBookList:o,walletList:r,walletInfo:n,onBack:i,t:c,dispatch:d,currentTab:m=E.SWAP})=>{Sc(n.chainId),Ec({currency:a,currentWallet:t,walletInfo:n,keyringIdentityTypeEnum:e,addressBookList:o,walletList:r,t:c,dispatch:d,currentTab:m,onBack:i}),Cc(),kc(),Ws();let{initialized:p}=Nr();return p?Ur.default.createElement(Vc,{onBack:i}):null},Wc=(0,Ur.memo)(et(Dl));u();l();u();l();u();l();u();l();P();u();l();var Gc=(a,t)=>{let e=a.split(".").map(Number),o=t.split(".").map(Number),r=Math.max(e.length,o.length);for(let n=0;n<r;n++){let i=e[n]||0,c=o[n]||0;if(i>c)return 1;if(i<c)return-1}return 0};var Oo=class{constructor(){s(this,"btcAddressType","");s(this,"setBtcAddressType",t=>{this.btcAddressType=t});s(this,"commonStore",null);s(this,"userForbiddenWithBridge",Se);s(this,"setUserForbiddenBridge",t=>{this.userForbiddenWithBridge=t});s(this,"defaultWalletConfig",mi);s(this,"walletConfig",this.defaultWalletConfig);s(this,"hasInitWalletInfo",!1);s(this,"chainId",se);s(this,"setChainId",t=>{this.chainId=t});s(this,"fromChainId",se);s(this,"setFromChainId",t=>{this.fromChainId=t});s(this,"walletSupportMev",!1);s(this,"setWalletSupportMev",t=>{this.walletSupportMev=t});s(this,"checkOkxVersion",async()=>{let t="2.82.31",e=this.walletConfig.isOkxWallet;if(this.isConnectedWallet&&e&&window?.okxwallet?.getVersion){let o=await window.okxwallet.getVersion(),n=Gc(o,t)>=0;this.setWalletSupportMev(n)}else this.setWalletSupportMev(!1)})}getDeviceId(){}getChainId(){}get scanAppType(){throw new Error("scanAppType is not defined")}get walletType(){throw new Error("walletType is not defined")}get address(){return se}get computedForbiddenBridge(){let{computedIsCrossChain:t}=S(this.rootStore,"fromToStore",{});return t?this.userForbiddenWithBridge:Se}get computedAccountId(){let{walletConfig:t}=this;return t.walletId}setWalletConfig(t={}){this.walletConfig=t}getAddressByChainId(){}get isConnectedWallet(){return!!this.walletConfig.walletId}get computedNonsupportChain(){return!this.isConnectedWallet||!H(this.fromChainId)?!1:!this.address}get computedAccountWalletAddresses(){return $t(S(this,"walletConfig.address",[])).join(",")||this.address}get computedAccountWalletAddressesArray(){return $t(S(this,"walletConfig.address",[]))||[this.address]}get computedSpecialWalletAddress(){return this.getAddressByChainId(V.BTC_MAINNET)}};u();l();u();l();function xt(a=[],t=[]){let e={};a.forEach(r=>{e[r]=So});let o={};return t.forEach(r=>{o[r]=jn}),{...e,...o}}var Qc=xt(["walletConfig","chainId","hasInitWalletInfo","fromChainId","btcAddressType"],["computedAccountId","isConnectedWallet","computedNonsupportChain","computedAccountWalletAddresses","computedAccountWalletAddressesArray","address","computedSpecialWalletAddress"]);var Gs=class extends Oo{constructor(e){super();s(this,"formatWalletType",()=>{let{walletInfo:e}=R,{isHARDWARE:o,isMNEMONIC:r,isMPC:n,isPRIVATE:i}=e?.walletType||{};return o?Zt.HARDWARE:r?Zt.MNEMONIC:n?Zt.MPC:i?Zt.PRIVATE_KEY:null});s(this,"formatWalletAccount",e=>{let o=Object.values(e.account);return{...e,OKXWalletType:this.formatWalletType(),address:o}});s(this,"keyringIdentityTypeEnum",{});s(this,"walletList",[]);s(this,"addressBookList",[]);s(this,"hasInitWalletInfo",!1);s(this,"getAddressByChainId",e=>{if(!H(e))return se;let o=this.getWalletChainName(e);return this.walletConfig.account?.[o]||se});this.rootStore=e,this.commonStore=e.commonStore,Rt(this,Qc)}async getDeviceId(){let{devid:e}=await R.localStore.get("devid");return e}getCurrentChainAddress(e){let o=this.rootStore?.fromToStore.from.chainId;if(!H(o))return se;let r=this.getWalletChainName(o);return e.account[r]}getWalletChainName(e){return R.getNetWorkName(e)}replaceBtcAddressByType(e){if(this.btcAddressType){let o=this.getWalletChainName(V.BTC_MAINNET);if(e.account?.[o]){let n=e.accountsMap?.bitcoin?.[this.btcAddressType]?.address;if(n)return{...e,account:{...e.account,[o]:n}}}}return e}setWalletConfig(e){this.walletConfig=this.formatWalletAccount(this.replaceBtcAddressByType(e)),this.hasInitWalletInfo=!0}webSwapHistoryDetailViewMore(){}setAddressBookList(e){this.addressBookList=e}setWalletList(e){this.walletList=e.map(o=>o.walletId===this.computedAccountId?this.replaceBtcAddressByType(o):o)}setKeyringIdentityTypeEnum(e){this.keyringIdentityTypeEnum=e}get address(){return this.getAddressByChainId(this.fromChainId)}},qr=Gs;u();l();u();l();P();M();u();l();var Ae={FROM:"FROM",TO:"TO"},Qs={COMMON:"COMMON",COLLECTION:"COLLECTION"},It={COLLECT_LIST:"COLLECT_LIST",ALL_NETWORK:"ALL_NETWORK",CHAIN_LIST:"CHAIN_LIST",SEARCH:"SEARCH",ALL_TOKENS:"ALL_TOKENS"},Ml={[It.COLLECT_LIST]:{[E.SWAP]:Di,[E.LIMIT_ORDER]:Ni,[E.BRIDGE]:Mi},[It.ALL_NETWORK]:{[E.SWAP]:Pi,[E.LIMIT_ORDER]:Oi,[E.BRIDGE]:xi},[It.SEARCH]:{[E.SWAP]:Bi,[E.LIMIT_ORDER]:Fi,[E.BRIDGE]:Ui},[It.CHAIN_LIST]:{[E.SWAP]:ki,[E.LIMIT_ORDER]:Ei,[E.BRIDGE]:_i},[It.ALL_TOKENS]:{[E.SWAP]:Ns,[E.LIMIT_ORDER]:Ns,[E.BRIDGE]:pi}},Kt=(a,t)=>Ml[a]?.[t]??"";var Po=class{constructor(t){s(this,"rootStore",null);s(this,"userUniqueId",wa());s(this,"chainListFreshCount",0);s(this,"chainList",[]);s(this,"setChainList",t=>{this.chainList=t,this.chainListFreshCount+=1});s(this,"transactionLoading",!1);s(this,"setTransactionLoading",t=>{this.transactionLoading=t});s(this,"nowCurrencyUnit",{});s(this,"tokenModalVisible",!1);s(this,"safemoonSlippage",0);s(this,"fetchChainList",async({businessLine:t=1,isLimit:e=!1,isHistory:o=!1,currentTab:r,chainIdConfig:n={}})=>{if(Mn())return[];let i=Kt(It.CHAIN_LIST,this.currentTab||r),c=await C.get(i,{params:{businessLine:e?ee.LIMIT_ORDER:t,...n}});return!o&&this.setChainList(c?.data),this.setCurrentTabChainList({[e?E.LIMIT_ORDER:E.SWAP]:c?.data}),c?.data});s(this,"currentTabChainList",{});s(this,"setCurrentTabChainList",t=>{this.currentTabChainList={...this.currentTabChainList,...t}});s(this,"getTradeType",()=>this.rootStore?.fromToStore?.computedIsCrossChain?xs.MULTI:xs.SINGLE);s(this,"globalMessages",null);s(this,"setGlobalMessage",t=>{this.globalMessages=t});s(this,"cleanGlobalMessage",()=>{this.globalMessages=null});s(this,"socketStatus",!1);s(this,"balancePushSocketStatus",!1);s(this,"resetFromToByTabChange",!1);s(this,"setResetFromToByTabChange",t=>{this.resetFromToByTabChange=t});s(this,"portal",At.DEX);s(this,"setPortal",t=>{this.portal=t});s(this,"currencyConversion",t=>{let{usdToThisRate:e}=this.nowCurrencyUnit,o=I.BigNumber(t);return!e||o.isNaN()?"":o.multipliedBy(e)});s(this,"currencyReConversion",t=>{let{usdToThisRate:e}=this.nowCurrencyUnit,o=I.BigNumber(t);return!e||o.isNaN()?"":o.dividedBy(e).toString()});s(this,"isSensitiveChain",t=>this.computedSensitiveChainIds.some(e=>String(e)===String(t)));s(this,"getTokenAddress",t=>Wa(t,this.isSensitiveChain(t?.chainId)));s(this,"equalsChainId",(t,e)=>Ga(t,e));s(this,"equalsToken",(t,e)=>{let o=this.isSensitiveChain(t?.chainId);return Ut(t,e,o)});s(this,"fromFillToken",!1);s(this,"currentTab","");s(this,"setCurrentTab",(t,e)=>{this.currentTab!==t&&(this.setResetFromToByTabChange(!0),this.rootStore?.fromToStore?.clearFromTo()),this.currentTab=t,this.fromFillToken=!!e});s(this,"marketWsIsConnected",!1);s(this,"setMarketWsIsConnected",t=>{this.marketWsIsConnected=t});s(this,"forceUpdateFromToByHash",0);s(this,"forceUpdateFromTo",()=>{this.forceUpdateFromToByHash+=1});s(this,"isFirstInit",!0);s(this,"visibleAddFunds",!1);s(this,"setAddFundsVisible",t=>{this.visibleAddFunds=t});this.rootStore=t,no&&this.setPortal(At.LEDGER)}setChainType(){}get computedReserveGas(){let{chainList:t}=this,e=S(this.rootStore,"fromToStore.from.chainId");return t.find(r=>Number(r.chainId)===Number(e))?.reserveGas||""}getChainByID(t){return this.chainList.find(e=>(this.computedCurrentTabIsLimit||e.chainUsed)&&e.chainId===Number(t))}getUserUnit(){}get computedRealSlippageValue(){return S(this,"rootStore.slippageStore",{}).computedRealSlippageValue||0}setSocketStatus(t){this.socketStatus=t}setBalanceSocketStatus(t){this.balancePushSocketStatus=t}get computedIsWalletEnv(){return this.portal===At.OKX_WALLET_EXTENSION}get computedIsWalletDashBoard(){return this.portal===At.WALLET_DASHBOARD}get computedIsMarket(){return this.portal===At.MARKET}get computedNotThirdBiz(){return this.portal===At.OKX_WALLET_EXTENSION||this.portal===At.DEX||this.portal===At.MARKET}get computedNowCurrencySymbol(){return this.nowCurrencyUnit.symbol||""}get computedSensitiveChainIds(){return this.chainList.map(t=>Number(t.isSensitive)===ei.YES?t.chainId:null).filter(Boolean)}get computedCurrentTabIsLimit(){return this.currentTab===E.LIMIT_ORDER}get computedIsUrlFillSwap(){return this.computedIsWalletDashBoard||this.computedIsWalletEnv}toBaseFormatUSD(t,e){let o=this.computedNowCurrencySymbol,r=this.nowCurrencyUnit?.usdToThisRate,n=I.BigNumber(t).multipliedBy(r).toString();return at(n,o,{needPlaceholder:!0,...e})}setIsFirstInit(t){this.isFirstInit=t}};u();l();var Hc=xt(["userUniqueId","chainList","transactionLoading","nowCurrencyUnit","tokenModalVisible","safemoonSlippage","globalMessages","socketStatus","balancePushSocketStatus","portal","currentTab","currentTabChainList","forceUpdateFromToByHash","marketWsIsConnected","isFirstInit","visibleAddFunds"],["computedReserveGas","computedNowCurrencySymbol","computedSensitiveChainIds","computedIsWalletEnv","computedCurrentTabIsLimit"]);var ke=class extends Po{constructor(e){super(e);s(this,"swapCollapse",!1);s(this,"setSwapCollapse",e=>{this.swapCollapse=e});s(this,"chainListLoadError",!1);s(this,"setChainListLoadError",e=>{this.chainListLoadError=e});Rt(this,{...Hc,swapCollapse:So,chainListLoadError:So}),this.setPortal(ui)}getUserUnit(e){this.nowCurrencyUnit=e}};u();l();P();M();var xo=class{constructor(t){s(this,"checkTokenValid",async t=>{if(!ha(t))return!1;let[e,o]=await _(C.get(ta,{params:pe(t,["chainId","tokenContractAddress"])}));return e?!1:o.data.supportMarket});this.rootStore=t,this.accountStore=t.accountStore,L(this,{},{autoBind:!0})}};u();l();P();M();var No=class{constructor(t){s(this,"showLimitDialog",!1);s(this,"setShowLimitDialog",t=>{this.showLimitDialog=t});s(this,"cancelRef",null);s(this,"callbackList",[]);s(this,"addToCallbackList",t=>{this.callbackList.push(t)});s(this,"removeFromCallbackList",t=>{this.callbackList=this.callbackList.filter(e=>e!==t)});s(this,"updateTokenCollectStatus",async({tokenInfo:t,callBack:e})=>{let{isConnectedWallet:o}=this.accountStore;if(!o){this.walletWarnInterceptor();return}this.cancelRef&&this.cancelRef.abort(),this.cancelRef=$();let r={tokenContractAddress:t?.tokenContractAddress,chainId:Number(t?.chainId),symbol:t?.tokenSymbol,decimal:t?.decimals,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,isCustomToken:t?.isCustomToken||t?.isSubscribe},[n,i]=await _(C.post(Sr,r,{signal:this.cancelRef.signal}));if(!Tt(n)&&n)n?.code===10023?D.error(f("swaptrade_selecttoken_modal_favorite_limitreached")):D.error(f("swaptrade_pricechart_no_connection_desc"));else if(i){if(i?.data===0)D.success({title:f("swaptrade_selecttoken_toast_removed_from_favorite"),duration:Pt}),e({selected:!1,tokenInfo:t}),this.callbackList.forEach(c=>{c({selected:!1,tokenInfo:t})});else if(i?.data===1){let c=Ra(),{isMarketHomeUrl:d}=ba();!d&&Cr({business_type:c?vs.LIMIT_ORDER:vs.SWAP}),D.success({title:f("swaptrade_selecttoken_toast_added_to_favorite"),duration:Pt}),e({selected:!0,tokenInfo:t}),this.callbackList.forEach(m=>{m({selected:!0,tokenInfo:t})})}}});s(this,"debounceUpdateTokenCollectStatus",Qe(this.updateTokenCollectStatus,500));s(this,"walletWarnInterceptor",()=>{D.error({title:f("swaptrade_selecttoken_toast_connect_wallet"),duration:Pt})});this.rootStore=t,this.commonStore=t.commonStore,this.accountStore=t.accountStore,L(this,{},{autoBind:!0})}};var ae=class{constructor(){ae.instance?(this.commonStore=ae.instance.commonStore,this.accountStore=ae.instance.accountStore,this.updateCollectionStore=ae.instance.updateCollectionStore,this.checkTokenStore=ae.instance.checkTokenStore):(this.commonStore=new ke(this),this.accountStore=new qr(this),this.updateCollectionStore=new No(this),this.checkTokenStore=new xo(this),ae.instance=this)}},_e=ae;s(_e,"instance",null);u();l();u();l();P();M();u();l();function Do(a){return[te.USER_DENIED,te.WC2Denied,te.USER_DENIED_WC_RAINBOW,te.WC_QR_DENIED].includes(a?.code)}var Hs=class{constructor(t){this.approveTokenDefaultConfig={status:B.Unknown,approvedAmount:"0"};this.approveTokensConfig={};this.getApproveTokenMapKey=(t,e)=>{let o=this.commonStore.getTokenAddress(t);return`${t.chainId}_${o}_${e}`};this.registerApproveToken=(t,e)=>{let o=this.getApproveTokenMapKey(t,e),r=S(this.approveTokensConfig,o);Y(r)&&(this.approveTokensConfig[o]={...this.approveTokenDefaultConfig})};this.registerCurrentApproveToken=()=>{let{token:t,tradeModeCode:e}=this.computedTokenAndTradeModeCode;this.registerApproveToken(t,e)};this.updateApproveTokenConfig=(t,e,o)=>{let r=this.getApproveTokenMapKey(t,e),n=S(this.approveTokensConfig,r),i=Y(n),c=n||this.approveTokenDefaultConfig;this.approveTokensConfig[r]={...c,...o},i&&y.stuff("if you want to update approve token config, you should register it first.")};this.removeApproveTokenConfig=(t,e)=>{let o=this.getApproveTokenMapKey(t,e);delete this.approveTokensConfig[o]};this.updateCurrentApproveTokenConfig=t=>{let{token:e,tradeModeCode:o}=this.computedTokenAndTradeModeCode;this.updateApproveTokenConfig(e,o,t)};this.getApproveTokenConfig=(t,e)=>{let o=this.getApproveTokenMapKey(t,e);return S(this.approveTokensConfig,o,this.approveTokenDefaultConfig)};this.clearNonApprovingTokensConfig=()=>{let t=On(this.approveTokensConfig,e=>[B.Approving,B.CancelApproving].includes(e.status));this.approveTokensConfig={...t}};this.isApprovalCheckRequired=()=>{let{computedIsSolanaChain:t,computedIsAptosChain:e}=this.fromToStore,{quote:{bestRoute:o}}=this.rootStore.quoteStore,r=this.commonStore.computedCurrentTabIsLimit,{token:n}=this.computedTokenAndTradeModeCode,{isNativeToken:i}=n;return(r?!0:o?.needApprove==="1")&&!i&&!t&&!e};this.validApproveAmountLessSwapAmount=t=>{let{token:e}=this.computedTokenAndTradeModeCode;return I.BigNumber(t).isLessThan(e.amount||"0")};this.isValidApprovalStatus=(t,e)=>{let o=oe(t),r=this.validApproveAmountLessSwapAmount(t);return o?B.UnApproved:r&&e?B.CancelApprove:r?B.UnApproved:B.Approved};this.generateApproveRequestParams=t=>{let{address:e}=this.accountStore,{token:o}=this.computedTokenAndTradeModeCode,{tokenContractAddress:r,chainId:n}=o;return{userWalletAddress:e,tokenContractAddress:r,chainId:n,cancelApproveTag:t}};this.fetchApproveAllowance=()=>{let t=this.getDefiPlatformIds();return C.get(vi,{params:{...this.generateApproveRequestParams(),defiPlatformIds:t}}).then(e=>e?.data)};this.fetchApproveData=t=>{let e=this.fromToStore.computedIsCrossChain?this.getBridgeDefiPlatformId():S(this,"rootStore.quoteStore.quote.bestRoute.defiPlatformId",nt),o={...this.generateApproveRequestParams(t),defiPlatformId:e};return C.get(Li,{params:o}).then(r=>{let{id:n,data:i,from:c,to:d,unsignedTx:m}=r?.data||{},p={data:i,from:c,to:d};return y.info(v.APPROVE_DATA,{id:n,data:i,from:c,to:d,unsignedTx:m,cancelApproveTag:t}),vr(o.chainId)&&(p=JSON.parse(m)),{transactionPayload:p,id:n}})};this.getBridgeDefiPlatformId=()=>{let e=this.rootStore.quoteStore.quote?.bestRoute,o=Number(e?.bridge?.bridgeType),r=e?.bridge?.defiPlatformId;return o===ni?r:nt};this.approveStatusIsPending=()=>[B.Approving,B.CancelApproving].includes(this.computedApprovalStatus);this.isPendingNeedCheck=async()=>{this.approveStatusIsPending()&&this.checkApprove().catch(()=>{})};this.isPendingNotCheck=async()=>{this.approveStatusIsPending()||this.checkApprove().catch(()=>{})};this.getDefiPlatformIds=()=>{let{computedIsCrossChain:t}=this.fromToStore;if(t){let e=S(this,"rootStore.quoteStore.pathSelectionRouterList");return Array.isArray(e)?$t(e.map(o=>o.bridge?.defiPlatformId).filter(o=>o!==void 0)):[nt]}return S(this,"rootStore.quoteStore.quote.bestRoute.defiPlatformInfoList",[{defiPlatformId:nt}]).map(e=>e.defiPlatformId)};this.checkApprove=async()=>{let{token:t,tradeModeCode:e}=this.computedTokenAndTradeModeCode;if(!this.isApprovalCheckRequired()){this.getDefiPlatformIds().forEach(i=>{this.registerApproveToken(t,i),this.updateApproveTokenConfig(t,i,{status:B.Approved,tagStatus:B.UnApproved})});return}let{tokenContractAddress:o}=t,{address:r}=this.accountStore;if(o&&r){let[,n]=await _(this.fetchApproveAllowance());if(!n){this.updateApproveTokenConfig(t,e,{status:B.Unknown});return}Object.keys(n).forEach(i=>{let c=n[i];this.calcApproveState({approveInfo:c,token:t,tradeModeCode:Number(i)})})}};this.calcApproveState=({approveInfo:t,token:e,tradeModeCode:o})=>{let{decimals:r}=e,n=Number(t.status)===B.Approved?t.amount:"0",i=eo(n,r)||"0",c=t?.needCancelApproveToken,d=this.isValidApprovalStatus(i,c);this.registerApproveToken(e,o),this.updateApproveTokenConfig(e,o,{status:d,tagStatus:d,approvedAmount:i})};this.fetchApproveDataErrorTips=(t,e)=>{this.updateCurrentApproveTokenConfig({status:B.UnApproved});let o=W(t?.tokenSymbol);Er({title:e?f("swaptrade_transfer_notification_title_ccy_unrevoked",{ccy:o}):f("swaptrade_toast_approve_fail",{tokenSymbol:o})})};this.approveErrorTips=({error:t,chainId:e,transactionPayload:o,token:r,tradeModeCode:n,cancelApproveTag:i})=>{y.error(v.APPROVE_TOKEN_ERROR,{chainId:e,transactionPayload:o,error:t,token:r,tradeModeCode:n}),Do(t)||Qt.error({title:f("swaptrade_home_toast_broadcast_failed")}),this.updateApproveTokenConfig(r,n,{status:this.isCancelApprove(i)?B.CancelApprove:B.UnApproved})};this.isCancelApprove=t=>t===je.CANCEL_APPROVE;this.setApprove=async t=>{let{token:e,tradeModeCode:o}=this.computedTokenAndTradeModeCode,{chainId:r}=e;this.updateApproveTokenConfig(e,o,{status:this.isCancelApprove(t)?B.CancelApproving:B.Approving});try{let{id:n,transactionPayload:i}=await this.fetchApproveData(t);await this.approveToken({chainId:r,transactionPayload:i}).then(({result:c})=>this.saveApprove({id:n,chainId:r,transactionHash:c,cancelApproveTag:t})).catch(c=>{this.approveErrorTips({error:c,chainId:r,transactionPayload:i,token:e,tradeModeCode:o,cancelApproveTag:t})})}catch{this.fetchApproveDataErrorTips(e,t)}};this.saveApprove=async({id:t,chainId:e,transactionHash:o,cancelApproveTag:r})=>{if(!o)return;let{address:n}=this.accountStore,i=S(this,"rootStore.quoteStore.quote.bestRoute.defiPlatformId",nt);y.info(v.SAVE_APPROVE,{id:t,transactionHash:o,chainId:e,userWalletAddress:n,cancelApproveTag:r,defiPlatformId:i});try{await C.post(wi,{id:t,transactionHash:o,chainId:e,userWalletAddress:n,cancelApproveTag:r,defiPlatformId:i})}catch(c){y.info(v.SAVE_APPROVE_ERROR,{error:c?.message,id:t,transactionHash:o,chainId:e,userWalletAddress:n,cancelApproveTag:r,defiPlatformId:i})}};this.onSocket=async t=>{if(t?.type==="1"&&t?.dexData&&t.dexData.type==="approve"){let e=t.dexData,{status:o,transactionHash:r,fromTokenSymbol:n,fromTokenAddress:i,exploreUrl:c,solanaToast:d,platformId:m}=e,p=it();if(d==="1"){if(p)return;let O=o===Ke.CANCEL_APPROVE_SUBMITTED?"swaptrade_transfer_toast_ccy_unrevoke_submit":"swaptrade_transfer_notification_approval_submit";_r({title:f(O,{ccy:W(n)})});return}let{token:g,tradeModeCode:T}=this.computedTokenAndTradeModeCode,A={chainId:e.chainId,tokenContractAddress:i},w=this.commonStore.equalsToken(g,A),N=String(T)===String(m);if(w&&N&&await this.isPendingNeedCheck(),(!w||w&&!N)&&this.removeApproveTokenConfig(A,m),o===Ke.APPROVE_SUCCESS){let O=f("swaptrade_toast_approve_success",{tokenSymbol:W(n)});!p&&_r({title:O,exploreUrl:c}),vo.emit(bo.APPROVE,{data:r,status:0,message:O})}else if(o===Ke.APPROVE_FAILED&&!p){let O=f("swaptrade_toast_approve_fail",{tokenSymbol:W(n)});Er({title:O,exploreUrl:c})}else if(o===Ke.CANCEL_APPROVE_SUCCESS&&!p){let O=f("swaptrade_transfer_notification_title_ccy_revoked",{ccy:W(n)});_r({title:O,exploreUrl:c})}else if(o===Ke.CANCEL_APPROVE_FAILED&&!p){let O=f("swaptrade_transfer_notification_title_ccy_unrevoked",{ccy:W(n)});Er({title:O,exploreUrl:c})}}};this.onSocketError=()=>{this.isPendingNeedCheck().catch(()=>{})};this.rootStore=t,this.accountStore=t.accountStore,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore}get computedApprovalStatus(){let{token:t,tradeModeCode:e}=this.computedTokenAndTradeModeCode;return this.getApproveTokenConfig(t,e).status}get computedTokenAndTradeModeCode(){let{from:t,computedIsCrossChain:e}=this.fromToStore,o=this.rootStore.quoteStore,r=nt;if(e)r=this.getBridgeDefiPlatformId();else{let{aggregateSelectId:n}=o;r=n===vt?nt:n}return{token:t,tradeModeCode:r}}get computedIsCancelApproveStatus(){return[B.CancelApprove,B.CancelApproving].includes(this.computedApprovalStatus)}approveToken(t){return Promise.resolve(t)}},jc=Hs;u();l();var Kc=Symbol(),Yc=Object.prototype,Fl=(a,t,e)=>{if(Kn(a))throw new Error("Target must not be observable");let o=a[Kc];if(o){let r={};for(let n in a)o[n]&&(r[n]=o[n]);o=r}else{o={};let r=a;for(;r&&r!==Yc;)Reflect.ownKeys(r).forEach(i=>{i===Hn||i==="constructor"||(o[i]=t&&i in t?t[i]:!0)}),r=Object.getPrototypeOf(r);let n=Object.getPrototypeOf(a);n&&n!==Yc&&Object.defineProperty(n,Kc,{value:o})}return Rt(a,o,e)},lt=Fl;var Ee=class extends jc{constructor(e){super(e);s(this,"approveInfo",{});s(this,"setApproveInfo",e=>{this.approveInfo=e});s(this,"setApprove",async(e=je.APPROVE)=>{let{token:o,tradeModeCode:r}=this.computedTokenAndTradeModeCode,{chainId:n}=o;this.updateApproveTokenConfig(o,r,{status:this.isCancelApprove(e)?B.CancelApproving:B.Approving});try{let{id:i,transactionPayload:c}=await this.fetchApproveData(e);this.setApproveInfo({chainId:n,id:i,transactionPayload:c,token:o,tradeModeCode:r,cancelApproveTag:e}),R.history?.push({pathname:ze})}catch{this.fetchApproveDataErrorTips(o,e)}});s(this,"approveCancel",()=>{let e=this.approveInfo.cancelApproveTag;this.setApproveInfo({}),R.history?.goBack?.(),this.updateCurrentApproveTokenConfig({status:this.isCancelApprove(e)?B.CancelApprove:B.UnApproved})});s(this,"approveConfirm",async({txHash:e,error:o})=>{if(o){this.approveErrorTips({error:o,...this.approveInfo}),this.approveCancel();return}let{id:r,chainId:n,cancelApproveTag:i}=this.approveInfo;await this.saveApprove({id:r,chainId:n,transactionHash:e,cancelApproveTag:i}),R.history?.goBack?.(),this.setApproveInfo({})});lt(this)}};u();l();M();u();l();var Nt=()=>{let{fromToStore:a,gasDropStore:t,receiveAddressStore:e,outerStore:o,quoteStore:r,accountStore:n,liquidityChooseStore:i}=U(),{from:c,to:d}=a,{receiveAddrObj:m}=e,{computedForbiddenBridge:p,address:g}=n,T=I.BigNumber(a.computedTypedValue).toString(10),w={...{chainId:c.chainId,toChainId:d.chainId,toTokenAddress:d.tokenContractAddress,fromTokenAddress:c.tokenContractAddress,amount:T,userWalletAddress:g},...r.computedSlippage,pmm:"1",gasDropType:t?.computedGasDropSelected?1:0,forbiddenBridgeTypes:Ms(p),dexIds:Ms(i?.computedIds),receiveWalletAddress:m?.specifiedAddress};return o.extendFeeConfig(w)},$c=()=>{let{quoteStore:a}=U();return{...Nt(),sort:a.bridgeSortType}},Xc=()=>{let{quoteStore:a}=U(),{quote:t}=a,e=t?.bestRoute?.bridge?.bridgeId,{slippage:o,toChainId:r,receiveWalletAddress:n,userWalletAddress:i,chainId:c,fromTokenAddress:d,toTokenAddress:m,amount:p}=Nt();return{slippage:o,toChainId:r,receiveWalletAddress:n,userWalletAddress:i,chainId:c,fromTokenAddress:d,toTokenAddress:m,amount:p,bridgeId:e}};u();l();u();l();u();l();var j=class{constructor({orderData:t,extParams:e},o){s(this,"walletNoNeedExtParams",!1);s(this,"differentiatedEnvironment",t=>it()&&t.length>1&&!this.walletNoNeedExtParams&&!t[0].params?[{...t[0],extParams:t[1]}]:t);this.orderData=t,this.calldataType=t.calldataType,this.extParams=e||{},this.swapStore=o}get isTransferType(){return this.calldataType===ri.TRANSFER}};var Re=class extends j{constructor(){super(...arguments);s(this,"formatContractPayload",()=>{let{orderData:e}=this;return{...JSON.parse(e?.callData?.data)}});s(this,"formatTransferPayload",()=>{});s(this,"getSendTransactionParams",async()=>{let e=this.formatContractPayload();return this.differentiatedEnvironment([{...e,extParams:this.extParams}])});s(this,"preExecution",async()=>({payload:this.formatContractPayload()}))}};s(Re,"chainId",V.APTOS_MAINNET);u();l();var be=class extends j{constructor(e,o,r){super(e,o);s(this,"makeSendBtcCallParams",async e=>{let{preDataForSendBtc:o}=this.swapStore.rootStore.walletContractStore;if(!o)throw Error("preDataForSendBtc is not ready");let{satBytes:r,coinAmount:n,dustSize:i,fetchUtxoList:c,serviceCharge:d}=o,m=await c();return{...e,utxoList:m,satBytes:r,dustSize:i,coinAmount:n,serviceCharge:d}});s(this,"formatContractPayload",()=>{});s(this,"formatTransferPayload",async()=>{let{orderData:e}=this;return this.swapStore.transferBtcPayload(e.callData)});s(this,"extendExtParams",e=>({...e,extParams:this.extParams}));s(this,"getSendTransactionParams",async()=>{if(!this.token.isNativeToken)throw new Error("btc token is not native token");let e;if(this.isTransferType){let o=await this.formatTransferPayload();e=this.extendExtParams(o),it()&&(e=await this.makeSendBtcCallParams(e))}else throw Error("Not support contract call");return this.differentiatedEnvironment([e])});s(this,"preExecution",async()=>{if(!this.token.isNativeToken)throw new Error("btc token is not native token");let e;if(this.isTransferType)e=await this.formatTransferPayload();else throw Error("Not support contract call");return{payload:e}});this.token=r}};s(be,"chainId",V.BTC_MAINNET);u();l();var Vr=class extends j{constructor(){super(...arguments);s(this,"valueToHex",e=>I.BigNumber(e).toString(16));s(this,"formatContractPayload",()=>{let{orderData:e}=this,{priorityFee:o,maxFeePerGas:r,maxPriorityFeePerGas:n,gasPrice:i,gas:c,...d}=e?.callData||{};return d});s(this,"formatTransferPayload",()=>{let{orderData:e}=this;return e.callData});s(this,"getSendTransactionParams",async()=>{let{payload:e}=await this.preExecution();return no&&e.value&&(e.value=this.valueToHex(e.value)),this.differentiatedEnvironment([e])});s(this,"preExecution",async()=>{let e;this.isTransferType?e=this.formatTransferPayload():e=this.formatContractPayload();let{extendEvmParams:o,extendsGas:r}=this.swapStore;return e.extParams=this.extParams,r&&(e=r(e)),e=o(e),{payload:e}})}};s(Vr,"chainId",V.ETHEREUM_MAINNET);var Wr=Vr;u();l();u();l();P();var ve=class{constructor(){s(this,"importSolana",async()=>{let t=await import("./index.browser.esm-WVU3GHWW.js"),{default:e}=await import("./bs58-JH6RT3SF.js");return{SolanaWeb3:t,bs58:e}});s(this,"deserialize",async t=>{let e={TRANSACTION:"transaction",VERSIONED_TRANSACTION:"versionedTransaction"},o,r,{SolanaWeb3:n,bs58:i}=await this.importSolana();try{o=n.Transaction.from(i.decode(t)),r=e.TRANSACTION}catch{o=n.VersionedTransaction.deserialize(i.decode(t)),r=e.VERSIONED_TRANSACTION}return{transaction:o,version:r}});s(this,"rentReserve",t=>{if(!t)return"0";let{BigNumber:e}=I,o=e("365.25").div(2).multipliedBy(2);return e("19.055441478439427").multipliedBy(t).multipliedBy(o).div(10**9).toFixed(9)});s(this,"txData",async t=>{let e;Zo(t)?e=JSON.parse(t):e=t;let{data:o,accountLength:r,bizType:n,bizId:i,from:c,to:d}=e,{transaction:m,version:p}=await this.deserialize(o),g=this.rentReserve(r);return{payload:{bizType:n,bizId:i,transaction:m,version:p},inputData:o,from:c,to:d,rent:g}})}};s(ve,"chainId",V.SOLANA_MAINNET);var Le=class extends j{constructor(...e){super(...e);s(this,"formatContractPayload",async()=>{let{orderData:e}=this;return this.txData(e.unsignedTx)});s(this,"formatTransferPayload",async()=>{let{orderData:e}=this,{unsignedTx:o}=e;return this.txData(o)});s(this,"getSendTransactionParams",async()=>{let{payload:e}=await this.preExecution();return this.differentiatedEnvironment([e,this.extParams])});s(this,"preExecution",async()=>{let e;return this.isTransferType?e=await this.formatTransferPayload():e=await this.formatContractPayload(),e});s(this,"getTxData",()=>{let{jitoData:e,jitoEnable:o=!1,unsignedTx:r}=this.orderData||{};try{if(o){let{jitoUnsignedTx:n}=e;return JSON.parse(n).array}return[JSON.parse(r)]}catch(n){throw new Error(n)}});s(this,"jitoTransaction",async()=>{let e=this.getTxData();try{return Promise.all(e.map(this.txData))}catch(o){throw new Error(o)}});let o=new ve;Object.assign(this,{...o})}};s(Le,"chainId",V.SOLANA_MAINNET);u();l();var we=class extends j{constructor(){super(...arguments);s(this,"formatContractPayload",()=>{let{orderData:e}=this,{data:o,from:r}=e.callData,n=JSON.parse(o);return{...n,functionArgs:n.functionArgsEncode,txType:"contract_call",stxAddress:r}});s(this,"formatTransferPayload",()=>{});s(this,"getSendTransactionParams",async()=>this.differentiatedEnvironment([this.formatContractPayload(),this.extParams]));s(this,"preExecution",async()=>({payload:this.formatContractPayload()}))}};s(we,"chainId",V.STACKS_MAINNET);u();l();var Oe=class extends j{constructor(){super(...arguments);s(this,"walletNoNeedExtParams",!0);s(this,"formatContractPayload",()=>{let{orderData:e}=this,o=JSON.parse(e.unsignedTx),{executionRequest:r}=JSON.parse(o.data);return r.calls});s(this,"formatTransferPayload",()=>{});s(this,"getSendTransactionParams",async()=>this.differentiatedEnvironment([this.formatContractPayload()]));s(this,"preExecution",()=>({payload:this.formatContractPayload()}))}};s(Oe,"chainId",V.STARKNET_MAINNET);u();l();var Gr=class extends j{constructor(){super(...arguments);s(this,"formatContractPayload",()=>{let{orderData:e}=this,{txBytes:o}=JSON.parse(e.unsignedTx);return{transactionBlock:o}});s(this,"getSendTransactionParams",async()=>this.differentiatedEnvironment([this.formatContractPayload(),this.extParams]));s(this,"preExecution",async()=>({payload:this.formatContractPayload()}))}};s(Gr,"chainId",V.SUI_MAINNET);var js=Gr;u();l();var Qr=class extends j{constructor(){super(...arguments);s(this,"walletNoNeedExtParams",!0);s(this,"formatContractPayload",()=>{let{orderData:e}=this,{params:o}=JSON.parse(e.unsignedTx);return o});s(this,"formatTransferPayload",()=>{let{orderData:e}=this,{params:o}=JSON.parse(e.unsignedTx);return o});s(this,"getSendTransactionParams",async()=>{let e=this.isTransferType?this.formatTransferPayload():this.formatContractPayload();return this.differentiatedEnvironment([e,this.extParams])});s(this,"preExecution",async()=>({payload:this.isTransferType?this.formatTransferPayload():this.formatContractPayload()}))}};s(Qr,"chainId",V.TON_MAINNET);var Ks=Qr;u();l();var Pe=class extends j{constructor(){super(...arguments);s(this,"formatContractPayload",()=>{let{orderData:e}=this;return JSON.parse(e.unsignedTx)});s(this,"formatTransferPayload",()=>{});s(this,"getSendTransactionParams",async()=>{let e=this.formatContractPayload();return this.differentiatedEnvironment([{...e,extParams:this.extParams}])});s(this,"preExecution",async()=>({payload:this.formatContractPayload()}))}};s(Pe,"chainId",V.TRON_MAINNET);var Bl={[be.chainId]:be,[Wr.chainId]:Wr,[Le.chainId]:Le,[Re.chainId]:Re,[js.chainId]:js,[Pe.chainId]:Pe,[we.chainId]:we,[Oe.chainId]:Oe,[Ks.chainId]:Ks},Ul=a=>Bl[a]||Wr,ql=(a,t,e)=>{let{chainId:o}=a,r=Ul(o);return new r(t,e,a)},Mo=ql;u();l();var Ys=a=>{let t=0;return a.forEach(e=>{t=I.add(t,e.rent,{returnString:!0})}),t},Vl=a=>{let t=a[0];return{fromAdr:t.from,toAdr:t.to,inputData:t.inputData}},$s=async({walletId:a,swapParams:t,signedTransactions:e,txArray:o,enableJito:r,isMemeMode:n=!1})=>{let i=o.length>1,c=[],d=[],{default:m}=await import("./bs58-JH6RT3SF.js");e.map(O=>{if(n){let{serializedTransaction:Wt,signature:Lt}=O;return{txHash:Lt,signedTx:Wt}}let dt=O?.signature||O?.signatures[0],tt=m.encode(dt),yt=m.encode(O.serialize());return{txHash:tt,signedTx:yt}}).forEach(O=>{c.push(O.signedTx),d.push(O.txHash)});let g="";i?g=JSON.stringify(c):g=c[0];let T=d[0],A=i?{mev:"Jito",jitoHash:d[1]}:{},w=Vl(o),N=Ys(o);return{updateMultiOrderInfo:{transactionHash:T,walletTxData:{extJson:JSON.stringify({...A,rent:N,txSource:3,feeType:4,multiTag:0,isMainTx:!1,coinAmount:0,serviceCharge:0,signedTx:i?JSON.parse(g):g}),isMainTx:!1,serviceCharge:0,txHash:T,walletId:a,txSource:3,coinAmount:0,walletType:2,signedTx:g,...w}},dexMultiMetaSaveOrderParam:{...t,enableJito:r}}},zc=async({signedTransactions:a,swapParams:t,walletId:e,txArray:o,enableJito:r,traceData:n})=>{let i=await $s({walletId:e,signedTransactions:a,swapParams:t,txArray:o,enableJito:r,traceData:n});return C.post(aa,i)};u();l();function Wl({selector:a}){let t=document.querySelector(a);t&&t.scrollTo({top:0,behavior:"smooth"})}var Hr=Wl;var Jc=20,ce={CONFIRM:"confirm",UPDATE:"update",FILL_UP:"fill_up",SNAP_UPDATE:"snap_update"},Xs=class{constructor(t){s(this,"quoteData",null);s(this,"preDataForSendBtc",null);s(this,"setPreDataForSendBtc",t=>{this.preDataForSendBtc=t});s(this,"setQuoteData",t=>{this.quoteData=t});s(this,"quoteParams",()=>{let{accountStore:t,fromToStore:e,receiveAddressStore:o}=this.rootStore,n={...Nt(),userWalletAddress:t.address};return e.computedDiffCrossChain&&(n.receiveWalletAddress=o.receiveAddrObj?.specifiedAddress),n});s(this,"updating",!1);s(this,"updateQuoteData",async()=>{let{quoteStore:{quote:t},swapStore:e}=this.rootStore,o=this.rootStore?.quoteStore?.quote?.bestRoute?.defiPlatformId;this.updating=!0;let n={...Nt(),bridgeId:t?.bestRoute?.bridge?.bridgeId,...o&&{defiPlatformId:o}},i=await e.extendSignParams(n),[c,d]=await _(C.post(`${Wi}`,i));if(this.updating=!1,Hr({selector:"#wallet_scroll"}),c){D.error({title:c?.data?.msg||f("swaptrade_top_notif_data_failed")});return}let{callDataResult:m,quoteResult:p}=d?.data||{};if(this.rootStore.quoteStore.handleUpdateQuote({data:p}),m){let g=await this.getPreExecutionPayload(m);ft(()=>{this.transactionPayload=g})}this.initCountDown(),this.startCountdown()});s(this,"updateBridgeGetIntentQuoteCallData",async()=>{let t=Xc();this.updating=!0;let[e,o]=await _(C.get(Xi,{params:{...t}}));if(this.updating=!1,Hr({selector:"#wallet_scroll"}),e){D.error({title:e?.data?.msg||f("swaptrade_trading_mode_error_no_update")});return}let{quoteResult:r}=o?.data||{};r&&this.rootStore.quoteStore.handleUpdateQuote({data:r}),this.initCountDown(),this.startCountdown()});s(this,"updateSnapQuoteData",async()=>{let t=Nt(),e=this.rootStore?.quoteStore?.quote?.bestRoute?.defiPlatformId;this.updating=!0;let[o,r]=await _(C.get(Yi,{params:{defiPlatformId:e,...t}}));if(this.updating=!1,Hr({selector:"#wallet_scroll"}),o){D.error({title:o?.data?.msg||f("swaptrade_trading_mode_error_no_update")});return}let{quoteResult:n}=r?.data||{};n&&this.rootStore.quoteStore.handleUpdateQuote({data:n}),this.initCountDown(),this.startCountdown()});s(this,"timer",null);s(this,"countdown",Jc);s(this,"initCountDown",()=>{this.countdown=Jc});s(this,"startCountdown",()=>{this.timer=setTimeout(()=>{let t=this.countdown;if(t===0){this.clearTimer();return}this.countdown=t-1,this.startCountdown()},1e3)});s(this,"clearTimer",()=>{this.timer&&clearTimeout(this.timer)});s(this,"initGasInfo",()=>({gasType:"normal",gasLimit:"0",gasPrice:"0",maxFeePerGas:"0",maxPriorityFeePerGas:"0",supportEip1559:!1,isNetworkFeeLoading:!0,isGasLimitLoading:!0}));s(this,"gasInfo",this.initGasInfo());s(this,"setGasInfo",t=>{this.gasInfo=t});s(this,"gasFee",0);s(this,"setGasFee",t=>{this.gasFee=t});s(this,"orderInfo",{});s(this,"transactionPayload",null);s(this,"solonaRent","");s(this,"getPreExecutionPayload",async(t,e)=>{let{swapStore:o,quoteStore:r}=this.rootStore,n=r?.quote?.bestRoute||{},{fromToken:i}=n,c=Mo(i,{orderData:t},o);if(e){let p=await c.jitoTransaction();return this.solonaRent=Ys(p),p}let{payload:d,rent:m}=await c.preExecution();return i.chainId===V.SOLANA_MAINNET&&m&&(this.solonaRent=m),d});s(this,"setTransactionPayload",t=>{this.transactionPayload=t});s(this,"fetchCallData",async()=>{let{swapStore:t}=this.rootStore||{};t.setCalldataSign(null);let e=t.saveOrderParams(),o=await t.extendSignParams(e);if(!o)return!1;let r=t.isSwapSolana(o.chainId),n,i;if(r){let d=t.extendSolanaCalldata(o);[n,i]=await t.getSolanaCalldata(d)}else[n,i]=await _(C.post(Tr,o));if(n){let d=[90002,10009,50028].includes(Number(n?.code))?n?.error_message:n?.data?.msg;return D.error({title:d||f("swaptrade_top_notif_data_failed")}),!0}let c=await this.getPreExecutionPayload(i?.data||{},r);return this.transactionPayload=c,!1});s(this,"nativeCoin",null);s(this,"setNativeCoin",t=>{this.nativeCoin={...t}});s(this,"calcNativeCoinAmount",()=>{let{coinAmountInt:t,decimals:e}=this.nativeCoin,{from:o,computedIsFromBtcCoin:r}=this.rootStore.fromToStore;return I.BigNumber(r?o.availableBalance:eo(t,e))});s(this,"calcNativeCoinAmountChange",()=>{let t;if(this.type===bt.SWAP){let{fromToStore:o}=this.rootStore;t=o.from}else{let{fromToken:o,fromTokenAmount:r}=this.rootStore.facetStore.facetOrderDetail;t={...o,amount:r}}let e=I.BigNumber(this.gasFee).isNaN()?"0":this.gasFee;return t.isNativeToken?I.BigNumber(t.amount).plus(e):I.BigNumber(e)});s(this,"gasFeeLoading",!0);s(this,"setGasFeeLoading",t=>{this.gasFeeLoading=t});s(this,"gasLimitError",null);s(this,"setGasLimitError",t=>{this.gasLimitError=t});s(this,"activityId",null);s(this,"setActivityId",t=>{this.activityId=t});s(this,"type",bt.SWAP);s(this,"setSwapType",t=>{this.type=t});s(this,"reset",()=>{this.gasInfo=this.initGasInfo(),this.setGasFeeLoading(!1),this.nativeCoin=null,this.transactionPayload=null,this.gasFee=0,this.setGasLimitError(null),this.setStarknetRegisterStatus(""),this.setVisibleStarknetRegister(!1),this.setActivityId(null),this.setSwapType(bt.SWAP),this.clearTimer(),this.solonaRent=""});s(this,"starknetRegisterStatus","");s(this,"setStarknetRegisterStatus",t=>{this.starknetRegisterStatus=t});s(this,"visibleStarknetRegister",!1);s(this,"setVisibleStarknetRegister",t=>{this.visibleStarknetRegister=t});s(this,"onSwap",()=>{oo({...ut(),button_name:"confirm"}),this.rootStore.swapStore.onSwap()});s(this,"onRedeem",()=>{this.rootStore.facetStore.walletSendRedeem()});s(this,"onIntentSwap",()=>{this.rootStore.intentSwapStore.onIntentSwap()});s(this,"confirmSwapMap",{[bt.SWAP]:this.onSwap,[bt.REDEEM]:this.onRedeem,[bt.INTENT_SWAP]:this.onIntentSwap});s(this,"onConfirm",t=>{this.confirmSwapMap[t]?.()});s(this,"getBtnProps",t=>{let{fromToStore:e,quoteStore:o}=this.rootStore,r=o?.computedIsOfflineType,{symbol:n,coinId:i,chainId:c}=this.nativeCoin||{};return{[ce.CONFIRM]:{disabled:this.computedConfirmBtnDisabled,onClick:m=>{this.onConfirm(m)},text:f("swaptrade_card_swap_btn_confirm_swap"),loading:this.computedIsConfirming},[ce.UPDATE]:{onClick:()=>{oo({...ut(),button_name:"update"}),this.updateQuoteData().catch(()=>{})},loading:this.updating,text:f("swaptrade_confirmswap_btn_update_price")},[ce.SNAP_UPDATE]:{onClick:()=>{oo({...ut(),button_name:"update"}),r?this.updateBridgeGetIntentQuoteCallData().catch(()=>{}):this.updateSnapQuoteData().catch(()=>{})},loading:this.updating,text:f("swaptrade_confirmswap_btn_update_price")},[ce.FILL_UP]:{onClick:()=>{Ea({wallet_address:this.rootStore.accountStore.address,button_name:"fill_up"}),e.baseAddFunds({coinId:i,chainId:c,receiveOnly:!1})},text:f("swaptrade_dialog_btn_supplement",{token:n})}}[t]});L(this),this.rootStore=t}get computedFormatTime(){return pa(this.countdown)}get computedPriceUpdate(){return this.countdown===0}get computedIsSufficientGas(){if(!this.nativeCoin)return!0;let t=this.calcNativeCoinAmount(),e=this.calcNativeCoinAmountChange();return t.gte(e)}get computedSolonaNativeTokenSufficientRent(){let{quoteStore:t}=this.rootStore,e=t?.quote?.bestRoute||{},{fromToken:o}=e||{};if(o?.chainId!==V.SOLANA_MAINNET||!this.nativeCoin||!this.solonaRent)return!0;let r=this.calcNativeCoinAmount(),n=this.calcNativeCoinAmountChange();return r.gte(n.plus(this.solonaRent))}get walletSendParams(){let{toLocale:t,dispatch:e}=R;return!t||!e?null:{t,dispatch:e}}get computedIsIntentSwap(){return this.rootStore?.quoteStore?.computedIsOfflineType}get computedConfirmBtnDisabled(){let{RegisterLocalStatusEnum:t}=R.global,{computedIsStarknetChain:e,computedIsFromBtcCoin:o,computedIsEvmChain:r}=this.rootStore.fromToStore;if(this.computedIsIntentSwap)return!1;if(e&&this.starknetRegisterStatus!==t?.COMPLETED)return!0;let n=this.computedPriceUpdate||!this.computedIsSufficientGas||!this.computedSolonaNativeTokenSufficientRent||this.gasFeeLoading||this.gasLimitError;return o||!r?n:n||this.gasInfo?.isGasLimitLoading||this.gasInfo?.gasLimitInfo?.queryGasLimitErrorUseDefault}get computedIsConfirming(){let{swapStore:t,intentSwapStore:e}=this.rootStore;return this.computedIsIntentSwap?!!e.isConfirmLoading:t.isConfirmLoading}get computedBtnProps(){let t=ce.CONFIRM;return!this.computedIsSufficientGas||!this.computedSolonaNativeTokenSufficientRent?t=ce.FILL_UP:this.computedPriceUpdate&&(t=this.computedIsIntentSwap?ce.SNAP_UPDATE:ce.UPDATE),this.getBtnProps(t)}get computedMonitorGasType(){return this.gasInfo?.gasType?{network_fee_details:{gas_level:this.gasInfo?.gasType}}:{}}},jr=Xs;u();l();P();u();l();P();P();M();u();l();P();P();var tu=(a,t)=>a.filter(({networks:e})=>e.findIndex(r=>r.name===t)>-1),eu=(a,t)=>a.filter(({account:e})=>e[t]),ou=({recentAddrData:a,addressBookData:t,walletListData:e,chainName:o})=>{let r=[];if(a.length>0){let n=a.map(({specifiedAddress:i,...c})=>({specifiedAddress:i,...c}));r.push({group:f("swaptrade_extension_wallet_address_recent_address"),list:n})}if(t.length>0){let n=t.map(i=>({...i,specifiedAddress:i.address}));r.push({group:f("swaptrade_extension_wallet_address_connected_wallets"),list:n})}if(e.length){let n=e.map(c=>({specifiedAddress:c.account[o],group:c.keyringName,name:c.walletName,walletId:c.walletId}));Object.entries(Rn(n,"group")).forEach(([c,d])=>{r.push({group:c,list:d})})}return r},Zc=a=>String(S(a,"isLeveraged"))==="1",ru=(a,t)=>{let e=[null,null];return Zc(a)&&(e[0]=a),Zc(t)&&(e[1]=t),e};var{BigNumber:K}=I,Fo=class{constructor(t){s(this,"defaultToken",{amount:"",prevAmount:"",balance:"",logoURI:"",coinId:"",decimals:"",usdPrice:"",tokenName:"",baseCoinId:"",tokenSymbol:"",tokenLogoUrl:"",isNativeToken:0,tokenContractAddress:"",isSafeMoonToken:"",isHoneypot:"",buyTaxes:"0",sellTaxes:"0",reverseReceiveAmount:"",chainId:""});s(this,"from",{...this.defaultToken,amount:"1"});s(this,"to",this.defaultToken);s(this,"fromBalanceState",rt.BALANCE_NOT_SHOW);s(this,"toBalanceState",rt.BALANCE_NOT_SHOW);s(this,"fromBalanceRequestError",!1);s(this,"toBalanceRequestError",!1);s(this,"isBalanceLoading",!1);s(this,"visibleAddFunds",!1);s(this,"setFrom",t=>{this.from=t});s(this,"setTo",t=>{this.to=t});s(this,"maxDialogType",Ao.enough);s(this,"setMaxDialogType",t=>{this.maxDialogType=t});s(this,"checkMaxDialogTypeIsEnough",t=>Ao.enough===t);s(this,"typedValue","");s(this,"fromMax",!1);s(this,"independentField",k.FROM);s(this,"singleTypedValue","");s(this,"singleFromMax",!1);s(this,"advanceSetTypedValue",(t="",e=!1,o="")=>{(o||this.commonStore.currentTab)===E.SWAP?(this.singleTypedValue=t,this.singleFromMax=e):this.setTypeInput(t,e)});s(this,"needCrossChainDoubleConfirm",!1);s(this,"setNeedCrossChainDoubleConfirm",t=>{this.needCrossChainDoubleConfirm=t});s(this,"updateBtcFromBalance",async()=>this.computedIsFromBtcCoin?(await this.getTokenBalanceByAccount(k.FROM,q(this.from)),!this.fromBalanceRequestError):!this.fromBalanceRequestError);s(this,"onClickMax",async()=>{Aa({button_name:"max"});let{isNativeToken:t}=this.from;this.setField(k.FROM);let e="",o="";if(t===1){let[r,n]=await Promise.all([this.rootStore.quoteStore.fetchGasTokenFee(),this.updateBtcFromBalance()]);if(!n)return;let{balance:i,availableBalance:c}=this.from,d=(this.computedIsFromBtcCoin?c:i)||"0";if(r===-1)return;o=K(d).minus(r);let m=o.isNegative();this.setMaxDialogType(m?Ao.insufficient:Ao.enough),m&&this.setShowAddFund(!0),this.showMaxDialog(),this.setShowMaxIcon(!0),e=m?"":o.toString()}else e=this.from.balance;this.advanceSetTypedValue(e,!0)});s(this,"setTypeInput",(t,e)=>{this.typedValue=t,this.fromMax=!!e});s(this,"setField",t=>{this.independentField=t});s(this,"quoteUpdateFromTo",t=>{let{receiveAmount:e="",fromTokenPrice:o="",toTokenPrice:r="",payAmount:n="",inputToTokenPrice:i=""}=t||{};!this.computedIsExactIn&&e?(this.from.amount=n,this.to.amount=this.computedTypedValue,this.to.prevAmount=this.computedTypedValue,this.from.currentTime=new Date().getTime(),this.to.usdPrice=i):this.computedIsExactIn&&(this.from.amount=this.computedTypedValue,this.to.amount=e,this.from.prevAmount=this.computedTypedValue,this.to.currentTime=new Date().getTime(),this.to.usdPrice=r),this.to.reverseReceiveAmount=e,this.from.usdPrice=o});s(this,"checkAndGetTokenInfo",async({chainId:t,tokenContractAddress:e})=>{let[o,r]=await this.getTokenInfoAndBalance(t,e);return o?null:r.data});s(this,"getDexMultiDefaultTokenInfo",t=>{let{chainList:e}=this.commonStore,o=q(e).find(r=>Number(r.chainId)===Number(t??Eo))||{};return{fromDexMultiTokenInfoVO:{...o.dexDefaultFromToTokenShowVO?.fromDexMultiTokenInfoVO,reserveGas:o.reserveGas},toDexMultiTokenInfoVO:o.dexDefaultFromToTokenShowVO?.toDexMultiTokenInfoVO||{}}});s(this,"addressReplaceSymbol",t=>{let{fromDexMultiTokenInfoVO:e}=this.getDexMultiDefaultTokenInfo(t.chainId),{tokenSymbol:o,isNativeToken:r}=e;return r&&this.commonStore.getTokenAddress(t)===this.commonStore.getTokenAddress(e)?o:t?.tokenContractAddress});s(this,"symbolReplaceAddress",t=>this.tokenReplaceMainToken(t).tokenContractAddress);s(this,"validTokens",{});s(this,"fetchTokenInfo",async t=>{if(t.tokenContractAddress){let e=await this.checkAndGetTokenInfo(t);if(e?.tokenContractAddress){let r={...e,balance:e.amountNum,amount:t.amount||""},n=`${e.chainId}_${this.commonStore.getTokenAddress(e)}`;return this.validTokens[n]=!0,r}let o=`${t.chainId}_${this.commonStore.getTokenAddress(t)}`;return this.validTokens[o]=t.tokenContractAddress==li,null}return null});s(this,"checkQueryToken",async(t,e=!0)=>{if(!H(t.chainId))return null;let o=t;if(Oa(this.commonStore.chainList,Number(t.chainId))){let{from:n}=this.getInitializedValue(t.chainId);if(this.commonStore.getTokenAddress(t)===this.commonStore.getTokenAddress(n)&&e){let c=`${n?.chainId}_${this.commonStore.getTokenAddress(n)}`;return this.validTokens[c]=!0,n}let i=await this.fetchTokenInfo({chainId:Number(t.chainId),tokenContractAddress:t.tokenContractAddress});e?o=i||n:o=i}else o=null;return o});s(this,"updateFrom",t=>{(!this.commonStore.equalsToken(t,this.from)||this.from.balance!==t.balance)&&(this.setShowMaxIcon(!1),this.setShowAddFund(!1)),this.from={...q(this.from),...t}});s(this,"updateFromAmount",t=>{this.from.amount=t,t||(this.from.usdPrice="0"),this.from.prevAmount||(this.from.prevAmount=t)});s(this,"updateTo",t=>{this.to={...q(this.to),...t}});s(this,"hideMaxDialog",!!F.get(Os));s(this,"hideMaxDialogLessGas",!!F.get(Ps));s(this,"setStorageShowMaxDialog",t=>{if(t){let e=this.checkMaxDialogTypeIsEnough(this.maxDialogType);F.set(e?Os:Ps,"1"),e?this.hideMaxDialog=!0:this.hideMaxDialogLessGas=!0}this.visibleMaxDialog=!1});s(this,"visibleMaxDialog",!1);s(this,"showMaxDialog",()=>{let t=this.checkMaxDialogTypeIsEnough(this.maxDialogType);t&&this.hideMaxDialog||!t&&this.hideMaxDialogLessGas||(this.visibleMaxDialog=!0)});s(this,"showMaxIcon",!1);s(this,"setShowMaxIcon",t=>{this.showMaxIcon=t});s(this,"showAddFund",!1);s(this,"setShowAddFund",t=>{this.showAddFund=t});s(this,"setFromBalanceRequestError",t=>{this.fromBalanceRequestError=t});s(this,"setToBalanceRequestError",t=>{this.toBalanceRequestError=t});s(this,"resetBalanceState",()=>{this.setShowMaxIcon(!1),this.setShowAddFund(!1),[this.fromBalanceRequestError,this.toBalanceRequestError]=[this.toBalanceRequestError,this.fromBalanceRequestError]});s(this,"onSwitchFromTo",async()=>{if(!this.isBalanceLoading){this.rootStore.quoteStore.quoteScope=null;let[t,e]=[q(this.from),q(this.to)];this.resetBalanceState();let o={amount:this.computedTypedValue??"",prevAmount:this.computedTypedValue??"",usdPrice:""},r={amount:"",prevAmount:"",usdPrice:""};this.setNeedCrossChainDoubleConfirm(!0),this.setField(k.FROM),this.computedIsSingleChain?this.setFrom({...e,...o}):(this.rootStore.quoteStore.setQuoteNumber(this.computedTypedValue?0:2),this.setFrom({...e,amount:e.amount||"",prevAmount:e.amount||"",usdPrice:""})),this.setTo({...t,...r}),this.advanceSetTypedValue(e.amount),this.rootStore.receiveAddressStore.clearReceiveAddressValue()}});s(this,"getChainInfo",t=>{let{chainList:e}=this.commonStore;return q(e).find(r=>Number(r.chainId)===Number(t))||{}});s(this,"getInitializedValue",(t=Eo)=>{let e=this.getChainInfo(t),{fromDexMultiTokenInfoVO:o,toDexMultiTokenInfoVO:r}=e?.dexDefaultFromToTokenShowVO||{fromDexMultiTokenInfoVO:{},toDexMultiTokenInfoVO:{}},n={...q(o),balance:"",reserveGas:e?.reserveGas},i={...q(r),balance:""};return{from:n,to:i}});s(this,"resetFromTo",async t=>{let{chainList:e,currentTab:o}=this.commonStore,r=o===E.BRIDGE;if(Number(t)!==Number(this.from.chainId)){let n=q(e).find(p=>Number(p.chainId)===Number(t)),{fromDexMultiTokenInfoVO:i,toDexMultiTokenInfoVO:c,toCrossDexMultiTokenInfoVO:d}=n?.dexDefaultFromToTokenShowVO||{fromDexMultiTokenInfoVO:{},toDexMultiTokenInfoVO:{}};this.from={...q(i),balance:"",reserveGas:n?.reserveGas};let m=r&&d||c;this.to={...q(m),balance:""}}});s(this,"clearFromTo",()=>{this.from={},this.to={}});s(this,"updateBalanceIfNativeToken",(t,e)=>{e.isNativeToken?this.getTokenBalanceByAccount(t,e,!1).catch(kn):(this.setFromBalanceRequestError(!1),this.setBalance(t,e.amountNum))});s(this,"getSwapTokenBalance",(t=!1)=>{this.getTokenBalanceByAccount(k.FROM,q(this.from),t).catch(()=>{}),this.getTokenBalanceByAccount(k.TO,q(this.to),t).catch(()=>{})});s(this,"getTokenInfoAndBalance",async(t,e)=>{let o=this.accountStore.getAddressByChainId(t),r={chainId:t,tokenAddress:e,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,userWalletAddress:o,businessType:this.commonStore.computedCurrentTabIsLimit?ws.LIMIT_ORDER:ws.SWAP_ORDER};return _(C.get(gr,{params:r}))});s(this,"needBalanceLoading",!0);s(this,"setNeedBalanceLoading",t=>{this.needBalanceLoading=t});s(this,"getTokenBalanceByAccount",async(t,e,o=!1)=>{let r=t===k.FROM,{chainId:n,tokenContractAddress:i}=e;if(H(n)&&i&&this.accountStore.computedAccountId){this.needBalanceLoading&&(this.isBalanceLoading=!0);let c=await this.getTokenInfoAndBalance(n,i);if(this.isBalanceLoading=!1,this.setNeedBalanceLoading(!0),!this.commonStore.equalsToken(e,r?this.from:this.to))return;if(c[0]){if(o){this.fromBalanceRequestError=!1,this.toBalanceRequestError=!1;return}r?(this.fromBalanceRequestError=!0,this.fromBalanceState=rt.BALANCE_REQUEST_FAILED):(this.toBalanceRequestError=!0,this.toBalanceState=rt.BALANCE_REQUEST_FAILED),this.setBalance(t,"0","0","0");return}r?this.fromBalanceRequestError=!1:this.toBalanceRequestError=!1;let{amountNum:d,availableAmountNum:m,currencyAmount:p}=c[1]?.data||{};this.setBalance(t,d,m,p)}});s(this,"setBalance",(t,e="",o="",r="")=>{let n=t===k.TO,i={balance:e,availableBalance:o,currencyAmount:r};n?this.updateTo({...this.to,...i}):this.updateFrom({...this.from,...i})});s(this,"setBalanceState",t=>{let{amount:e,address:o,from:r,to:n}=t;Boolean(o)&&Boolean(r.tokenContractAddress)?this.fromBalanceRequestError===!0?this.fromBalanceState=rt.BALANCE_REQUEST_FAILED:K(r.balance||"0").lt(e||"0")?this.fromBalanceState=rt.BALANCE_INSUFFICIENT:this.fromBalanceState=rt.COMMON:this.fromBalanceState=rt.BALANCE_NOT_SHOW,!(Boolean(o)&&Boolean(n.tokenContractAddress))||!this.computedIsToAddressEqualsCurrentToAddress&&this.computedDiffCrossChain?this.toBalanceState=rt.BALANCE_NOT_SHOW:this.toBalanceRequestError===!0?this.toBalanceState=rt.BALANCE_REQUEST_FAILED:this.toBalanceState=rt.COMMON});s(this,"updateFromBalancePush",t=>{let{coinAmountOriginalDec:e,availableAmountNum:o,currencyAmount:r}=t;this.commonStore.equalsToken(this.from,t)?this.setBalance(k.FROM,e,o,r):this.commonStore.equalsToken(this.to,t)&&this.setBalance(k.TO,e,o,r)});s(this,"tokenReplaceMainToken",t=>{let e=t,{fromDexMultiTokenInfoVO:o}=this.getDexMultiDefaultTokenInfo(t?.chainId),{tokenSymbol:r,chainId:n}=o;return H(t?.chainId)&&t?.tokenContractAddress&&(this.commonStore.getTokenAddress(t)===(this.commonStore.isSensitiveChain(n)?r:he(r))||this.commonStore.getTokenAddress(t)===this.commonStore.getTokenAddress(o))&&(e={...o,amount:t.amount}),e});s(this,"onClickAddFunds",()=>{let{tokenSymbol:t,chainName:e}=this.from,{address:o}=this.accountStore,r={currency:t,network:e,address:o};this.getDeposit(r)});s(this,"calOrderUpdateFromTo",t=>{let{fromTokenUsd:e,toTokenUsd:o,fromAmount:r,toAmount:n}=t||{};go(r)||(this.from.amount=r),go(e)||(this.from.usdPrice=e),go(n)||(this.to.amount=n),go(o)||(this.to.usdPrice=o)});s(this,"isEvmChain",t=>H(t)?this.commonStore.getChainByID(t)?.chainType!==zn.NO_EVM_CHAIN:!0);s(this,"isTronChain",t=>t===V.TRON_MAINNET);s(this,"getFormatFromToToken",async({from:t,to:e},o)=>{let[r,n]=await Promise.all([this.checkQueryToken(t,o),this.checkQueryToken(e,o)]),i=r,c=n,d=m=>`${m?.chainId}-${m?.tokenContractAddress}`;if(r){let m=this.getInitializedValue(r?.chainId),p=fo(ys([r,n,m.from,m.to],d));i=p[0],c=p[1]}else if(n){let m=this.getInitializedValue(n.chainId),p=fo(ys([n,m.from,m.to],d));i=p[1],c=p[0]}return{token1:i,token2:c}});s(this,"orderContinueStatus",Z.DEFAULT);s(this,"setOrderContinueStatus",t=>{this.orderContinueStatus=t});s(this,"fillSwapFromTo",async({apiRequestParams:t,locationParams:e})=>{let{closeModal:o}=this.rootStore.recentTransactionStore;!await this.beforeCheckAndGetTokenInfo(t,e)||(o(),this.setSwapAndLimitTypeValue(e.inputAmount))});s(this,"beforeCheckAndGetTokenInfo",async(t,e)=>{let{orderCheckContinue:o}=this.rootStore.oneMoreOrderStore;if(this.setOrderContinueStatus(Z.LOADING),t&&!await o(t))return this.setOrderContinueStatus(Z.ERROR),!1;let{token1:r,token2:n}=await this.getFormatFromToToken(e,!1);return!r||!n?(D.error({title:f("swaptrade_history_toast_setup_error"),duration:Pt}),this.setOrderContinueStatus(Z.ERROR),!1):(this.setOrderContinueStatus(Z.READY),this.updateFromAndToInfo(r,n),!0)});s(this,"beforeCheckUrl",async t=>{this.setOrderContinueStatus(Z.LOADING);let{orderCheckContinue:e}=this.rootStore.oneMoreOrderStore;return await e(t)?(this.setOrderContinueStatus(Z.READY),!0):(this.setOrderContinueStatus(Z.ERROR),!1)});s(this,"updateFromAndToInfo",(t,e)=>{this.updateFrom(t),this.updateTo(e)});this.rootStore=t,this.accountStore=t.accountStore,this.commonStore=t.commonStore}get computedTypedValue(){return this.commonStore.currentTab===E.SWAP?this.singleTypedValue:this.typedValue}get computedFromMax(){return this.commonStore.currentTab===E.SWAP?this.singleFromMax:this.fromMax}get computedNeedCrossChainDoubleConfirm(){return this.computedIsSingleChain?!1:!this.needCrossChainDoubleConfirm}get dependentField(){return this.independentField===k.FROM?k.TO:k.FROM}get computedIsExactIn(){return this.independentField===k.FROM}get computedIsSingleChain(){return H(this.from.chainId)&&H(this.to.chainId)&&Number(this.from.chainId)===Number(this.to?.chainId)}get computedSwapAmount(){return{[this.independentField]:this.computedFromMax?Ce(this.computedTypedValue,{noNeedThousandth:!0}):this.computedTypedValue,[this.dependentField]:this.computedCalAmount[this.dependentField]}}get computedCalAmount(){return{[k.FROM]:Ce(this.from?.amount,{noNeedThousandth:!0})??"",[k.TO]:Ce(this.to?.amount,{noNeedThousandth:!0})??""}}get computedIfQuote(){return!!(this.computedTypedValueIsValid&&this.from&&this.to)}get computedTypedValueIsValid(){return!K(this.computedTypedValue).isZero()&&!K(this.computedTypedValue).isNaN()}get computedFromAmountIsValid(){let{amount:t}=this.from;return jt(t)}get computedFromLocalCostByUsd(){let{usdPrice:t}=this.from;if(!this.computedFromAmountIsValid)return"";let{nowCurrencyUnit:e}=this.commonStore,{symbol:o,usdToThisRate:r}=e,n=K(t);if(o&&t&&r&&!n.isNaN()){let c=n.multipliedBy(r).toString();return at(c,o,{needBillionMillionUnit:!1})}return""}get computedToLocalCostByUsd(){let{usdPrice:t}=this.to,{nowCurrencyUnit:e}=this.commonStore,{symbol:o,usdToThisRate:r}=e,n=K(t);if(o&&t&&r&&this.to.amount&&!n.isNaN()&&jt(this.from.amount)){let c=n.multipliedBy(r).toString();return at(c,o,{needBillionMillionUnit:!1})}return""}get computedRate(){let{from:t,to:e,computedIsExactIn:o}=this,{quoteStore:r,gasDropStore:n}=this.rootStore,i=S(r,"quote.bestRoute.gasDropFromAmount",""),c=i&&n?.gasDropConfig?.gasDrop?K(t?.amount).minus(i):K(t?.amount),d=e?.reverseReceiveAmount&&o||!o&&t?.amount;return c&&d?z(K(e?.reverseReceiveAmount).div(c).toString(10),{needBillionMillionUnit:!1}):""}get computedToFromRate(){let{from:t,to:e,computedIsExactIn:o}=this,{quoteStore:r,gasDropStore:n}=this.rootStore,i=S(r,"quote.bestRoute.gasDropFromAmount",""),c=i&&n?.gasDropConfig?.gasDrop?K(t?.amount).minus(i):K(t?.amount),d=e?.reverseReceiveAmount&&o||!o&&t?.amount;return c&&d?z(K(c).div(e?.reverseReceiveAmount).toString(10),{needBillionMillionUnit:!1}):""}get computedIsToAddressEqualsCurrentToAddress(){let t=this.accountStore.getAddressByChainId(this.to.chainId);return t&&this.rootStore.receiveAddressStore.computedReceiveAddr===t}get computedValueDifference(){let{quoteStore:t}=this.rootStore,{usdPrice:e}=this.from,{usdPrice:o,currentTime:r}=this.to,n=S(t,"quote.bestRoute.gasDropFromAmount",""),i=S(t,"quote.bestRoute.fromTokenAmount",""),c=oe(e),d=Ds(e),m=oe(o),p=Ds(o);if(c||d||m||p)return{isUp:!1,diff:"",isOver:!1,nowTime:new Date().getTime()};let g=n?K(e).div(K(i))*K(n):"";e=n?e-g:e;let T=K(o).minus(e).div(e).multipliedBy(100),A=K(T.toFixed(2,1));if(A.gt(-.1)&&A.lt(.1))return null;let N=T.isNegative()?"":"+",O="";return T.gt(100)?O=`>${N}${Bt(100,{needZero:!1})}`:T.lt(-100)?O=`<${N}${Bt(100,{needZero:!1})}`:O=`${N}${Bt(A.toString(10),{needZero:!1})}`,{isUp:T.gte(0),diff:O,isOver:T.lte(-10),currentTime:r,specialValueRangePrompt:T.gt(-10)&&T.lt(10),value:`${K(T.toFixed(2,1)).toString(10).replace(/\+|-/,"")}`}}get computedIsCrossChain(){return H(this.from.chainId)&&H(this.to.chainId)&&Number(this.from.chainId)!==Number(this.to?.chainId)}get computedIsBridge(){let{from:t,to:e}=this;return this.computedIsCrossChain&&t.tokenSymbol===e.tokenSymbol}getDeposit(){}get computedDiffCrossChain(){let t=!!this.accountStore.address,e=this.commonStore.getChainByID(this.from.chainId),o=this.commonStore.getChainByID(this.to.chainId),r=String(this.from.isHoneypot),n=String(this.to.isHoneypot),{computedNonsupportChain:i}=this.accountStore,c=e?.crossChainType||"",d=o?.crossChainType||"";return t&&!i&&r!=="1"&&n!=="1"&&c&&d&&c!==d}get computedMaxTipsText(){let{from:t,maxDialogType:e}=this,{cacheNativeGasFee:o}=this.rootStore.quoteStore;if(!t.isNativeToken||!o||!t.tokenSymbol)return f("wallet_swap_toast_reserve_mainnet_token");let r={value:z(o),tokenSymbol:t.tokenSymbol};if(this.checkMaxDialogTypeIsEnough(e)){if(this.computedIsFromBtcCoin&&I.gt(this.computedUnavailableBalance,0)){let n=z(this.computedUnavailableBalance);return f("swaptrade_dialog_pay_card_reserved_from_wallet",{symbol:r.tokenSymbol,value:r.value,unablevalue:n})}return f("swaptrade_dialog_desc_reserved_netfee",r)}return f("swaptrade_dialog_desc_please_reserve",r)}get computedShowAddFund(){let{accountStore:t,swapBtnStore:e}=this.rootStore,{from:o}=this;return!t.computedNonsupportChain&&(this.independentField===k.FROM&&K(this.computedTypedValue||0).gt(K(o.balance||0))||e.computedTooBalance)||this.showAddFund&&!this.checkMaxDialogTypeIsEnough(this.maxDialogType)}get computedIsEvmChain(){return this.isEvmChain(this.from.chainId)}get computedDefaultAutoSlippageInfo(){let t=this.commonStore.getChainByID(this.from.chainId);return{autoSlippage:t?.toleranceSlippage?.selectItem,autoTotalSlippage:t?.crossToleranceSlippage?.selectItem}}get computedIsSolanaChain(){return Lr(this.from.chainId)}get computedIsAptosChain(){return rc(this.from.chainId)}get computedIsTronChain(){return vr(this.from.chainId)}get computedIsSuiChain(){return tc(this.from.chainId)}get computedIsStacksChain(){return ec(this.from.chainId)}get computedIsStarknetChain(){return oc(this.from.chainId)}get computedHasToSwap(){let t=S(this.rootStore.quoteStore,"quote.bestRoute.toSwapFeeUsd");return this.computedIsCrossChain&&t>0}setSwapAndLimitTypeValue(t){let{computedCurrentTabIsLimit:e}=this.commonStore,{clearSellAndReceive:o}=this.rootStore?.limitOrderControlStore||{};e?o?.():jt(t)?(this.setField(k.FROM),this.advanceSetTypedValue(t)):this.advanceSetTypedValue("")}get computedLeverageTokenPair(){return ru(this.from,this.to)}get computedFormToTokenIsLeverageToken(){let[t,e]=this.computedLeverageTokenPair;return!!t||!!e}get computedIsFromBtcChain(){return Za(this.from.chainId)}get computedIsFromBtcCoin(){return this.computedIsFromBtcChain&&this.from.isNativeToken}get computedUnavailableBalance(){return K(this.from.balance).minus(this.from.availableBalance).toString()}get computedIsFacetToken(){let{from:t,to:e}=this;return Number(t.tokenType)===$e.FACET||Number(e.tokenType)===$e.FACET}get computedNonsupportFacetToken(){let{address:t,walletConfig:{OKXWalletType:e,walletType:o}}=this.accountStore;if(!t)return!1;let r=[Zt.MNEMONIC,Zt.PRIVATE_KEY].includes(e),n=o===ur.METAMASK;return this.computedIsFacetToken&&!(r||n)}};var xe=class extends Fo{constructor(e){super(e);s(this,"getDeposit",()=>()=>{});s(this,"addFundsParams",{});s(this,"closeAddFunds",()=>{this.visibleAddFunds=!1});s(this,"onClickAddFunds",()=>{let{tokenSymbol:e,chainName:o,tokenLogoUrl:r,chainId:n,isNativeToken:i,tokenContractAddress:c}=this.from;this.visibleAddFunds=!0;let d={currency:e,network:o,iconUrl:r,chainId:n,isNativeToken:i,tokenContractAddress:i?"":c,receiveOnly:!0};this.baseAddFunds(d)});s(this,"baseAddFunds",e=>{this.visibleAddFunds=!0,this.addFundsParams={...e}});s(this,"tokenReplaceMainToken",(e,o)=>{let r=e,n=!Ar(e),{fromDexMultiTokenInfoVO:i}=this.getDexMultiDefaultTokenInfo(n?o:e.chainId),{tokenSymbol:c,chainId:d}=i;return!n&&(this.commonStore.getTokenAddress(e)===(this.commonStore.isSensitiveChain(d)?c:he(c))||this.commonStore.getTokenAddress(e)===this.commonStore.getTokenAddress(i))&&(r={...i,amount:e.amount}),r});lt(this),Et(()=>{let{computedDiffCrossChain:o,to:r}=this;return{computedDiffCrossChain:o,toChainId:r?.chainId}},({computedDiffCrossChain:o,toChainId:r})=>{this.cacheToChainId!==r&&this.rootStore.receiveAddressStore.saveReceiveAddressValue({}),this.rootStore.receiveAddressStore.setCacheToChainId(o&&r?r:-1)},{equals:zt.shallow})}};u();l();P();u();l();M();var zs=class{constructor(t){s(this,"signIntentSwap",async()=>[]);s(this,"createIntentOrder",async t=>{let e={intentCode:t.offlineType,signature:t.signature,quote:t?.quote,userWalletAddress:this.rootStore?.accountStore?.address,defiPlatformId:t.defiPlatformId},[o,r]=await _(C.post($i,{...e}));return o&&(y.error(v.INTENT_ORDER_CREATE_ERROR,{error:o}),D.error({title:o?.error_message||f("swaptrade_trading_mode_alert_order_fail")})),ro({...ut(),order_id:r?.data?.orderId,wallet_type:this.rootStore?.accountStore.walletConfig?.walletType}),[o,r]});s(this,"bridgeSumbitIntentOrder",async t=>{let{slippageStore:e,quoteStore:o,receiveAddressStore:r,fromToStore:n,accountStore:i}=this.rootStore,{quote:c,computedQuoteAmount:d}=o,{from:m,to:p}=n,{computedMinimumReceived:g,computedRealSlippageValue:T}=e,A=r?.receiveAddrObj?.specifiedAddress,w=T,N=c?.bestRoute?.bridge?.bridgeId,O=i?.address,dt={signature:t.signature,quote:t?.quote,defiPlatformId:t.defiPlatformId,receiveWalletAddress:A,fromChainId:m?.chainId,fromTokenAddress:m?.tokenContractAddress,fromAmount:d,toChainId:p.chainId,toTokenAddress:p.tokenContractAddress,toAmount:p.reverseReceiveAmount,walletAddress:O,bridgeId:N,minimumReceived:g,slippage:w},[tt,yt]=await _(C.post(zi,{...dt}));return tt&&(y.error(v.INTENT_ORDER_CREATE_ERROR,{error:tt}),D.error({title:tt?.error_message||f("swaptrade_trading_mode_alert_order_fail")})),ro({...ut(),order_id:yt?.data?.orderId,wallet_type:this.rootStore?.accountStore.walletConfig?.walletType}),[tt,yt]});this.rootStore=t}},su=zs;u();l();var nu=xt(["isConfirmLoading"],[]);var Js=class extends su{constructor(e){super(e);s(this,"isConfirmLoading",!1);s(this,"setIsConfirmLoading",e=>{this.isConfirmLoading=e});s(this,"signIntentSwap",async(e,o)=>{let{signTransaction:r}=this.rootStore.sendTransactionStore,[n,i]=await r(o,e);return n&&(y.error(v.INTENT_SWAP_SIGN_ERROR,{error:n,msg:{chainId:e,unsignedTx:o}}),D.error({title:f("swaptrade_trading_mode_alert_order_fail")})),[n,i]});s(this,"onIntentSwap",async()=>{let{quoteStore:e}=this.rootStore;if(e?.computedIsOfflineType){await this.onIntentBridgeOrder();return}await this.onIntentSwapOrder()});s(this,"onIntentSwapOrder",async()=>{this.setIsConfirmLoading(!0),y.keepLive();let{swapStore:e,quoteStore:o}=this.rootStore,r=S(o,"quote.bestRoute.fromToken.chainId");try{let{offlineType:n,calldata:i,defiPlatformId:c}=o?.quote.bestRoute,{quote:d,unsignedTx:m}=i||{};if(!d||!m)return;let[p,g]=await this.signIntentSwap(r,m);if(p)return;let[T,A]=await this.createIntentOrder({quote:d,offlineType:n,signature:g,defiPlatformId:c});if(T)return;e.afterTransaction(A.data?.orderId)}catch(n){y.error(v.INTENT_SWAP_PROCESS_ERROR,{error:n})}finally{this.setIsConfirmLoading(!1),y.removeKeep()}});s(this,"onIntentBridgeOrder",async()=>{this.setIsConfirmLoading(!0),y.keepLive();let{swapStore:e,quoteStore:o}=this.rootStore,r=S(o,"quote.bestRoute.fromToken.chainId");try{let{bridge:n}=o?.quote.bestRoute,{calldata:i,defiPlatformId:c}=n,{quote:d,unsignedTx:m}=i||{};if(!d||!m)return;let[p,g]=await this.signIntentSwap(r,m);if(p)return;let[T,A]=await this.bridgeSumbitIntentOrder({quote:d,signature:g,defiPlatformId:c});if(T)return;e.afterTransaction(A.data?.orderId)}catch(n){y.error(v.INTENT_SWAP_PROCESS_ERROR,{error:n})}finally{this.setIsConfirmLoading(!1),y.removeKeep()}});Rt(this,nu)}},Kr=Js;u();l();u();l();M();var Zs=class{constructor(t){s(this,"receiveAddrStatus",Ye.NORMAL);s(this,"receiveAddrObj",{});s(this,"saveReceiveAddressValue",t=>{this.receiveAddrObj=this.filterReceiveWalletInfo(t),t?.specifiedAddress||this.initCheckAddrStatus()});s(this,"clearReceiveAddressValue",()=>{this.receiveAddrObj={},this.initCheckAddrStatus(),this.walletAddrInWeb3=[],this.getLinkedWalletAddrInWeb3().catch(()=>{})});s(this,"checkReceiveAddressLoading",!1);s(this,"filterReceiveAddress",(t,e,o=!0)=>{let r=e?.specifiedAddress||this.receiveAddrObj?.specifiedAddress||"";return r?t.filter(({specifiedAddress:n})=>o?n.includes(r):n===r):t});s(this,"filterReceiveWalletInfo",t=>{if(!t.specifiedAddress||t.walletId)return t;let e=this.filterReceiveAddress(this.initWalletAddrListFromChain,t,!1);return e.length?e[0]:t});s(this,"initCheckAddrStatus",()=>{this.checkReceiveAddressLoading=!1,this.receiveAddrStatus=Ye.NORMAL});s(this,"checkReceiveAddr",async t=>{if(t||this.receiveAddrObj.specifiedAddress){this.checkReceiveAddressLoading=!0;let{to:e}=this.rootStore.fromToStore;try{let o=await Ua(e?.chainId,t||this.computedReceiveAddr),r=Symbol("requestId");if(this.currentRequestId=r,o){let{data:n}=await C.get(qi,{params:{address:t||this.receiveAddrObj.specifiedAddress,chainId:e?.chainId}});this.currentRequestId===r&&ft(()=>{this.receiveAddrStatus=n.status})}else ft(()=>{this.receiveAddrStatus=Ye.ILLEGALITY})}catch(o){y.stuff(o),this.receiveAddrStatus=Ye.ILLEGALITY}finally{this.checkReceiveAddressLoading=!1}}else this.initCheckAddrStatus()});s(this,"getSpecifiedChainWalletList",async t=>{let e=await this.getSpecifiedChainWalletListByWeb3(t),o={};return e?.forEach(r=>{let{specifiedAddress:n,walletType:i,createTime:c}=r,d=i===ur.OKEXCHAIN;o[n]&&o[n]?.has&&d?o[n].walletInfo.createTime<c&&(o[n].walletInfo=r):(!o[n]?.has||d)&&(o[n]={walletInfo:r,has:d})}),Object.keys(o).map(r=>o[r].walletInfo)});s(this,"walletAddrInWeb3",[]);s(this,"getLinkedWalletAddrInWeb3",async()=>{let{computedDiffCrossChain:t,to:e}=this.rootStore.fromToStore,{computedAccountId:o}=this.rootStore.accountStore;if(!t)return;let[r,n]=await _(this.getSpecifiedChainWalletList({chainId:e.chainId,walletIds:[o]}));r||ft(()=>{this.walletAddrInWeb3=n})});s(this,"initWalletAddrListFromChain",[]);s(this,"initWalletAddrListInStorage",[]);s(this,"filterWalletAddrListFromChain",[]);s(this,"filterWalletAddrListInStorage",[]);s(this,"getWalletList",async()=>{let{to:t}=this.rootStore.fromToStore,e=await this.getSpecifiedChainWalletList({chainId:t.chainId});ft(()=>{this.initWalletAddrListFromChain=e,this.filterWalletAddrListFromChain=e;let o=Xt.get(ko);if(o){let r=o[t.chainId]||[];this.initWalletAddrListInStorage=r,this.filterWalletAddrListInStorage=r}})});s(this,"getFilteredAddrList",t=>{this.filterWalletAddrListFromChain=this.filterReceiveAddress(this.initWalletAddrListFromChain,t),this.filterWalletAddrListInStorage=this.filterReceiveAddress(this.initWalletAddrListInStorage,t)});s(this,"saveWalletAddressToStorage",t=>{this.receiveAddrObj?.specifiedAddress&&Xt.set(ko,{[t.chainId]:[this.receiveAddrObj]})});s(this,"formatInputValue",t=>{let{specifiedAddress:e,deriveName:o,label:r}=t;if(e.length<=9)return e;let n=yr(t.specifiedAddress);return o&&(n=`(${n})`,r?n=`${o} - ${r} ${n}`:n=`${o} ${n}`),n});this.rootStore=t}get computedSwapHighLight(){return this.receiveAddrStatus===Ye.NORMAL&&!!this.receiveAddrObj?.specifiedAddress}get computedFormatReceiveAddr(){return this.receiveAddrObj?.specifiedAddress?this.formatInputValue(this.receiveAddrObj):""}get computedReceiveAddr(){return this.receiveAddrObj?.specifiedAddress||""}setReceiveAddress(t){this.receiveAddress=t}getReceiveAddress(){return this.receiveAddress}getSpecifiedChainWalletListByWeb3(){}get computedWalletAddrInWeb3(){return this.walletAddrInWeb3.length?this.walletAddrInWeb3[0]:null}get isFromFilterAddress(){let t=this.filterReceiveAddress(this.initWalletAddrListFromChain,this.receiveAddrObj?.specifiedAddress,!1),e=this.filterReceiveAddress(this.initWalletAddrListInStorage,this.receiveAddrObj?.specifiedAddress,!1);return!!(t.length+e.length)&&!!this.receiveAddrObj?.specifiedAddress}},iu=Zs;var tn=class extends iu{constructor(e){super(e);s(this,"formatInputValueEx",(e,o)=>{let{keyringName:r,walletName:n}=e;if(o.length<=9)return o;let i=yr(o);return r&&(i=`(${i})`,n?i=`${r} - ${n} ${i}`:i=`${r} ${i}`),i});s(this,"cacheToChainId",-1);s(this,"setCacheToChainId",e=>{this.cacheToChainId=e});s(this,"addressListEx",[]);s(this,"getWalletListEx",()=>{let{accountStore:e,fromToStore:o}=this.rootStore,r=R.getNetWorkName(o.to.chainId),{walletList:n,addressBookList:i,keyringIdentityTypeEnum:c}=e,m=(F.get(ko)||{})[o.to.chainId]||[],p=tu(i,r),g=eu(n,r);this.addressListEx=ou({recentAddrData:m,addressBookData:p,walletListData:g,chainName:r,keyringIdentityTypeEnum:c})});lt(this)}get computedFormatReceiveAddrEx(){let{accountStore:e,fromToStore:o}=this.rootStore,{walletConfig:r}=e;if(this.receiveAddrObj.specifiedAddress)return this.formatInputValueEx(this.receiveAddrObj,this.receiveAddrObj.specifiedAddress);let n=R.getNetWorkName(o.to.chainId),i=r?.account[n];return i?(this.receiveAddrObj={...r,specifiedAddress:i},this.formatInputValueEx(r,i)):""}},Yr=tn;u();l();M();u();l();var en=class{constructor(t){s(this,"updateTxHash",t=>(y.info(v.UPDATE_HASH,{...t,tags:{orderId:t.orderId,status:t?.status||1}}),C.post(Ai,t).catch(e=>{y.info(v.UPDATE_HASH_ERROR,{...t,error:e,tags:{orderId:t.orderId}})})));s(this,"cancelOrder",t=>(y.info(v.CANCEL_ORDER,{tags:{orderId:t}}),C.get(Qi,{params:{id:t}})));this.rootStore=t}},au=en;var on=class extends au{constructor(){super(...arguments);s(this,"sendTransaction",async(...e)=>R.global?.signAndSubmitTransaction(...e));s(this,"sendTransactionEnhance",async(...e)=>this.sendTransaction(...e));s(this,"signTransaction",async(e,o)=>{let[r,n]=await _(R.global.signTypedDataV4(o,e));return[r,n]})}async signSolanaTransactionWithMeme(e,o){let{calldataParams:r}=e;return await Promise.all(o.map(i=>R.global.signSolanaCommonTransaction({fromAddress:r.userWalletAddress,instanceType:i.payload.version,serializedMessage:i.inputData,needToReplaceRecentBlockhash:!1})))}},co=on;u();l();P();u();l();M();u();l();P();P();var rn=class{constructor(t){s(this,"rootStore");this.rootStore=t}checkZeroValue(){let t=null,o=this.rootStore.quoteStore.quote.bestRoute,{fromTokenPrice:r,toTokenPrice:n,fromToken:i,toToken:c}=o;return!Number(r)&&!Number(n)?t=i.tokenSymbol===c.tokenSymbol?Q.ALIKE_TOKEN_SYMBOL_PRICE_UNKNOWN:Q.ALL_TOKEN_PRICE_UNKNOWN:Number(r)?Number(n)||(t=Q.TO_TOKEN_PRICE_UNKNOWN):t=Q.FROM_TOKEN_PRICE_UNKNOWN,{errorType:t,continueToNextInterceptor:!1}}checkValueDifference(){let t=null,{fromToStore:e}=this.rootStore,{computedValueDifference:o,computedIsCrossChain:r}=e;return o?.isOver&&(t=r?Q.VALUE_DIFFERENCE_TOO_MUCH_CROSS:Q.VALUE_DIFFERENCE_TOO_MUCH),{errorType:t,continueToNextInterceptor:!1}}checkMinReceive(){let t=null,e=this.rootStore.quoteStore,o=this.rootStore.slippageStore;return e?null:(o?.computedMinimumReceivedIsOrange&&(t=Q.MIN_RECEIVED_TOO_SMALL),{errorType:t,continueToNextInterceptor:!1})}checkRepeatOrderWithEnoughBalance(){let t=null,{swapCheckStore:e}=this.rootStore,{repeatOrder:o}=e;return o?.enoughFlag===Es.ENOUGH&&(t=Q.REPEAT_ORDER),{errorType:t,continueToNextInterceptor:!1}}async checkBlockedRepeatOrder(){let t=null,{swapCheckStore:e}=this.rootStore;await e.checkRepeatOrder();let{repeatOrder:o}=e;return o&&(o.repeatFlag===ge.BTC_REPEAT?t=Q.REPEAT_ORDER_BTC:o.repeatFlag===ge.FACET_REPEAT?t=Q.REPEAT_ORDER_FACET:o.enoughFlag!==Es.ENOUGH&&(t=Q.REPEAT_ORDER_NOT_ENOUGH)),{errorType:t,continueToNextInterceptor:!1}}checkFacetTokenCrossChainDetail(){let{fromToStore:t}=this.rootStore,{from:e,to:o,computedNonsupportFacetToken:r}=t;if(r||F.get(ai))return null;let n=null;return e.tokenType!==o.tokenType&&(Number(e.tokenType)===$e.FACET||Number(o.tokenType)===$e.FACET)&&(n=Q.FACET_SWAP_TIPS),{errorType:n,continueToNextInterceptor:!1}}checkCrossChain(){let t=null;return this.rootStore.fromToStore.computedNeedCrossChainDoubleConfirm&&!F.get(ti)&&(t=Q.CROSS_CHAIN_DOUBLE_CONFIRM),{errorType:t,continueToNextInterceptor:!1}}checkGasMoreThanReceive(){let t=null,{fromToStore:e,quoteStore:o}=this.rootStore,{computedIsCrossChain:r}=e,n=o.quote.bestRoute,{toTokenPrice:i,quoteNetWorkFeeOfMoney:c,fromSwapFeeUsd:d}=n,{BigNumber:m}=I;return(r?new m(d):new m(c)).gte(new m(i))&&(t=Q.GAS_MORE_THAN_RECEIVE_VALUE),{errorType:t,continueToNextInterceptor:!1}}checkToSwapThanGasFee(){let t=null,{fromToStore:e,quoteStore:o}=this.rootStore,{computedHasToSwap:r}=e,n=Number(e.to.chainId)===1;if(r&&n){let i=S(o,"quote.bestRoute.toSwapFeeUsd"),c=S(o,"quote.bestRoute.bridge.bridgeAmountOutUsd"),d=S(o,"quote.bestRoute.bridge.toRiskLimit");I.BigNumber(i).dividedBy(c).gte(d)&&(t=Q.TO_SWAP_THAN_GAS_FEE)}return{errorType:t,continueToNextInterceptor:!1}}checkVolatilitySlippage(){let t=null,o=this.rootStore.slippageStore.computedVolatilityTips?.swapInterceptorType;return o&&(t=o),{errorType:t,continueToNextInterceptor:!0}}async checkBtcBalance(){let{fromToStore:t,safeMoonStore:e}=this.rootStore,{computedIsFromBtcCoin:o,from:r,updateBtcFromBalance:n}=t;if(o){if(!await n())throw Error("btc balance update failed");let c=e.computedInputVal,d=r.availableBalance;if(I.BigNumber(c).gt(d))return{errorType:Q.BTC_AVAILABLE_BALANCE_NOT_ENOUGH,continueToNextInterceptor:!1}}return null}async checkCrossChainSwap(){let{swapCheckStore:t}=this.rootStore;await t.checkCrossChainSwap();let e=t.checkSwapMoreInfo?.errorCode;return vn(e)&&e!==0?e===4&&F.get(`${sr}_${t.checkSwapMoreInfo?.contentTip?.extra?.bridgeName}_${e}`)||F.get(`${sr}_${e}`)?null:{errorType:Q.CHECK_CROSS_MORE,continueToNextInterceptor:!1}:null}async checkThirdPartyProvider(){let{quoteStore:t}=this.rootStore,{computedIsOkxProvider:e}=t,o=F.get(`${sr}_${Zn}`);return!e&&!o?{errorType:Q.THIRD_PARTY_PROVIDER,continueToNextInterceptor:!0}:null}async checkBridgeThirdPartyProvider(){let{quoteStore:t}=this.rootStore,{computedBridgeIsOkxProvider:e,computedIsOfflineType:o}=t;return!e&&o?{errorType:Q.THIRD_PARTY_PROVIDER,continueToNextInterceptor:!0}:null}makeCheckers(){let{fromToStore:{computedIsCrossChain:t}}=this.rootStore;return t?[this.checkBridgeThirdPartyProvider,this.checkVolatilitySlippage,this.checkCrossChainSwap,this.checkBtcBalance,this.checkZeroValue,this.checkToSwapThanGasFee,this.checkValueDifference,this.checkMinReceive,this.checkGasMoreThanReceive]:[this.checkThirdPartyProvider,this.checkVolatilitySlippage,this.checkBlockedRepeatOrder,this.checkFacetTokenCrossChainDetail,this.checkZeroValue,this.checkRepeatOrderWithEnoughBalance,this.checkValueDifference,this.checkMinReceive,this.checkGasMoreThanReceive]}async check(){let t=[],e=this.makeCheckers();for(let o=0;o<e.length;o++){let r=e[o],{errorType:n,continueToNextInterceptor:i}=await r.call(this)||{};if(n&&(t.push(n),!i))return t}return t}},cu=rn;u();l();P();var sn=({disabled:a})=>{let{commonStore:t,fromToStore:e,buySellStore:o,quoteStore:r}=U();if(t.portal===At.MARKET)return o.tradeMode==="BUY"?f("swaptrade_market_placeorder_btn_buy_symbol",{symbol:e.to.tokenSymbol}):f("swaptrade_market_placeorder_btn_sell_symbol",{symbol:e.from.tokenSymbol});let n=r.enableQuoteAggregates?S(r,"quote.bestRoute"):null,c=n?$n:a?mt:He;return f(e.computedIsSingleChain?c:Xn,{provider:S(n,"name")})},uu=()=>{let{commonStore:a,buySellStore:t}=U();return a.portal===At.MARKET?t.tradeMode==="BUY"?fe.TYPE.green:fe.TYPE.red:null},lu=()=>{let{commonStore:a,swapBtnStore:t,swapStore:e}=U();return a.portal===At.MARKET?e.isConfirmLoading:t.swapBtnLoading};var Bo=class{constructor(t){s(this,"swapBtnErrorTipsDialog",null);s(this,"swapInterceptor");s(this,"isInterceptionProcessing",!1);s(this,"defaultTipsDialogInfo",()=>({type:"",visible:!1,confirmCallBack:()=>{}}));s(this,"notShowAgainCrossChainConfirm",!1);s(this,"setNotShowAgainCrossChainConfirm",t=>{this.notShowAgainCrossChainConfirm=t});s(this,"tipsDialogInfo",this.defaultTipsDialogInfo());s(this,"swapBtnLoading",!1);s(this,"showErrorTips",(t,e)=>{this.tipsDialogInfo={type:t,visible:!0,confirmCallBack:e},this.setNotShowAgainCrossChainConfirm(!1)});s(this,"closeErrorTipsDialog",()=>{this.swapBtnLoading=!1,this.tipsDialogInfo.visible=!1});s(this,"openConfirmSwapDialog",(t,e)=>{let{swapStore:o}=this,{receiveAddressStore:r}=this.rootStore;r.saveWalletAddressToStorage(e),o.setConfirmSwapVisible(!0)});s(this,"connectWallet",()=>{});s(this,"approve",()=>{});s(this,"cancelApprove",()=>{});s(this,"swap",()=>{});s(this,"clickSwapOnDapp",()=>{let{from:t,to:e,computedIsSingleChain:o}=this.fromToStore,{computedNotThirdBiz:r}=this.commonStore;Ir({business_type:o?"swap":"bridge",trade_dialog:r?"no":"yes",from_token_address:t.tokenContractAddress,to_token_address:e.tokenContractAddress,swap_type:o?"discover_swap":"discover_cross_chain_swap",from_chain:t.chainName,to_chain:e.chainName}),this.rootStore.swapDappStore?.fetchDappList()});s(this,"checkDappTrade",()=>{let t=this.rootStore.swapDappStore?.checkShouldJumpToDapp;return typeof t=="function"&&t()?yo:null});s(this,"isQuoting",()=>{let{fromToStore:t,quoteStore:e,slippageStore:o}=this.rootStore,{isFetchQuoting:r,bestRoute:n,quoteError:i,quoteNull:c}=e.quote,{from:d,to:m,computedTypedValue:p}=t,{tokenContractAddress:g}=d,{computedRealSlippageValue:T}=o;return c||!n&&i&&!r||!p||!m.tokenContractAddress||!g||T>50||T<0?mt:null});s(this,"isHoneypot",()=>this.rootStore?.safeMoonStore?.computedHoneypot?mt:null);s(this,"noAmountOrOverLimit",()=>{let{fromToStore:t}=this,{overLimit:e}=this.rootStore?.safeMoonStore?.computedSlippageTips||{},{computedTypedValue:o}=t;return Number(o)===0||e?mt:null});s(this,"hasFeeConfigErrorTips",()=>this.outerStore.computedFeeConfigErrorTips?mt:null);s(this,"uninitializedWalletInfo",()=>{let{accountStore:{hasInitWalletInfo:t}}=this;return t?null:mt});s(this,"unConnectedWallet",()=>{let{accountStore:{isConnectedWallet:t}}=this;return t?null:To});s(this,"nonsupportChain",()=>{let{accountStore:{computedNonsupportChain:t}}=this;return t?mt:null});s(this,"nonsupportFacetToken",()=>{let{fromToStore:{computedNonsupportFacetToken:t}}=this;return t?mt:null});s(this,"checkReceiveAddressStatus",()=>{let{fromToStore:{computedDiffCrossChain:t}}=this,{receiveAddressStore:{checkReceiveAddressLoading:e,computedSwapHighLight:o}}=this.rootStore;return t&&!o||e?mt:null});s(this,"interceptionProcessing",()=>{let{fromToStore:t}=this;return!this.isInterceptionProcessing&&t.isBalanceLoading||t.fromBalanceState===rt.BALANCE_REQUEST_FAILED?mt:null});s(this,"balanceLessThenInputAmount",()=>this.computedTooBalance?Io:null);s(this,"approveStatus",()=>{let{approveStore:{computedApprovalStatus:t}}=this;return oi[t]||null});s(this,"isValidAmount",()=>{let{fromToStore:t}=this,{from:e,to:o}=t;return o.amount&&e.amount?He:null});s(this,"getBtnStatus",()=>{let t=[this.hasFeeConfigErrorTips,this.unConnectedWallet,this.nonsupportChain,this.nonsupportFacetToken,this.isHoneypot,this.checkDappTrade,this.checkReceiveAddressStatus,this.noAmountOrOverLimit,this.interceptionProcessing,this.balanceLessThenInputAmount,this.isQuoting,this.approveStatus,this.isValidAmount],e;for(let o of t){let r=o();if(r){e=r;break}}return e||(e=mt),e});s(this,"checkIsCurrentQuote",()=>(this.computedIsCurrentQuote||D.warn({title:f("swaptrade_mid_toast_tryagain_with_newquote")}),this.computedIsCurrentQuote));let{accountStore:e,fromToStore:o,swapStore:r,commonStore:n,quoteStore:i,approveStore:c}=t;this.rootStore=t,this.accountStore=e,this.fromToStore=o,this.swapStore=r,this.commonStore=n,this.quoteStore=i,this.approveStore=c,this.swapInterceptor=new cu(t),Object.assign(this,t)}async runSwapInterceptor(t){this.isInterceptionProcessing=!0;let[e,o]=await _(this.swapInterceptor.check());if(this.isInterceptionProcessing=!1,e){y.error(v.UPDATE_BTC_BALANCE_ERROR_BEFORE_SWAP,{error:e});return}if(o.length===0){t();return}let r=-1,n=()=>{r++;let i=r===o.length-1;this.showErrorTips(o[r],i?t:n)};n()}getBtnAllStatus({from:t}){return{[To]:{statusType:To,disabled:!1,toLocaleText:()=>f(To),onClick:this.connectWallet},[Io]:{statusType:Io,disabled:!0,toLocaleText:()=>f(Io,{tokenSymbol:W(t.tokenSymbol)}),symbol:t.tokenSymbol},[or]:{statusType:or,disabled:!1,toLocaleText:()=>f(or,{tokenSymbol:W(t.tokenSymbol)}),onClick:()=>{this.quoteStore.setAggregateSelectStatus(1),this.approve()},icon:"okx-defi-dex-authorization",iconType:fe.ICON_POSITION.leading},[Co]:{statusType:Co,loading:!0,disabled:!0,toLocaleText:()=>f(Co)},[_s]:{statusType:Co,disabled:!1,toLocaleText:()=>f(_s,{ccy:t.tokenSymbol}),onClick:this.cancelApprove,icon:"okx-defi-dex-authorization",iconType:fe.ICON_POSITION.leading},[rr]:{statusType:rr,loading:!0,disabled:!0,toLocaleText:()=>f(rr)},[mt]:{statusType:mt,disabled:!0,toLocaleText:()=>sn({disabled:!0})},[He]:{statusType:He,disabled:!1,loading:lu(),toLocaleText:()=>sn({disabled:!1}),onClick:()=>{this.quoteStore.setAggregateSelectStatus(1),this.swap()},type:uu()},[yo]:{statusType:yo,disabled:!1,loading:this.rootStore.swapDappStore?.swapOnDappBtnLoading,toLocaleText:()=>f(yo),icon:"okds-open-link",iconType:fe.ICON_POSITION.leading,onClick:this.clickSwapOnDapp}}}get needToCrossChainDoubleCheck(){return!0}get computedTooBalance(){let{rootStore:t,fromToStore:e,accountStore:o}=this,{isConnectedWallet:r}=o,n=e.from.balance,i=t.safeMoonStore.computedInputVal;return r?I.BigNumber(n||0).isLessThan(i):!1}get computedBtnStatus(){let{fromToStore:t}=this,{from:e}=t,o=this.getBtnStatus();return this.getBtnAllStatus({from:e,swapLoading:this.swapBtnLoading})[o]}get computedIsCurrentQuote(){let{fromToStore:t,quoteStore:e}=this,{computedIsExactIn:o,computedTypedValue:r}=t,{quote:n,getGasTokenFeeLoading:i}=e,{fromTokenAmount:c="",inputToTokenAmount:d=""}=n?.bestRoute||{},m=!!r,p=m&&o&&I.BigNumber(r).isEqualTo(c),g=m&&!o&&I.BigNumber(r).isEqualTo(d);return!i&&(p||g)}};u();l();var du=xt(["tipsDialogInfo","notShowAgainCrossChainConfirm","isInterceptionProcessing","swapBtnLoading"],["computedTooBalance","computedBtnStatus","computedIsCurrentQuote"]);u();l();var an=()=>{let{accountStore:a}=U();_a({wallet_address:a.address,...Ma()})};var Ne=class extends Bo{constructor(e){super(e);s(this,"handleSwap",async()=>{let{quote:e,computedIsOfflineType:o}=this.quoteStore,{receiveAddressStore:r,swapStore:n}=this.rootStore;if(this.swapBtnLoading=!0,this.walletContractStore.setQuoteData(e.bestRoute),!o){let d=await this.walletContractStore.fetchCallData();if(this.swapBtnLoading=!1,d)return}this.swapBtnLoading=!1;let i=o?bt.INTENT_SWAP:bt.SWAP;r.saveWalletAddressToStorage(this.fromToStore?.to);let{fromToken:c}=Dn.get(e,"bestRoute",{});if(n.isSwapSolana(c.chainId)){R.history?.push({pathname:Ze});return}R.history?.push({pathname:Ft,search:`needUpdate=${ir.on}&type=${i}`})});s(this,"swap",async()=>{let e=this.checkIsCurrentQuote();Ir({wallet_address:this.accountStore.address,button_name:"confirm",...ut()}),e&&(this.swapBtnLoading=!0,this.runSwapInterceptor(this.handleSwap))});s(this,"approve",async()=>{this.approveStore.updateCurrentApproveTokenConfig({status:B.Approving});let e=await R.checkMpcAccountIfNecessary();if(an(),!e){this.approveStore.updateCurrentApproveTokenConfig({status:B.UnApproved});return}this.approveStore.setApprove()});s(this,"cancelApprove",async()=>{this.approveStore.updateCurrentApproveTokenConfig({status:B.CancelApproving});let e=await R.checkMpcAccountIfNecessary();if(an(),!e){this.approveStore.updateCurrentApproveTokenConfig({status:B.CancelApprove});return}this.approveStore.setApprove(je.CANCEL_APPROVE)});this.walletContractStore=e.walletContractStore,Rt(this,du)}};u();l();u();l();P();M();u();l();P();var Gl=/\s/,mu=a=>!(!Zo(a)||Gl.test(a)||a.length<10);u();l();P();var Kl=I.mul(.5,100),Yl=I.mul(.1,100),cn=a=>{let t=S(a,"quoteStore.quote.bestRoute.autoSlippageInfo",{}),{computedDefaultAutoSlippageInfo:e}=a.fromToStore;return{...e,...t}},Uo=({isSingleChain:a,autoSlippageInfo:t})=>{let{autoSlippage:e,autoTotalSlippage:o}=t||{};return a?e||.01:o||.03},Xr=a=>{let t=a.fromToStore.computedIsSingleChain,e=cn(a),o=Uo({isSingleChain:t,autoSlippageInfo:e});return I.mul(I.ceilTruncate(o,3,!1),100)},$l=a=>{let t=Yt(a);if(t.indexOf(".")>-1){let e=t.split("."),o=e[0],r=e[1];r&&r.length>1&&(r=r.slice(0,1)),t=`${o}.${r}`}return J(t)},zr=({inputSlippageParams:a,computedSafeMoonTips:t,minSlippageShow:e,maxSlippageShow:o=Kl,autoSlippageValue:r=0,isSingleChain:n=!0})=>{let{safeMoonSlippage:i=0,overLimit:c,equalLimit:d}=t||{};if(a===""&&!t)return{slippage:0,inputValue:"",notice:"",isError:!1};let m=$l(a),p="",g=!1,T=!1;return t?.safeMoonSlippage?c||d||I.BigNumber(m).isZero()?p="":e>m?(p=f("swaptrade_settings_errortip_minimum_slippage",{cross:Bt(e,{needZero:!1})}),g=!0,m=i):i>m?(p=f("swaptrade_settings_errortip_lowslippage_failed",{auto:Bt(i,{needZero:!1})}),T=!0):m>o&&(p=f("swaptrade_card_swap_advance_options_exceeding_desc",{num:Bt(o,{needZero:!1})}),g=!0,m=i):me(m)?(m="",g=!0):m<e?(p=f(n?"swaptrade_dialog_modal_singlechain_limit":"swaptrade_dialog_modal_crosschain_limit",{value:I.thousandFormat(e)}),g=!0):m<r?(p=f("swaptrade_dialog_modal_transaction_failure"),g=!1):m>=Yl&&m<=o?(p=f("swaptrade_adjustslip_modalhint_actual_amount_less",{value:Bt(m,{needZero:!1})}),g=!1):m>o&&(m=o,p=f("swaptrade_card_swap_advance_options_exceeding_desc",{num:Bt(o,{needZero:!1})}),g=!0),{slippage:m,inputValue:a!==""?Yt(m):"",notice:p,isError:g,isWarning:T}},pu=({slippageInfo:a,isSingleChain:t})=>{let{autoSlippageInfo:e,customSlippage:o}=a,r={};return t?o||(r=pe(e,["autoSlippage"])):r=pe(e,["autoFromSlippage","autoToSlippage","autoTotalSlippage"]),Object.keys(r).forEach(i=>{let c=r[i],d=I.ceilTruncate(c,3,!1);r[i]=I.toPlainString(Number(d))}),{customSlippage:o,autoSlippageInfo:r}};var qo=class{constructor(t){s(this,"defaultGasFee","--");s(this,"isWalletConfirm",!1);s(this,"setWalletConfirm",t=>{this.isWalletConfirm=t});s(this,"isConfirmLoading",!1);s(this,"txInfo",{});s(this,"resetTxInfo",()=>{this.txInfo={}});s(this,"showRecentTransactionModal",t=>{this.confirmSwapVisible=!1,this.rootStore.recentTransactionStore.showModal(t)});s(this,"saveOrderParamsExtendSlippageAndGasPrice",t=>{let e={...t},{computedQuote:o,fromToStore:r}=this,{computedIsSingleChain:n,computedDefaultAutoSlippageInfo:i}=r,{autoSlippageInfo:c}=o.bestRoute||{},d=Uo({isSingleChain:n,autoSlippageInfo:i}),m={autoSlippageInfo:c||{}},p=S(this,"rootStore.slippageStore");return p&&(d=p.computedRealSlippageValue,m=p.getOrderSlippageInfo()),Object.assign(e,{slippage:String(d),...pu({slippageInfo:m,isSingleChain:n})})});s(this,"baseSaveOrderParams",()=>{let{accountStore:t,computedQuote:e,fromToStore:o,quoteStore:r,gasDropStore:n}=this,{from:i,to:c}=o,{estimateGasFee:d,minimumReceived:m,gasDropAmount:p,defiPlatformId:g,traceData:T}=e.bestRoute||{},{computedIsMevOpen:A}=this.rootStore.mevStore,w={chainId:i.chainId,fromAmount:I.BigNumber(r?.computedQuoteAmount).toString(10),fromTokenAddress:i.tokenContractAddress,fromTokenDecimal:String(i.decimals),toAmount:c.reverseReceiveAmount,toTokenAddress:c.tokenContractAddress,toTokenDecimal:String(c.decimals),userWalletAddress:t.address,estimateGasFee:d,pmm:"1",gasDropType:n?.computedGasDropSelected?1:0,gasDropAmount:p,minimumReceived:m,openMev:A,toChainId:c.chainId,traceData:T};g&&(w.defiPlatformId=g);let N=this.rootStore.outerStore.extendFeeConfig(w);return this.saveOrderParamsExtendSlippageAndGasPrice(N)});s(this,"saveOrderSingleChainParams",t=>{let{computedQuote:e}=this,{originDexRouterList:o,dexRouterList:r}=e.bestRoute||{};return{...t,dexRouterList:r,originDexRouterList:o}});s(this,"saveOrderCrossChainParams",t=>{let{computedQuote:e,fromToStore:o}=this,{receiveAddressStore:r}=this.rootStore,{to:n,computedDiffCrossChain:i}=o,{receiveAddrObj:c}=r,{fromDexRouterList:d,bridge:m,toDexRouterToList:p,originFromDexRouterList:g}=e.bestRoute||{};return{...t,toChainId:n.chainId,crossChainDexRouter:{fromDexRouterList:d,toDexRouterToList:p,bridge:m,originFromDexRouterList:g},...i?{receiveWalletAddress:c?.specifiedAddress}:{}}});s(this,"saveOrderParams",()=>{let{fromToStore:t}=this,{computedIsSingleChain:e}=t,o=this.baseSaveOrderParams();return e?this.saveOrderSingleChainParams(o):this.saveOrderCrossChainParams(o)});s(this,"calldataSign",null);s(this,"setCalldataSign",t=>{this.calldataSign=t});s(this,"extendSignParams",async t=>{let e={...t},o=S(this.quoteStore,"quote.bestRoute.permit2Data");if(o&&!this.calldataSign){let[r,n]=await this.checkPermit2();if(r)return null;this.setCalldataSign(n),e={...e,unsignedTx:o?.unsignedTx,signature:n}}else o&&this.calldataSign&&(e={...e,unsignedTx:o?.unsignedTx,signature:this.calldataSign});return e});s(this,"checkPermit2",async()=>{let t=S(this.quoteStore,"quote.bestRoute.permit2Data"),e=S(this.quoteStore,"quote.bestRoute.fromToken.chainId"),{signTransaction:o}=this.rootStore.sendTransactionStore,r=t?.unsignedTx,[n,i]=await o(r,e);return n&&(y.error(v.SIGN_PERMIT2_DATA,{error:n,unsignedTx:r}),Do(n)||Qt.error({title:f("swaptrade_trading_mode_alert_order_fail")})),[n,i]});s(this,"resetFromToAmount",()=>{this.fromToStore.updateFrom({amount:"",currentTime:"",prevAmount:"",usdPrice:""}),this.fromToStore.updateTo({amount:"",prevAmount:"",usdPrice:"",currentTime:""}),this.fromToStore.advanceSetTypedValue("")});s(this,"transferBtcPayload",t=>{let e={...t},{from:o}=this.fromToStore;return e.value=eo(e.value,o.decimals),e});s(this,"getExtParams",t=>{let{computedIsSingleChain:e,to:o,from:r,computedDiffCrossChain:n}=this.fromToStore,{receiveAddrObj:i}=this.rootStore.receiveAddressStore,c=n?i?.specifiedAddress:o.tokenContractAddress;return{txSource:3,orderId:t,toTokenAddress:c,crossChain:e?0:1,chainId:r.chainId,tokenAddress:r.tokenContractAddress,amount:r.amount,toChainId:o.chainId}});s(this,"confirmSwapVisible",!1);s(this,"setConfirmSwapVisible",t=>{this.confirmSwapVisible=t});s(this,"isSwapSolana",t=>!!(Lr(t)&&this.rootStore.solanaPriorityFeeStore?.jitoData));s(this,"extendSolanaCalldata",t=>{let{feeType:e,customFee:o,computedPriorityFeeList:r}=this.rootStore.solanaPriorityFeeStore||{},n=r.find(c=>c.type===e),i=o||n.fee;return{...t,tradeMode:2,priorityFee:i,customPriorityFee:!!o}});s(this,"solanaSwapParams",null);s(this,"setSolanaSwapParams",t=>{this.solanaSwapParams=t});s(this,"getSolanaCalldata",t=>(this.setSolanaSwapParams(t),_(C.post(Tr,t))));s(this,"solanaTransaction",async(t,e)=>{let{from:o}=this.fromToStore,{computedAccountId:r}=this.accountStore,i=await Mo(o,{orderData:t,extParams:{}},this).jitoTransaction(),c=i.map(p=>p.payload.transaction),[d,m]=await _(this.rootStore.sendTransactionStore.signAllTransactions(c));if(d){this.onWalletFail(d,t?.orderId),this.isConfirmLoading=!1,y.removeKeep();return}await this.sendSolanaTransaction({signedTransactions:m,txArray:i,swapParams:e,walletId:r,enableJito:t.jitoEnable})});s(this,"sendSolanaTransaction",async({signedTransactions:t,txArray:e,swapParams:o,walletId:r,enableJito:n})=>{let[i,c]=await _(zc({signedTransactions:t,txArray:e,swapParams:o,walletId:r,enableJito:n}));if(this.isConfirmLoading=!1,y.removeKeep(),!i){let d=S(c,"data.broadcastResult.data.orderId");this.afterTransaction(d)}});this.rootStore=t,this.commonStore=t.commonStore,this.accountStore=t.accountStore,this.fromToStore=t.fromToStore,this.tokenModalStore=t.tokenModalStore,this.quoteStore=t.quoteStore,this.gasDropStore=t.gasDropStore}get computedEstimateGasFee(){let t=this.defaultGasFee,e=this.commonStore.nowCurrencyUnit,o=S(this.computedQuote.bestRoute,"quoteNetWorkFeeOfMoney");if(this.isSwapSolana(this.fromToStore.from.chainId)&&this.quoteStore.enableQuoteAggregates){let n=S(this.rootStore.solanaPriorityFeeStore,"computedPriorityFeeOfUsd",0);o=I.add(n,o,{returnString:!0})}let r=I.BigNumber(o).multipliedBy(S(e,"usdToThisRate"));return!Y(e)&&!r.isNaN()&&(t=at(r.toJSON(),e?.symbol)),t}get computedCrossChainFromFee(){let t=S(this.computedQuote.bestRoute,"fromSwapFeeUsd");if(!t||me(Number(t)))return"--";let{computedNowCurrencySymbol:e,currencyConversion:o}=this.commonStore,r=o(t).toString();return`${at(r,e)}`}updateTxHash(t){this.rootStore.sendTransactionStore.updateTxHash(t)}cancelOrder(t){t&&this.rootStore.sendTransactionStore.cancelOrder(t)}saveOrderUrl(){return fr}onSaveOrder(t){return y.info(v.SAVE_ORDER_PARAMS,{data:t}),C.post(this.saveOrderUrl(),t)}saveOrderErr(t){let{error_code:e,error_message:o=""}=t,r=t?.data?.code||e||"";return y.error(v.SAVE_ORDER_ERROR,{error:t,tags:{errorCode:e||r,error_msg:`${v.SAVE_ORDER_ERROR}_${r}`}}),e==="10014"?Qt.error({title:f("swaptrade_toast_trade_not_available")}):Qt.error({title:o||f("swaptrade_toast_save_order_fail")})}saveOrderError(t){this.saveOrderErr(t),this.isConfirmLoading=!1,y.removeKeep()}async onSwap(t){this.isConfirmLoading=!0,y.keepLive(),this.setCalldataSign(null);let e=this.saveOrderParams(),o=await this.extendSignParams(e);if(!o){this.isConfirmLoading=!1;return}if(this.isSwapSolana(o.chainId)){await this.onSolanaSwap(o);return}let[r,n]=await _(this.onSaveOrder(o));if(r){this.saveOrderError(r);return}y.info(v.SAVE_ORDER,{data:n?.data,tags:{orderId:n?.data.orderId}}),ro({...ut(),order_id:n?.data.orderId,wallet_type:this.accountStore.walletConfig?.walletType});let[i]=await _(this.onChainTransaction({...n?.data,swapParams:o},t));i&&this.onWalletFail(i,n?.data?.orderId),this.isConfirmLoading=!1,y.removeKeep()}walletErrorMessage(t){let e=null;try{e=JSON.parse(t?.message)}catch{e={}}return e}walletErrToast(t,e){let o,r=this.walletErrorMessage(t);return y.error(v.SEND_ERROR,{error:t,tags:{orderId:e}}),r?.code===te.SLIPPAGE_LOW?o=f("swaptrade_home_toast_slippage_too_low"):r?.code===te.SEND_TX_ERROR_CODE&&(o=r?.message),Qt.error({title:o||f("swaptrade_home_toast_broadcast_failed")})}onWalletFail(t,e){Do(t)?this.cancelOrder(e):t?.code!==di.RECEIPT_ERROR&&(vo.emit(bo.FAIL,{data:{orderId:e},status:-2,message:ks("transaction fail")}),this.walletErrToast(t,e)),y.error(v.ON_WALLET_FAIL,{error:t,tags:{orderId:e}})}extendEvmParams(t){return t}isOkxWallet(){}async getTransactionPayload({orderData:t,orderId:e}){let{from:o}=this.fromToStore;return Mo(o,{orderData:t,extParams:this.getExtParams(e)},this).getSendTransactionParams()}sendTransactionEnhance(...t){return this.rootStore.sendTransactionStore.sendTransaction(...t)}getTransaction(){}logChainId(){}async doubleCheckChainId(){return!0}async onChainTransaction(t,e){let{callData:o,orderId:r,swapParams:n}=t,i=await this.getTransactionPayload({orderData:t,orderId:r}),{computedIsEvmChain:c,from:d}=this.fromToStore;if(y.info(v.PAYLOAD,{payload:i,tags:{orderId:r}}),e)try{await e(...i)}catch(p){return y.error(v.BEFORE_SEND_TRANSACTION_ERROR,{error:p}),!1}return this.logChainId({message:v.CHECK_CHAIN_ID_BEFORE_SEND_TRANSACTION,fromChainId:d.chainId,saveOrderChainId:n.chainId,orderId:r}),await this.doubleCheckChainId({saveOrderChainId:n.chainId,orderId:r})?this.sendTransactionEnhance(...i).then(({result:p,nonce:g})=>{if(!mu(p))throw new Error(`hash format is invalid: ${p}`);return this.txInfo={...o,txHash:p},I.BigNumber(g).isNaN()?(this.updateTxHash({orderId:r,transactionHash:p}),c&&this.getTransaction(p,this.fromToStore.from.chainId).then(T=>{y.info(v.UPDATE_NONCE,{nonce:T.nonce,tags:{orderId:r}}),this.updateTxHash({orderId:r,transactionHash:p,nonce:T.nonce})}).catch(T=>{y.error(v.UPDATE_NONCE_FAIL,{error:T})})):this.updateTxHash({orderId:r,transactionHash:p,nonce:g}),this.afterTransaction(r),this.logChainId({message:v.CHECK_CHAIN_ID_AFTER_SEND_TRANSACTION,fromChainId:d.chainId,saveOrderChainId:n.chainId,orderId:r}),!0}):!1}afterTransaction(t){this.setWalletConfirm(!0),this.showRecentTransactionModal(t),vo.emit(bo.TXHASH,{status:0,data:q(this.txInfo),message:ks("Transaction hash has been generated")})}get computedQuote(){return this.quoteStore.quote}checkRepeatOrderDetail(t){t&&this.rootStore.recentTransactionStore.showModal(t)}async onSolanaSwap(t){let e=this.extendSolanaCalldata(t),[o,r]=await this.getSolanaCalldata(e);if(o){this.saveOrderError(o);return}y.info(v.SAVE_ORDER,{data:r?.data,tags:{orderId:r?.data.orderId}}),ro({...ut(),order_id:r?.data.orderId,wallet_type:this.accountStore.walletConfig?.walletType}),await this.solanaTransaction(r.data,e)}};u();l();var hu=xt(["isWalletConfirm","isConfirmLoading","txInfo","confirmSwapVisible"],["computedEstimateGasFee","computedCrossChainFromFee","computedQuote"]);var De=class extends qo{constructor(e){super(e);s(this,"sendTransactionEnhance",e=>{let{computedIsSolanaChain:o,computedIsTronChain:r,computedIsAptosChain:n,computedIsSuiChain:i,computedIsStacksChain:c,computedIsStarknetChain:d,computedIsFromBtcCoin:m}=this.rootStore?.fromToStore,{from:p}=this.rootStore?.fromToStore,{walletSendParams:g}=this.rootStore.walletContractStore;return this.rootStore.sendTransactionStore.sendTransaction(p.chainId,e,g).then(T=>{let A,w;if(o)A=T.signature;else if(r){let{transaction:N}=T;A=N?.txID}else if(n)A=T;else if(i)A=T;else if(c)A=T.txHash;else if(d)A=T.transaction_hash;else if(m)A=T;else if(sc(p.chainId))A=T.txHash;else{let{hash:N,nonce:O}=T;A=N,w=O}return{result:A,nonce:w}})});s(this,"showRecentTransactionModal",e=>{this.isConfirmLoading=!1,this.confirmSwapVisible=!1,R.history.replace(`${Te}/${e}`)});s(this,"extendsGas",e=>{let o={...e},{gasInfo:r}=this.rootStore.walletContractStore,{gasLimitInfo:n,isGasLimitLoading:i,gasType:c,...d}=r;return o.extParams.gasType=c,{...o,gasInfo:d}});s(this,"extendEvmParams",e=>{let o=super.extendEvmParams(e),{activityId:r}=this.rootStore.walletContractStore,n=this.rootStore.quoteStore.quote?.bestRoute?.isEnableMev;r&&(o.extParams.activityId=r);let{computedIsMevOpen:i,mevInfo:c}=this.rootStore.mevStore;return i&&(o.extParams.isMev=!0,o.extParams.mevInfo=c),!i&&Number(n)===si.ON&&(o.extParams.isShowBlockSwapMevTooltip=!0),o});s(this,"onWalletFail",(e,o)=>{this.isConfirmLoading=!1,!e?.message?.includes(R.global?.HARDWALLETERROR)&&super.onWalletFail(e,o)});s(this,"checkRepeatOrderDetail",e=>{e&&R.history.push(`${Te}/${e}`)});s(this,"checkUtxoBeforePublish",async e=>{let{utxoList:o}=e,{preDataForSendBtc:r}=this.rootStore.walletContractStore,{checkUtxoBeforePublish:n}=r;await n(o)});s(this,"onSwap",async()=>{this.isConfirmLoading=!0;let e=await R.checkMpcAccountIfNecessary();if(this.isConfirmLoading=!1,!e)return;let{computedIsOfflineType:o}=this.rootStore.quoteStore,{computedIsFromBtcCoin:r}=this.rootStore?.fromToStore;o?await this.rootStore.intentSwapStore?.onIntentSwap():await super.onSwap(r?this.checkUtxoBeforePublish:null)});s(this,"getSaveOrderMonitorData",()=>({...ut(),...this.rootStore.walletContractStore.computedMonitorGasType}));Rt(this,hu)}isOkxWallet(){return!0}getTransaction(){}walletErrorMessage(e){return e}};u();l();P();P();u();l();P();P();M();u();l();u();l();var fu=function(){return new Promise(function(t){setTimeout(t,1)})};u();l();var uo=b(x());u();l();var Xl={[E.SWAP]:"swap_used_chain_cache",[E.LIMIT_ORDER]:"limit_used_chain_cache",[E.BRIDGE]:"bridge_used_chain_cache"},gu=(a,t,e)=>{let o=Xl[e],r=F.get(o)||[];if(r.length===0&&(r=t.slice(0,4).map(i=>i.chainId)),a.forEach(n=>{r.includes(n)||r.unshift(n)}),r=r.filter(n=>t.find(i=>i.chainId===n)),r.length<4)for(let n=0;n<t.length&&r.length<4;n++)r.includes(t[n].chainId)||r.push(t[n].chainId);return r.length>4&&(r=r.slice(0,4)),F.set(o,r),r};u();l();var Vo=class{constructor(t){s(this,"id",1);s(this,"tokenSymbol","--");s(this,"tokenName","--");s(this,"decimals",6);s(this,"tokenContractAddress","");s(this,"tokenLogoUrl","");s(this,"type","");s(this,"amountNum",0);s(this,"currencyAmount",0);L(this),Object.assign(this,t),this.tokenModalStore=U().tokenModalStore}get computedPrice(){let{nowCurrencyUnit:t}=this.tokenModalStore.commonStore,{symbol:e,usdToThisRate:o}=t,r=I.BigNumber(this.currencyAmount);return r.isNaN()||r.isZero()?`${e||""}0.00`:e&&o&&!r.isNaN()&&!r.isZero()?at(r.multipliedBy(o).toJSON(),e):"0"}get computedIsSelect(){let{equalsToken:t}=this.tokenModalStore.commonStore,{from:e,to:o}=this.tokenModalStore.fromToStore;return this.tokenModalStore.tokenModalFromState===k.FROM?t(this,o):t(this,e)}get computedIsSelectOrigin(){let{from:t,to:e}=this.tokenModalStore.fromToStore,{equalsToken:o}=this.tokenModalStore.commonStore;return this.tokenModalStore.tokenModalFromState===k.FROM?o(this,t):o(this,e)}get computedAmountNum(){return this.amountNumBigDecimal!==""?this.amountNum:0}toJSON(){return q(this)}};u();l();var Wo=(a={})=>({...gt,logoUrl:gt.logoUrl(),chainName:f(gt.localKey),...a}),Jr=(a={})=>{let t=Gn();return{...kt,get logoUrl(){return t===Wn.dark?kt.darkLogoUrl():kt.logoUrl()},chainName:f(kt.localKey),...a}};var Su="hide_collect_cancel_dialog",Tu="hideTokenGuide",Me=class{constructor(t){s(this,"searchValue","");s(this,"setSearchValue",t=>{this.searchValue=t});s(this,"fromTokenList",new Map);s(this,"toTokenList",new Map);s(this,"searchTokenList",{});s(this,"error",!1);s(this,"tokenModalVisible",!1);s(this,"tokenModalFromState",k.FROM);s(this,"setTokenModalFromState",t=>{this.tokenModalFromState=t});s(this,"loading",{[k.FROM]:{},[k.TO]:{}});s(this,"initLoading",()=>{this.loading={[k.FROM]:{},[k.TO]:{}}});s(this,"importTokenInfo",{});s(this,"setImportTokenInfo",t=>{this.importTokenInfo={...t}});s(this,"toSelectedChainId","");s(this,"fromSelectedChainId","");s(this,"setToSelectedChainId",t=>{this.toSelectedChainId=t});s(this,"setFromSelectedChainId",t=>{this.fromSelectedChainId=t});s(this,"extendTokens",(t,e)=>t.filter(o=>this.commonStore.getChainByID(J(o.chainId))).map(o=>{let r=new Vo(o,this);return{...o,balance:r.computedAmountNum,selected:r.computedIsSelect,selectedOrigin:e?r.computedIsSelectOrigin:!1,price:r.computedPrice}}));s(this,"extendTokenList",(t=[],e=!0)=>Y(t)?t:this.extendTokens(t,e));s(this,"importUserToken",Jt(function*(e,o=!0){let r=e.map(c=>{let{chainId:d,tokenContractAddress:m,tokenSymbol:p,decimals:g}=c;return{chainId:d,contractAddress:m,tokenSymbol:p,precision:g}}),n={userUniqueId:this.commonStore.userUniqueId,tokenDetailList:r},i=[];try{i=(yield C.post(hr,n)).data}catch(c){throw D.error(f("swaptrade_pricechart_no_connection_desc")),c}return o&&(this.searchValue="",this.changeTokenModalVisible(!1)),i}));s(this,"sortTokens",t=>Pn(t,[e=>Number(e.topPlacement),e=>Number(e.currencyAmount),e=>Number(e.amountNum),e=>Number(e.isCollectToken),e=>Number(e.collectTime)],["desc","desc","desc","desc","desc"]));s(this,"orderTokenList",t=>this.computedIsCollectChain?t:this.commonStore.currentTab===E.BRIDGE?t.map(e=>({...e,tokenList:this.sortTokens(e.tokenList)})):this.sortTokens(t));s(this,"formatTokenList",(t,e)=>{let o=t;t.length>100&&e!==gt.chainId&&(o=t.slice(0,100));let r=this.extendTokenList(o,!0);return this.orderTokenList(r)});s(this,"changeTokenModalVisible",t=>{this.tokenModalVisible=t});s(this,"clearCacheTokenList",()=>{});s(this,"getTokenListByChainId",async()=>{let t=this.tokenModalFromState===k.FROM,e={};if(this.clearCacheTokenList(),this.tokenModalFromState===k.FROM?e={fromChainId:this.fromSelectedChainId}:this.tokenModalFromState===k.TO&&(e={fromChainId:this.fromToStore.from.chainId,toChainId:this.toSelectedChainId}),this.tokenModalFromState===k.FROM&&Number(this.fromSelectedChainId)===kt.chainId){this.getFromAllNetworksTokens();return}if(this.tokenModalFromState===k.TO&&Number(this.toSelectedChainId)===kt.chainId){this.getToAllNetworksTokens(e.fromChainId);return}if(this.tokenModalFromState===k.FROM&&Number(this.fromSelectedChainId)===gt.chainId){this.getFromCollectedTokens();return}if(this.tokenModalFromState===k.TO&&Number(this.toSelectedChainId)===gt.chainId){this.getToCollectedTokens(e.fromChainId);return}t?this.getTokenList(k.FROM,e.fromChainId):this.getTokenList(k.TO,e.toChainId,e.fromChainId)});s(this,"setTokenList",(t,e,o)=>{let r=this.formatTokenList(e,t);this[`${o}TokenList`].set(t,r)});s(this,"cancelGetTokenListRef",null);s(this,"handleTokenList",Jt(function*(e,o,r,n){this.setError(!1),this.cancelGetTokenListRef&&this.cancelGetTokenListRef.abort(),this[`${e}TokenList`].get(o)||this.setLoading(e,o,!0),this.cancelGetTokenListRef=$();try{let{data:i}=yield C.get(r,{params:n,signal:this.cancelGetTokenListRef?.signal}),c=this.toLowerCaseContractAddress(i);return this.setTokenList(o,c,e),this.setLoading(e,o,!1),{data:c}}catch(i){return this.isCancel(i)?null:(this.setTokenList(o,[],e),this.setLoading(e,o,!1),this.setError(!0),i)}}).bind(this));s(this,"getCrossChainParams",(t,e,o)=>{switch(t){case E.BRIDGE:return{fromChainId:e.fromChainId??e?.chainId,userUniqueId:e.userUniqueId,accountId:e.accountId,userWalletAddress:e.userWalletAddress,...o,toChainId:o.toChainId===-1?"":o?.toChainId};case E.SWAP:default:return e}});s(this,"getTokenList",Jt(function*(e,o,r){let n={fromChainId:r,chainId:o,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,userWalletAddress:this.accountStore.computedSpecialWalletAddress};this.commonStore?.computedCurrentTabIsLimit&&(n={...n,businessLine:ee.LIMIT_ORDER});let i=this.getCrossChainParams(this.commonStore.currentTab,n,{selectChainType:this.getCrossChainSelectChainType(),toChainId:this.computedCurrentToChainId,fromTokenAddress:this.fromToStore.from.tokenContractAddress||""}),c=J(o);if(this.computedIsNotSupportToChain)return this.setTokenList(c,[],e),{data:[]};let d=Kt(It.ALL_TOKENS,this.commonStore.currentTab);return yield this.handleTokenList(e,c,d,i)}));s(this,"getFromCollectedTokens",Jt(function*(){let e={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:"",userWalletAddress:this.accountStore.computedSpecialWalletAddress};this.commonStore?.computedCurrentTabIsLimit&&(e={...e,businessLine:ee.LIMIT_ORDER});let o=this.getCrossChainParams(this.commonStore.currentTab,e,{selectChainType:Ae.FROM,toChainId:this.computedCurrentToChainId,fromTokenAddress:""}),r=Kt(It.COLLECT_LIST,this.commonStore.currentTab);return yield this.handleTokenList(k.FROM,gt.chainId,r,o)}));s(this,"getToCollectedTokens",Jt(function*(e){let o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:e,chainId:e,userWalletAddress:this.accountStore.computedSpecialWalletAddress};this.commonStore?.computedCurrentTabIsLimit&&(o={...o,businessLine:ee.LIMIT_ORDER});let r=this.getCrossChainParams(this.commonStore.currentTab,o,{selectChainType:Ae.TO,toChainId:"",fromTokenAddress:this.fromToStore.from.tokenContractAddress}),n=Kt(It.COLLECT_LIST,this.commonStore.currentTab);return yield this.handleTokenList(k.TO,gt.chainId,n,r)}));s(this,"getFromAllNetworksTokens",Jt(function*(){let e={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:"",userWalletAddress:this.accountStore.computedSpecialWalletAddress};this.commonStore?.computedCurrentTabIsLimit&&(e={...e,businessLine:ee.LIMIT_ORDER});let o=Kt(It.ALL_NETWORK,this.commonStore.currentTab),r=this.getCrossChainParams(this.commonStore.currentTab,e,{selectChainType:Ae.FROM,toChainId:this.computedCurrentToChainId,fromTokenAddress:""});return yield this.handleTokenList(k.FROM,kt.chainId,o,r)}));s(this,"getToAllNetworksTokens",Jt(function*(e){let o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,fromChainId:e,userWalletAddress:this.accountStore.computedSpecialWalletAddress};this.commonStore?.computedCurrentTabIsLimit&&(o={...o,businessLine:ee.LIMIT_ORDER});let r=Kt(It.ALL_NETWORK,this.commonStore.currentTab),n=this.getCrossChainParams(this.commonStore.currentTab,o,{selectChainType:Ae.TO,toChainId:"",fromTokenAddress:this.fromToStore.from.tokenContractAddress});return yield this.handleTokenList(k.TO,kt.chainId,r,n)}));s(this,"cancelSearchRef",null);s(this,"needRemoveChainId",t=>[kt.chainId,gt.chainId].includes(J(t)));s(this,"getSearchChainType",()=>{let t=nr.SINGLE;return this.computedCurrentChainId===kt.chainId&&(t=nr.ALL_NETWORK),this.computedCurrentChainId===gt.chainId&&(t=nr.COLLECT),t});s(this,"getCrossChainSearchType",()=>this.computedCurrentChainId===gt.chainId?Qs.COLLECTION:Qs.COMMON);s(this,"getCrossChainSelectChainType",()=>this.tokenModalFromState===k.FROM?Ae.FROM:Ae.TO);s(this,"singleSearchParams",t=>{let e=this.getSearchChainType(),o={userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,chainType:e,searchType:e,userWalletAddress:this.accountStore.computedSpecialWalletAddress},r={},n={};return this.tokenModalFromState===k.FROM?(r={inputContent:t,fromChainId:this.fromSelectedChainId,chainId:this.fromSelectedChainId,toChainId:this.fromSelectedChainId},this.needRemoveChainId(this.fromSelectedChainId)&&(delete r.fromChainId,delete r.toChainId,delete r.chainId)):this.tokenModalFromState===k.TO&&(n={inputContent:t,fromChainId:this.fromToStore.from.chainId,chainId:this.fromToStore.from.chainId,toChainId:this.toSelectedChainId,fromTokenAddress:this.fromToStore.from.tokenContractAddress||""},this.needRemoveChainId(this.toSelectedChainId)&&(delete n.toChainId,delete r.chainId)),{...o,...r,...n}});s(this,"getSearchTokenList",async()=>{if(this.searchValue==="")return;if(this.cancelSearchRef&&this.cancelSearchRef.abort(),this.computedIsNotSupportToChain){this.setSearchTokenList({}),this.setLoading(this.tokenModalFromState,"search",!1);return}this.cancelSearchRef=$(),this.setLoading(this.tokenModalFromState,"search",!0),this.setError(!1);let t=Cs(this.searchValue),e=this.getSearchParams(t);ka({keyword:t});let o=Kt(It.SEARCH,this.commonStore.currentTab),r=this.getCrossChainParams(this.commonStore.currentTab,e,{inputContent:e?.inputContent,selectChainType:this.getCrossChainSelectChainType(),searchType:this.getCrossChainSearchType(),toChainId:this.computedCurrentToChainId,fromTokenAddress:this.fromToStore.from.tokenContractAddress||""}),[n,i]=await _(C.get(o,{params:{...r},signal:this.cancelSearchRef?.signal}));if(n&&!this.isCancel(n)){this.setError(!0),this.setSearchTokenList({}),this.setLoading(this.tokenModalFromState,"search",!1);return}if(i){let{data:c}=i;if(this.commonStore.currentTab===E.BRIDGE)this.setSearchTokenList({list:c});else{let{systemList:d,thirdPartyList:m}=i.data;this.setSearchTokenList({systemList:d,thirdPartyList:m})}this.setError(!1),this.setLoading(this.tokenModalFromState,"search",!1)}});s(this,"resetTokenModal",()=>{this.resetTokenData()});s(this,"resetTokenData",()=>{this.searchTokenList={},this.searchValue=""});s(this,"balancePushSort",(t,e)=>{let o=[...t],{currencyAmount:r,coinAmountOriginalDec:n}=e;for(let i=0;i<o.length;i++)if(this.commonStore.equalsToken(o[i],e)){o[i].amountNum=n,o[i].currencyAmount=r;break}return o});s(this,"updateAllTokenList",t=>{let{chainId:e}=t,o=J(e),r=this.fromTokenList.get(o);r&&this.setTokenList(o,this.balancePushSort(q(r),t),k.FROM);let n=this.toTokenList.get(o);n&&this.setTokenList(o,this.balancePushSort(q(n),t),k.TO)});s(this,"checkFromToLegal",(t,e)=>{let{currentTab:o}=this.commonStore,r={toToken:{...e,amount:""},isChanged:!1};if(Number(t.chainId)!==Number(e.chainId)){if(this.computedToChain?.some(g=>g.chainId===e.chainId&&!g.disabled))return r;let{dexDefaultFromToTokenShowVO:n}=this.commonStore.getChainByID(this.fromToStore.from.chainId),{fromDexMultiTokenInfoVO:i,toDexMultiTokenInfoVO:c,toCrossDexMultiTokenInfoVO:d}=n,m=o===E.BRIDGE,p;return m&&d?p=d:this.commonStore.equalsToken(t,c)?p=i:p=c,{toToken:p,isChanged:!0}}return r});s(this,"calcCurToChainIdIsInSupList",t=>{let e=!1;return q(this.computedToChain).forEach(o=>{Number(o.chainId)===Number(t)&&!o.disabled&&(e=!0)}),e});s(this,"updateTokenCollected",async(t,e=!1)=>{let{isConnectedWallet:o}=this.accountStore;if(!o){D.error(f("swaptrade_selecttoken_toast_connect_wallet"));return}let r=wt({},{tokenContractAddress:t?.tokenContractAddress||this.rootStore.klineStore.chooseTokenContractAddress,chainId:Number(t?.chainId),symbol:t?.tokenSymbol,decimal:t?.decimals,isCustomToken:t?.isCustomToken||t?.isSubscribe,walletAddress:this.accountStore.address||this.accountStore.computedAccountWalletAddressesArray[0],userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId}),[n,i]=await _(C.post(Sr,r));this.updateTokenCollectedLocal(t),n?(D.error(f("swaptrade_pricechart_no_connection_desc")),this.updateTokenCollectedLocal(wt({},t,{isCollectToken:t?.tokenInfo?0:1}))):i?.data===-1?e?D.error({title:f("swaptrade_selecttoken_modal_favorite_limitreached"),duration:.5}):this.setShowCollectOverLimitDialog(!0):i?.data===0?(D.success({title:f("swaptrade_selecttoken_toast_removed_from_favorite"),duration:.5}),this.rootStore.marketInfoStore.setIsCollected(!1)):i?.data===1&&(Cr(),D.success({title:f("swaptrade_selecttoken_toast_added_to_favorite"),duration:.5}),this.rootStore.marketInfoStore.setIsCollected(!0))});s(this,"hideCollectCancelConfirm",F.get(Su));s(this,"showCollectOverLimitDialog",!1);s(this,"setShowCollectOverLimitDialog",t=>{this.showCollectOverLimitDialog=t});s(this,"setCommonlyUsedChain",t=>{let{from:e,to:o}=this.fromToStore,{chainList:r,currentTab:n}=this.commonStore,i=t&&t.length>0?t:[e.chainId,o.chainId];return gu(i,r,n)});s(this,"tokenPageChainList",[]);s(this,"setTokenPageChainList",t=>{this.tokenPageChainList=t});s(this,"getCurrentToChainInfo",()=>this.computedToChain.find(e=>J(e.chainId)===J(this.toSelectedChainId)));s(this,"changeTokenPageChainList",async t=>{if(this.tokenPageChainList.findIndex(o=>J(o.chainId)===J(t))===-1){let o=this.commonStore.chainList.find(n=>J(n.chainId)===J(t)),r=[...this.tokenPageChainList];r.unshift(o),r.length>4&&r.pop(),this.setTokenPageChainList(r)}this.tokenModalFromState===k.FROM?this.setFromSelectedChainId(t):this.setToSelectedChainId(t),await this.getTokenListByChainId()});s(this,"searchChainKeywords","");s(this,"setSearchChainKeywords",t=>{this.searchChainKeywords=t});s(this,"filterChains",t=>fo(t,e=>{let o=he(Cs(this.searchChainKeywords));return he(e.chainName).includes(o)}));s(this,"dialogIndex",Ls.TOKEN_LIST);s(this,"setDialogIndex",t=>{this.dialogIndex=t});s(this,"hideTokenGuide",!!F.get(Tu));s(this,"setHideTokenGuide",()=>{this.hideTokenGuide=!0,F.set(Tu,"1")});s(this,"importToken",async(t,e)=>{let r=(await this.importUserToken(Array.isArray(t)?t:[t]))[0]||{};e&&e(r),Ar(r)&&await this.fromToStore.getTokenBalanceByAccount(this.tokenModalFromState,r),this.setImportTokenInfo({}),this.setDialogIndex(Ls.TOKEN_LIST)});s(this,"reloadTokenList",async()=>{!this.tokenModalVisible||(this.searchValue!==""?await this.getSearchTokenList():await this.getTokenListByChainId())});s(this,"selectTokenHandle",async t=>{let e=this.commonStore.getChainByID(Number(t?.chainId));if(await fu(),!e)return;let{quoteStore:o}=this.rootStore,{from:r,updateFrom:n,updateTo:i,setBalance:c,setFromBalanceRequestError:d,setToBalanceRequestError:m,to:p,computedIsExactIn:g,needCrossChainDoubleConfirm:T,setNeedCrossChainDoubleConfirm:A}=this.fromToStore,{clearReceiveAddressValue:w}=this.rootStore.receiveAddressStore;this.setCommonlyUsedChain([t?.chainId]);let N=this.tokenModalFromState===k.FROM,O=()=>{d(!1),c(k.FROM,t.balance)},dt=()=>{m(!1),c(k.TO,t.balance)};if(t.selected){N?dt():O(),this.fromToStore.onSwitchFromTo();return}N?O():dt();let tt=()=>{T||A(!0)};if(N){if(ga(t.chainId,p.chainId)&&this.commonStore.currentTab===E.BRIDGE){let yt=new re(this.commonStore.currentTab,{}),[Wt,Lt]=await yt.fetchCrossChainTokens({fromChainId:t.chainId,fromTokenAddress:t.tokenContractAddress}),{amount:An}=r,Xo={...t},ho;Wt?(n({...Xo,amount:An}),ho=e?.dexDefaultFromToTokenShowVO?.toCrossDexMultiTokenInfoVO,i({...ho})):(Xo=Lt.data.fromTokenInfo,ho=Lt.data.toTokenInfo,n({...Xo,amount:An}),i(ho),tt(),this.fromToStore.getTokenBalanceByAccount("from",Xo)),this.fromToStore.getTokenBalanceByAccount("to",ho)}else if(!this.commonStore.equalsToken(t,r)){let{amount:yt}=r;o.setQuoteNumber(2),n({...t,amount:yt});let{toToken:Wt,isChanged:Lt}=this.checkFromToLegal(t,p);i(Wt),Lt&&(tt(),this.fromToStore.getTokenBalanceByAccount("to",q(Wt))),g&&this.fromToStore.advanceSetTypedValue("")}}else this.commonStore.equalsToken(t,p)||(tt(),o.setQuoteNumber(0),i({...t,amount:""}),g||this.fromToStore.advanceSetTypedValue(""));w()});this.rootStore=t,this.commonStore=t.commonStore,this.swapStore=t.swapStore,this.accountStore=t.accountStore,this.fromToStore=t.fromToStore}get computedIsSearching(){return!!this.searchValue}setSearchTokenList(t){this.searchTokenList=t}setError(t){this.error=t}setLoading(t,e,o){this.loading[t][e]=o}get computedTokenList(){return this.tokenModalFromState===k.FROM?this.fromTokenList.get(this.fromSelectedChainId):this.toTokenList.get(this.toSelectedChainId)}get computedSearchTokenList(){let t={};return Y(this.searchTokenList)||(t={systemList:this.extendTokenList(this.searchTokenList?.systemList,!1),thirdPartyList:this.extendTokenList(this.searchTokenList?.thirdPartyList,!1)}),t}toLowerCaseContractAddress(t){let e=[];return Array.isArray(t)&&t.forEach(o=>{e.push({...o,tokenContractAddress:this.commonStore.getTokenAddress(o)})}),e}isCancel(t){return Tt(t)}getSearchParams(){throw new Error("getSearchParams method must be implemented by subclass")}get computedFromChain(){let t=Wo(),e=Jr({});return[t,e,...q(this.tokenPageChainList)]}get computedToChain(){let t=Wo();if(H(this.fromToStore.from.chainId)){let e=this.tokenPageChainList.filter(o=>o?.chainId===this.fromToStore.from.chainId);return[t,...e]}return[t]}get computedCurrentToChainId(){return this.toSelectedChainId||H(this.toSelectedChainId)?this.toSelectedChainId:H(this.fromToStore.to.chainId)?this.calcCurToChainIdIsInSupList(this.fromToStore.to.chainId)?this.fromToStore.to.chainId:this.fromToStore.from.chainId:this.computedToChain.length>1?kt.chainId:Eo}reassignTokenInfo(t,e,o){if(this.commonStore.equalsToken(t,e)){let r=e?.isCollectToken;return wt({},e,{isCollectToken:r?0:1,collectTime:r?"":Date.now().toString(),isCustomToken:o?1:e?.isCustomToken})}return t}filterCollectToken(t){let e=!t.isCustomToken||t.balance;return!!(!this.computedIsCollectChain&&e||this.searchValue||t.isCollectToken)}updateTokenCollectedLocal(t){let e=(o=[],r=!1)=>o.map(n=>this.reassignTokenInfo(n,t,r)).filter(n=>this.filterCollectToken(n));if(this.searchValue){let{systemList:o,thirdPartyList:r}=this.searchTokenList;this.setSearchTokenList({systemList:e(o),thirdPartyList:e(r,!0)})}else this.updateTokenList(e)}updateTokenList(t){if(this.tokenModalFromState===k.FROM){let e=t(this.fromTokenList.get(this.fromSelectedChainId));this.fromTokenList.set(this.fromSelectedChainId,e)}else if(this.tokenModalFromState===k.TO){let e=t(this.toTokenList.get(this.toSelectedChainId));this.toTokenList.set(this.toSelectedChainId,e)}}get computedCurrentChainId(){return J(this.tokenModalFromState===k.FROM?this.fromSelectedChainId:this.toSelectedChainId)}get computedIsCollectChain(){return this.computedCurrentChainId===gt.chainId}setShowCollectCancelConfirm(t){F.set(Su,t),this.hideCollectCancelConfirm=t}get computedIsNotSupportToChain(){let t=this.getCurrentToChainInfo();return this.tokenModalFromState===k.TO&&t&&t.disabled}get computedSelectedChainId(){return this.tokenModalFromState===k.FROM?this.fromSelectedChainId||this.fromToStore.from.chainId:this.tokenModalFromState===k.TO?this.toSelectedChainId||this.fromToStore.to.chainId:""}get computedAllChainList(){let t=this.commonStore.chainList;return this.tokenModalFromState===k.FROM?{supported:t,unsupported:[]}:this.tokenModalFromState===k.TO?this.computedToChainList:{supported:[],unsupported:[]}}get computedToChainList(){let t=this.commonStore.chainList,e=zo(q(t),{chainId:Number(this.fromToStore.to.chainId)});return{supported:e?[e]:[],unsupported:[]}}get computedIsSearchChainStatus(){return!!this.searchChainKeywords}get computedSearchedChainList(){if(!this.computedIsSearchChainStatus)return{supported:[],unsupported:[]};let{supported:t,unsupported:e}=this.computedAllChainList;return{supported:this.filterChains(t),unsupported:this.filterChains(e)}}get computedTokenGuideVisible(){return!1}};var Zr=class extends Me{constructor(e){super(e);s(this,"showChainTab",!0);s(this,"clearCacheTokenList",()=>{this.fromTokenList.clear(),this.toTokenList.clear()});s(this,"extendTokenList",(e=[],o=!0)=>Y(e)?e:e?.map(r=>({...r,tokenList:this.extendTokens(r.tokenList,o)})));s(this,"generateToChainMap",()=>{let e=this.commonStore.chainList,r=zo(q(e),{chainId:Number(this.fromToStore.from.chainId)})?.bridgeSupportChainInfoList||[];return Ln([...r],"chainId")});lt(this)}get computedTokenGuideVisible(){let{tokenModalFromState:e,hideTokenGuide:o}=this;return e===k.TO&&!o}get computedSearchTokenList(){return this.extendTokenList(this.searchTokenList?.list,!1)}get computedToChainList(){let e=this.commonStore.chainList,o=[],r=[],n=this.generateToChainMap();return e.forEach(i=>{let c={...i};c.disabled=!n[i.chainId],c.disabled||o.push(c)}),{supported:o,unsupported:r}}updateTokenCollectedLocal(e){let o=(r=[],n=!1)=>{let i=[];return r?.forEach(c=>{let d=c?.tokenList.map(m=>this.reassignTokenInfo(m,e,n)).filter(m=>this.filterCollectToken(m));i.push({tokenList:d})}),i};if(this.searchValue){let{list:r}=this.searchTokenList;this.setSearchTokenList({list:o(r)})}else this.updateTokenList(o)}get computedToChain(){let e=Wo(),o=Jr({});if(H(this.fromToStore.from.chainId)){let r=this.generateToChainMap(),n=[];return q(this.tokenPageChainList).forEach(i=>{i.chainId!==Number(this.fromToStore.from.chainId)&&n.push({...i,disabled:!r[i.chainId]})}),[e,o,...n]}return[e]}getSearchParams(e){let o=this.getSearchChainType(),r={inputContent:e,userUniqueId:this.commonStore.userUniqueId,accountId:this.accountStore.computedAccountId,chainType:o,userWalletAddress:this.accountStore.computedSpecialWalletAddress};return this.tokenModalFromState===k.FROM&&(r={...r,fromChainId:this.fromSelectedChainId},this.needRemoveChainId(this.fromSelectedChainId)&&delete r.fromChainId),this.tokenModalFromState===k.TO&&(r={...r,fromChainId:this.fromToStore.from.chainId,fromTokenAddress:this.fromToStore.from.tokenContractAddress||"",toChainId:this.toSelectedChainId},this.needRemoveChainId(this.toSelectedChainId)&&delete r.toChainId),r}};u();l();M();var un=class{constructor(t){s(this,"sendTransactionParams",{});s(this,"waitingHandleOrderList",[]);s(this,"needIntercept",!1);s(this,"updateHistoryOrderList",t=>{let e=it(),o=[],r=[],n=this.rootStore.recentTransactionStore;n.pendingOrders.forEach(i=>{let c=i;i.orderId===t&&(c={...i,status:Rr.PendingRedeeming}),o.push(c)}),!e&&n.history?.list?.forEach(i=>{let c=i;i.orderId===t&&(c={...i,status:Rr.PendingRedeeming}),r.push(c)}),n.setPendingOrders(o),!e&&n.setHistory({...n.history,list:r})});s(this,"sendTransactionEnhance",async({callData:t,chainId:e,redeemOrderIdPre:o,redeemOrderId:r,bizType:n},i=()=>{})=>{let c=it(),d=`${o}:${r}`;if(!c&&this.setWaitingHandleList(d),this.needIntercept)return;let m;if(it()){let p=this.rootStore.swapStore.extendsGas(t);m=this.sendTransactionStore.sendTransactionEnhance(e,p,this.rootStore?.walletContractStore?.walletSendParams)}else{if(!await this.rootStore.commonStore.connectAndSwitchNetwork(e))return;m=this.sendTransactionStore.sendTransactionEnhance(t)}m.then(({result:p,hash:g,nonce:T})=>{!c&&this.setWaitingHandleList(d,!0),this.sendTransactionStore.updateTxHash({orderId:r,transactionHash:c?g:p,bizType:n,nonce:T}),fa(i),this.updateHistoryOrderList(o),c||this.sendTransactionStore.getTransaction(p,e).then(A=>{y.info(v.UPDATE_NONCE,{nonce:A.nonce,tags:{orderId:r}}),this.sendTransactionStore.updateTxHash({orderId:r,transactionHash:p,nonce:A.nonce,bizType:n})}).catch(A=>{y.error(v.UPDATE_NONCE_FAIL,{error:A,transactionHash:p,tags:{orderId:r}})})}).catch(p=>{!c&&this.setWaitingHandleList(d,!0),y.error(v.REDEEM_ORDER_ERROR,{error:p,tags:{orderId:r}})})});s(this,"walletSendRedeem",()=>{this.sendTransactionEnhance(this.sendTransactionParams,()=>{R.history?.goBack()})});s(this,"facetOrderDetail",{});this.rootStore=t,this.sendTransactionStore=t.sendTransactionStore,L(this,{},{autoBind:!0})}setSendTransactionParams(t){this.sendTransactionParams=t}async launchFacetSwap(t){let e=it(),{data:o}=this.rootStore.recentTransactionStore.detail,r=t?t.orderId:o?.orderId,n=t?t.chainId:o?.fromChainId,i=t?t.toTokenAddress:o?.toTokenAddress,c=t?t.fromTokenAddress:o?.fromTokenAddress,d={orderId:r,chainId:n,userWalletAddress:this.rootStore.accountStore.getAddressByChainId(n)};if(e&&t?.goOrderDetail){R.history?.push(`${Te}/${r}`);return}let[m,p]=await _(C.post(Gi,d));if(m){y.error(v.REDEEM_ORDER_CALL_DATA_ERROR,{error:m,tags:{orderId:r}}),Number(m?.code)===100002&&this.rootStore.recentTransactionStore.removePendingOrder(r),D.error({title:m?.msg||f("swaptrade_top_notif_data_failed")});return}let{redeemSignatureVo:g,redeemDetailInfo:T,redeemOrderId:A,bizType:w}=p?.data||{},{unsignedTx:N,...O}=g||{},dt={...O,extParams:{toTokenAddress:i,crossChain:0,tokenAddress:c,amount:T.fromTokenAmount,toChainId:n,...d}},tt={callData:dt,chainId:n,redeemOrderIdPre:r,redeemOrderId:A,bizType:w};if(this.setSendTransactionParams(tt),y.info(v.REDEEM_ORDER,{callData:dt,tags:{orderId:A}}),e){this.setFacetOrderDetail({...T}),this.rootStore.walletContractStore.setTransactionPayload(dt),R.history?.push({pathname:Ft,search:`needUpdate=${ir.off}&type=${bt.REDEEM}`});return}await this.sendTransactionEnhance(tt)}setWaitingHandleList(t,e=!1){this.waitingHandleOrderList.find(r=>r===t)?e?(this.waitingHandleOrderList=this.waitingHandleOrderList.filter(r=>r!==t),this.needIntercept=!1):(D.warn({title:f("swaptrade_history_notification_desc_wallet_confirm")}),this.needIntercept=!0):(this.waitingHandleOrderList=[...this.waitingHandleOrderList,t],this.needIntercept=!1)}getFacetExploreUrl(t){let{data:e}=this.rootStore.recentTransactionStore.detail,o=[e?.fromChildOrderDetailVo?.exploreUrl,e?.relativeTransaction?.exploreUrl];return this.computedIsFacetTradeType&&o?.[t]||""}get computedIsFacetTradeType(){let{data:{specialOrderType:t}}=this.rootStore.recentTransactionStore.detail;return t===Ja.FromIsEthChainFacetCoin}get computedShowFacetTip(){return this.rootStore.recentTransactionStore.detail.data.status===Rr.PendingCanRedeem}setFacetOrderDetail(t){this.facetOrderDetail=t}get computedFacetOrderToFromRate(){let{price:t}=this.facetOrderDetail;return t&&!oe(t)&&t!=="-1"?z(t):""}get computedFacetOrderFromToRate(){let{price:t}=this.facetOrderDetail;return t&&!oe(t)&&t!=="-1"?z(I.BigNumber("1").div(t).toString(10),{needBillionMillionUnit:!1}):""}get computedFacetOrderTokens(){let{fromToken:t,toToken:e,fromTokenAmount:o,toTokenAmount:r}=this.facetOrderDetail;return{fromToken:{...t,amount:o},toToken:{...e,amount:r}}}get computedFacetOrderMinimumReceived(){return this.facetOrderDetail.minimumReceived}get computedFacetTipParams(){let t=this.rootStore.recentTransactionStore.detail?.data;return{amount:z(t?.fromChildOrderDetailVo?.toAmountOut,{needBillionMillionUnit:!1}),token:t?.fromChildOrderDetailVo?.toTokenSymbol}}},ts=un;u();l();P();P();M();var Fe=class{constructor(t){s(this,"liquidityModelVisible",!1);s(this,"dataStatus",Z.DEFAULT);s(this,"setDataStatus",t=>{this.dataStatus=t});s(this,"rawData",[]);s(this,"LiquidityCancelRef",null);s(this,"fetchLiquidityData",async()=>{this.resetAllLiquidityData(),this.setDataStatus(Z.LOADING);let{from:t}=this.fromToStore;this.LiquidityCancelRef&&this.LiquidityCancelRef.abort(),this.LiquidityCancelRef=$();let[e,o]=await _(C.get(Hi,{params:{chainId:t.chainId},signal:this.LiquidityCancelRef?.signal,isolate:!0}));if(e)this.setDataStatus(Z.ERROR);else{let r=S(o,"data");Y(r)?this.setDataStatus(Z.NULL):(this.initAllLiquidityData(r),this.setDataStatus(Z.READY))}});s(this,"selectedListIds",[]);s(this,"setSelectedListIds",t=>{this.selectedListIds=t});s(this,"confirmIds",null);s(this,"setConfirmIds",t=>{this.confirmIds=t});s(this,"filterSelectedListIds",(t,e)=>{let o;e?o=As(this.selectedListIds,t):o=_n(this.selectedListIds,t),this.setSelectedListIds($t(o))});s(this,"searchLiquidityValue","");s(this,"setLiquiditySearchValue",t=>{this.searchLiquidityValue=t});this.rootStore=t,this.fromToStore=this.rootStore.fromToStore,L(this,{},{autoBind:!0})}setLiquidityModelVisible(t){this.liquidityModelVisible=t}setData(t){this.rawData=t}resetAllLiquidityData(){this.setData([]),this.setSelectedListIds([]),this.setConfirmIds(null)}initAllLiquidityData(t){this.setData(t);let e=Jo(t,"id");this.setSelectedListIds(e);let o=this.fromToStore.from.chainId;H(o)&&this.setConfirmIds(xn({},o,e))}get computedListCheckedAll(){return this.computedSearchStatus?this.computedSearchIfAllChecked:this.selectedListIds.length===this.rawData.length}get computedCheckedAllDisabled(){return this.computedSearchStatus&&Y(this.computedSearchData)}get computedLiquidityNum(){let{from:t}=this.rootStore.fromToStore,e="--",{dataStatus:o,rawData:r,confirmIds:n}=this;if(o===Z.NULL)e="0 / 0";else if(o===Z.READY){let i=S(n,t.chainId);e=`${!i||i&&i.length===0?r.length:i.length} / ${r.length}`}return e}get computedClearAll(){return Y(this.selectedListIds)}checkAllBtn(){let t="",e=this.computedSearchStatus?this.computedSearchData:this.rawData,o=Jo(e,"id");this.computedListCheckedAll?t=As(this.selectedListIds,...o):t=Nn(this.selectedListIds,o),this.setSelectedListIds($t(t))}get computedCheckedData(){return Jo(this.rawData,e=>({...e,isChecked:!!bn(this.selectedListIds,e.id)}))}get computedSortListData(){return va(this.computedCheckedData)}get computedSearchStatus(){return!!this.searchLiquidityValue}get computedSearchDataIsNull(){return this.computedSearchStatus&&Y(this.computedSearchData)}get computedSearchData(){return La(this.computedCheckedData,this.searchLiquidityValue)}get computedSearchIfAllChecked(){let t=En(this.computedSearchData,e=>e?.isChecked);return!Y(this.computedSearchData)&&t}get computedShowData(){return this.searchLiquidityValue?this.computedSearchData:this.computedSortListData}get computedIds(){return S(this.rootStore.liquidityChooseStore?.confirmIds,this.rootStore.fromToStore?.from.chainId)}get computedIsCustomLiquidity(){return(this.computedIds||[]).length<this.rawData.length}get computedMonitorLiquidSelectType(){let{computedIds:t=[],rawData:e}=this;return!t.length||t.length===e?.length?"all":t.length>1?"custom_>1":t.length===1?"custom_=1":""}get computedIsSelectedAllDex(){let{computedIds:t=[],rawData:e}=this;return!t.length||t.length===e?.length}};u();l();P();M();var ln=class{constructor(t){s(this,"orderCheckContinue",async t=>{let[e,o]=await _(C.get(ji,{params:t}));if(e)return D.error({title:f("swaptrade_history_toast_setup_error"),duration:Pt}),!1;let r=S(o,"data"),n=String(r?.checkCode);return n===Xe.SUCCESS?!0:(n===Xe.SINGLE_ERROR||n===Xe.LIMIT_SINGLE_ERROR?D.error({title:f("swaptrade_history_toast_chain_unsupported",{chain:r?.fromChainName}),duration:Pt}):n===Xe.CROSS_ERRORL||n===Xe.LIMIT_CROSS_ERRORL?D.error({title:f("swaptrade_history_toast_both_unsupported",{fromChain:r?.fromChainName,toChain:r?.toChainName}),duration:Pt}):D.error({title:f("swaptrade_history_toast_setup_error"),duration:Pt}),!1)});this.rootStore=t,L(this,{},{autoBind:!0})}},es=ln;u();l();P();var{BigNumber:Iu}=I,dn="safemoon_slippage",mn="safemoon_is_changed",Cu=50,pn={NeedIncreaseSlip:0,AdviseGivenSlip:1,NotAvailableGivenSlip:2,AdviseSlip:3},Be=class{constructor(t){s(this,"isChanged",!1);s(this,"getSafemoonIsChangedLocal",()=>!!F.get(`${mn}_${this.computedSlippageTokenPair}`));s(this,"cacheSlippage",0);L(this),this.rootStore=t,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore,Et(()=>this.computedSlippageTokenPair,()=>{this.setSafeMoonIsChanged(F.get(`${mn}_${this.computedSlippageTokenPair}`)),this.setCacheSlippage(F.get(`${dn}_${this.computedSlippageTokenPair}`))}),Et(()=>({slippage:this.computedPairSlippage}),()=>{this.cacheSlippage>0&&this.computedPairSlippage>this.cacheSlippage&&this.setSafeMoonIsChanged(!1),this.setCacheSlippage(F.get(`${dn}_${this.computedSlippageTokenPair}`))}),Et(()=>this.computedSlippage,e=>{this.commonStore.safemoonSlippage=e})}setSafeMoonIsChanged(t){this.isChanged=t,F.set(`${mn}_${this.computedSlippageTokenPair}`,t)}checkIsChanged(t){let e=new Iu(t),o=e.gte(this.computedPairSlippage)&&e.lte(50);o&&this.setSafeMoonIsChanged(o)}setSafeMoonPairSlippage(t){!this.isAccessSlippage(t)||(this.setCacheSlippage(t),F.set(`${dn}_${this.computedSlippageTokenPair}`,t))}isAccessSlippage(t){let e=new Iu(t);return this.computedPairSlippage>0&&e.gte(this.computedPairSlippage)&&e.lte(50)}get computedAutoSlippage(){return Xr(this.rootStore)}get computedSafeMoonToken(){let{from:t,to:e}=this.fromToStore;return this.checkIsSafeMoon(t)?t:this.checkIsSafeMoon(e)?e:null}get computedHoneypot(){let{from:t,to:e}=this.fromToStore;return this.checkIsHoneypot(t)?t:this.checkIsHoneypot(e)?e:null}setCacheSlippage(t){this.cacheSlippage=t}get computedPairSlippage(){return this.computedSafeMoonToken?1.1:0}get computedSlippage(){return this.cacheSlippage>this.computedPairSlippage?this.cacheSlippage:this.computedPairSlippage}get computedOverLimit(){return this.computedSlippage>50}get computedSlippageTokenPair(){let{from:t,to:e}=this.fromToStore;return`${this.checkIsSafeMoon(t)?t.tokenContractAddress:""}_${this.checkIsSafeMoon(e)?e.tokenContractAddress:""}`}get computedSlippageTips(){let t=S(this,"rootStore.quoteStore.quote.bestRoute"),e=Number(this.computedAutoSlippage),{tokenSymbol:o}=this.computedSafeMoonToken||{};return t?.isSafeMoonToken!=="1"||t?.isHoneypot==="1"?null:e===Cu?{type:pn.AdviseGivenSlip,safeMoonSlippage:e,equalLimit:!0,tip:f("swaptrade_card_errortip_autoadjust_to_50",{tokenSymbol:o,slippageTolerance:e}),tipEquation:f("swaptrade_card_errortip_autoadjust_to_50",{tokenSymbol:W(o),slippageTolerance:e}),inputWarning:f("swaptrade_adjustslip_modal_advise_givenslip")}:e>Cu?{type:pn.NotAvailableGivenSlip,overLimit:!0,safeMoonSlippage:e,tip:f("wallet_swap_adjustslip_modal_slip_notsupported",{tokenSymbol:o}),tipEquation:f("wallet_swap_adjustslip_modal_slip_notsupported",{tokenSymbol:W(o)})}:{type:pn.AdviseSlip,safeMoonSlippage:e,tip:f("swaptrade_card_errortip_autoadjust_to_less50",{slippageTolerance:e,tokenSymbol:o}),tipEquation:f("swaptrade_card_errortip_autoadjust_to_less50",{slippageTolerance:e,tokenSymbol:W(o)}),inputWarning:f("swaptrade_modal_errortip_adjust_to_suggested_range",{slippageTolerance:e})}}checkIsSafeMoon(t){return S(t,"isSafeMoonToken")===1}checkIsHoneypot(t){return S(t,"isHoneypot")===1}get computedInputVal(){let{computedIsExactIn:t,computedSwapAmount:e}=this.fromToStore;return!t&&this.computedHoneypot?"":e[k.FROM]}get computedInputFiatVal(){let{computedIsExactIn:t,computedFromLocalCostByUsd:e}=this.fromToStore;return!t&&this.computedHoneypot?"":e}get computedOutputVal(){let{computedIsExactIn:t,computedSwapAmount:e}=this.fromToStore;return t&&this.computedHoneypot?"":e[k.TO]}get computedOutputFiatVal(){let{computedIsExactIn:t,computedToLocalCostByUsd:e}=this.fromToStore;return t&&this.computedHoneypot?"":e}get computedOutputPopVal(){let{computedSwapAmount:t}=this.fromToStore;return this.computedHoneypot?"":Ce(t[k.TO])}};u();l();var os=class{constructor(){s(this,"gasDropConfig",{gasDropShow:!1,gasDropSwitch:F.get(Rs)===Jn.OPEN,chainName:"",chainId:"",deduction:"",gasDrop:"",tokenLogoUrl:"",tokenSymbol:""});s(this,"setGasDropInfo",t=>{this.gasDropConfig={...this.gasDropConfig,...t}});s(this,"setGasDropSwitch",t=>{this.setGasDropInfo({gasDropSwitch:t}),F.set(Rs,`${Number(t)}`)});s(this,"resetGasDrop",()=>{this.setGasDropInfo({gasDropShow:!1})});L(this)}get computedGasDropSelected(){let{gasDropShow:t,gasDropSwitch:e}=this.gasDropConfig;return t&&e}};u();l();var hn=class{constructor(t){s(this,"isShowMev",!1);s(this,"setShowMev",t=>{this.isShowMev=t});s(this,"isMevUserSwitchOpen",ar.DEFAULT);s(this,"setMevUserSwitchOpen",t=>{this.isMevUserSwitchOpen=t});s(this,"mevInfo",{});s(this,"setMevInfo",t=>{this.mevInfo=t});this.rootStore=t,this.quoteStore=this.rootStore.quoteStore,this.fromToStore=this.rootStore.fromToStore,L(this,{},{autoBind:!0})}get computedIsMevOpen(){return this.isShowMev&&(this.isMevUserSwitchOpen===ar.ON||this.isMevUserSwitchOpen===ar.DEFAULT)}},rs=hn;u();l();P();M();var fn=class{constructor(t){s(this,"feeConfig",{});s(this,"setFeeConfig",t=>{if(!this.isIframe)return;if(!Y(t)){this.feeConfig=t,Xt.session.set("feeConfig",t);return}let e=Xt.session.get("feeConfig"),o=pe(e,["referrerAddress","feePercent"]);Y(o)?(this.feeConfig={},Xt.session.remove("feeConfig")):this.feeConfig=o});s(this,"widgetFeeConfig",{});s(this,"setWidgetFeeConfig",t=>{this.isWidget&&(this.widgetFeeConfig=t)});s(this,"receiveQuoteUrl",()=>this.isIframe?fi:Si);s(this,"aggregatorQuoteUrl",()=>Ii);s(this,"saveOrderUrl",()=>this.isIframe?yi:fr);s(this,"illegalFeePercent",t=>{let{BigNumber:e}=I,o=e(t);return!!(o.isNaN()||o.gt(ii)||o.lte(0))});s(this,"extendFeeConfig",t=>{if(this.isWidget){let o=S(this.widgetFeeConfig,[t.chainId],{});if(typeof o.referrerAddress=="string")return{...t,...o};let r=S(o,["referrerAddress",t.fromTokenAddress]),n=S(r,"account"),c=S(r,"feePercent")||o.feePercent;return n?{...t,referrerAddress:n,feePercent:c}:t}if(!this.computedHasFeeConfig)return t;let e=Y(this.feeConfig)?Xt.session.get("feeConfig"):this.feeConfig;return{...t,...e}});L(this),this.rootStore=t,this.isIframe=!it()&&Sa()&&!no,this.isWidget=!it()&&Ia()}get computedHasFeeConfig(){return!!this.feeConfig?.referrerAddress&&!!this.feeConfig?.feePercent&&this.isIframe}get computedFeeConfigErrorTips(){return this.computedHasFeeConfig?this.illegalFeePercent(this.feeConfig?.feePercent):!1}},ss=fn;u();l();M();u();l();P();M();u();l();var yu=()=>{let{swapStore:a,intentSwapStore:t,swapDappStore:e,approveStore:o,fromToStore:r}=U(),{from:n,to:i}=r;return!(!i?.tokenContractAddress||!n?.tokenContractAddress||o.visibleApprove||a.isConfirmLoading||t.isConfirmLoading||e.computedSupportDappTradeByChain)};u();l();u();l();var Au=a=>{let{fromToStore:t,quoteStore:e}=U(),{commonDexInfo:o,pathSelectionRouterList:r,singleChainSwapInfo:n}=a,{computedIsSingleChain:i}=t,c=Number(o?.code)===Mt.CROSS_CHAIN_INTERVAL,d=c?{crossMaxAmount:o?.crossMaxAmount,crossMiniAmount:o?.crossMiniAmount}:null;return e.setQuoteScope(d),{isAutoError:c||(i?!n:!r?.length)}};var zl=({quoteStore:a,fromToStore:t})=>{a.setQuoteNumber(a.quoteNumber+1),a.quoteNumber===1&&a.checkQuoteScopeLtMin(a.quoteScope,t.from.amount)&&t.advanceSetTypedValue("")},Jl=(a,{fromToStore:t,quoteStore:e})=>{let{commonDexInfo:o,pathSelectionRouterList:r,singleChainSwapInfo:n,swapType:i,intentCode:c,isSupportDappTrade:d,offlineType:m,traceData:p}=a,g={intentCode:c,offlineType:m,swapType:i,traceData:p},T=r?.map(w=>({...o,...w,...g,isSupportDappTrade:d}));return{bestRoute:t.computedIsSingleChain?{...o,...n,...g,intentInfo:a?.intentInfo||{},isSupportDappTrade:d}:e.pickBestRouterAccordingBridgeId(T)||{...o,...g,isSupportDappTrade:d},combineSelectionRouterList:T}},Zl=({bestRoute:a,combineSelectionRouterList:t,isAutoError:e},{fromToStore:o,quoteStore:r})=>{r.updateSlippageInfoFetched(a),r.setQuote({...r.quote,bestRoute:a,quoteNull:e,quoteError:null,isFetchQuoting:!1}),o.quoteUpdateFromTo(a),o.computedIsSingleChain||r.setPathSelectionRouterList(t||[])},Go=({isAutoError:a},{approveStore:t})=>{a||t.isPendingNotCheck().catch(()=>{})},Qo=({isAutoError:a},{quoteStore:t})=>{a&&(t.handleReverseQuoteErrorAndNull(),ft(()=>{t.updateQuoteStatus(t.quoteScope?2:3)}))},td=a=>{let{solanaPriorityFeeStore:t}=U();t&&t.setJitoData(a?.priorityFeeInfo)},ku=a=>{let{fromToStore:t,quoteStore:e,approveStore:o}=U(),{isAutoError:r}=Au(a);zl({quoteStore:e,fromToStore:t});let{bestRoute:n,combineSelectionRouterList:i}=Jl(a,{fromToStore:t,quoteStore:e});Zl({bestRoute:n,combineSelectionRouterList:i,isAutoError:r},{fromToStore:t,quoteStore:e,approveStore:o}),td(a),Go({isAutoError:r},{approveStore:o}),Qo({isAutoError:r},{quoteStore:e})};u();l();var Ho=class{constructor(t){s(this,"allTimerAndQuoteState",{[st.DEFAULT]:{isShowLoadingCpt:!1,quoteText:()=>""},[st.QUOTING]:{isShowLoadingCpt:!0,quoteText:()=>f(tr)},[st.TIMER]:{isShowLoadingCpt:!0,quoteText:()=>f(tr)},[st.QUOTE_IS_HONEYPOT]:{isShowLoadingCpt:!1,quoteText:()=>f(er)},[st.QUOTE_NULL]:{isShowLoadingCpt:!0,quoteText:()=>f(er)},[st.QUOTE_NULL_AND_SECTION]:{isShowLoadingCpt:!0,quoteText:()=>f(tr)},[st.QUOTE_ERROR]:{isShowLoadingCpt:!1,quoteText:()=>f(er)}});Object.assign(this,t)}isValidRange(t){if(typeof t!="string")return!1;let{from:e}=this.fromToStore,o=t.split("-");if(o.length!==2)return!1;let{BigNumber:r}=I;return r(e.amount).lt(o[0])||r(e.amount).gt(o[1])}getCurrentTimerQuoteState(){let{quoteNull:t,isFetchQuoting:e,quoteError:o,bestRoute:r}=this.quote,n=this.fromToStore?.computedIfQuote,i=o!==null;return n?i?this.allTimerAndQuoteState[st.QUOTE_ERROR]:this.rootStore.safeMoonStore.computedHoneypot?this.allTimerAndQuoteState[st.QUOTE_IS_HONEYPOT]:t?r?.msg&&(e||this.isValidRange(r.msg))?this.allTimerAndQuoteState[st.QUOTE_NULL_AND_SECTION]:this.allTimerAndQuoteState[st.QUOTE_NULL]:e?e?this.allTimerAndQuoteState[st.QUOTING]:this.allTimerAndQuoteState[st.DEFAULT]:this.allTimerAndQuoteState[st.TIMER]:this.allTimerAndQuoteState[st.DEFAULT]}};var{FACET_TOKEN_ERROR_ONE:od,FACET_TOKEN_ERROR_TWO:rd,FACET_TOKEN_ERROR_THREE:sd}=Mt,Ue=class{constructor(){s(this,"dialogCloseFlag",!1);s(this,"slippageInfoFetched",!1);s(this,"setDialogCloseFlag",t=>{this.dialogCloseFlag=t});s(this,"enableQuoteAggregates",!1);s(this,"dialogShowQuotationComparison",!1);s(this,"setDialogShowQuotationComparison",t=>{this.dialogShowQuotationComparison=t});s(this,"quoteNumber",0);s(this,"setQuoteNumber",t=>{this.quoteNumber=t});s(this,"aggregateSelectId",vt);s(this,"isDialog",!1);s(this,"setIsDialog",t=>{this.isDialog=t});s(this,"initQuote",{bestRoute:null,quoteError:null,quoteNull:!1,isFetchQuoting:!1});s(this,"isPickRouterFromWallet",!1);s(this,"setIsPickRouterFromWallet",t=>{this.isPickRouterFromWallet=t});s(this,"quoteScope",null);s(this,"setQuoteScope",t=>{this.quoteScope=t});s(this,"fetchQuoteStatus",0);s(this,"quote",{...this.initQuote});s(this,"setQuote",t=>{this.quote=t});s(this,"pathSelectionRouterList",[]);s(this,"setPathSelectionRouterList",t=>{this.pathSelectionRouterList=t});s(this,"pickRouter",{});s(this,"setPickRouter",(t,e)=>{this.pickRouter=t,e&&(this.setNoCurrentPathTipInfo({bridgeName:t?.bridge?.bridgeName}),this.updateBestRoute(t))});s(this,"showChainListModel",!1);s(this,"setShowChainListModel",t=>{this.showChainListModel=t});s(this,"noCurrentPathTipInfo",{visible:!1,bridgeName:""});s(this,"setNoCurrentPathTipInfo",t=>{this.noCurrentPathTipInfo={...this.noCurrentPathTipInfo,...t}});s(this,"currentBridgeId","");s(this,"setCurrentBridgeId",t=>{this.currentBridgeId=t});s(this,"updateBestRoute",t=>{this.setQuote({...this.quote,bestRoute:t}),this.rootStore.fromToStore?.quoteUpdateFromTo(t)});s(this,"pickBestRouterAccordingBridgeId",t=>{let{smartRouterStore:{showXRouteModal:e}}=this.rootStore;if(!t||t.length===0)return null;let o=t.find(r=>r?.bridge?.bridgeId===this.currentBridgeId);return this.currentBridgeId&&!o&&(this.setCurrentBridgeId(""),!this.showChainListModel&&e!==pr.ROUTER_SELECT&&this.setNoCurrentPathTipInfo({visible:!0})),o||t?.[0]});s(this,"quoteTimer",null);s(this,"clearQuote",()=>{this.cleanQuoteTimer(),this.setQuote(this.initQuote),this.rootStore.fromToStore?.quoteUpdateFromTo(null),this.quotePending=!1;let{computedIsCrossChain:t,computedIfQuote:e}=this.fromToStore;t?(this.setBridgeQuoteSelectStatus(0),this.setBridgeFetchStatus(e?1:0)):(this.setAggregateSelectStatus(0),this.setAggregateFetchStatus(e?1:0))});s(this,"cancelRef",null);s(this,"cleanQuoteTimer",()=>{clearTimeout(this.quoteTimer),this.quoteTimer=null,this.cancelRef&&this.cancelRef.abort()});s(this,"isClearQuote",()=>{let{currentTab:t}=this.commonStore,{computedTypedValue:e,from:o,to:r,computedIsSingleChain:n,computedIsExactIn:i}=this.fromToStore;return t===E.LIMIT_ORDER||!jt(e)||!r?.tokenContractAddress||!o?.tokenContractAddress||!i&&!n});s(this,"getQuoteData",t=>{let e=Nt();return _(io(()=>C.get(this.getQuoteStoreUrl(),{params:e,signal:t,isolate:!0}),Ht.NUM,Ht.TIMER))});s(this,"handleUpdateQuote",t=>{if(t){let{data:e}=t;ku(e)}});s(this,"fetchQuote",async({source:t}={})=>{if(!yu())return this.quoteTimer=setTimeout(()=>{this.fetchQuote().catch(()=>{})},bs),Promise.resolve(!1);if(t===0){let{computedIsCrossChain:r}=this.fromToStore;r?(this.setBridgeQuoteSelectStatus(0),this.setBridgeFetchStatus(1),this.setBridgeSelectId(vt)):(this.setAggregateSelectStatus(0),this.setAggregateFetchStatus(1),this.setAggregateSelectId(vt))}if(this.isClearQuote())return this.quoteScope=null,this.clearQuote(),Promise.resolve(!1);if(this.cleanQuoteTimer(),this.rootStore.outerStore.computedFeeConfigErrorTips)return this.handleQuoteError(null),Promise.resolve(!1);this.setQuote({...this.quote,isFetchQuoting:!0}),this.cancelRef=$();let[e,o]=await this.getQuoteData(this.cancelRef.signal);return this.quotePending=!1,!Tt(e)&&e&&this.handleQuoteError(e),this.handleUpdateQuote(o),this.setIsPickRouterFromWallet(!1),this.commonStore.setResetFromToByTabChange(!1),!Tt(e)&&!this.dialogCloseFlag&&ft(()=>{this.quoteTimer=setTimeout(()=>{this.fetchQuote().catch(()=>{})},bs)}),Promise.resolve(!0)});s(this,"quotePending",!1);s(this,"debounceQuote",Qe(this.fetchQuote,cr));s(this,"fetchQuoteDebounce",async({source:t}={})=>{let{computedIsCrossChain:e,computedIfQuote:o}=this.fromToStore;this.quotePending=!0,o&&e?await this.debounceQuote({source:t}):o&&!e?this.debounceQuote({source:t}):this.clearQuote()});s(this,"handleQuoteError",t=>{this.setQuote({...this.initQuote,quoteError:t}),this.handleReverseQuoteErrorAndNull()});s(this,"getGasTokenFeeLoading",!1);s(this,"getGasTokenFeeCancelRef",null);s(this,"cancelGasTokenGeeRequest",()=>{this.getGasTokenFeeCancelRef&&(this.getGasTokenFeeCancelRef.abort(),this.getGasTokenFeeCancelRef=null)});s(this,"cacheNativeGasFee","");s(this,"setCacheNativeGasFee",t=>{this.cacheNativeGasFee=t});s(this,"fetchGasTokenFee",async()=>{let{from:t}=this.rootStore.fromToStore,{computedReserveGas:e}=this.rootStore.commonStore,{decimals:o,balance:r}=t||{},n=wn(Nt(),["dexIds"]);this.getGasTokenFeeCancelRef=$();let i=this.rootStore.fromToStore?.computedIsExactIn?hi:gi;this.getGasTokenFeeLoading=!0;let c=this.getGasTokenFeeCancelRef.signal,d=e,[m,p]=await _(C.get(i,{params:{...n,amount:da(r,o)},signal:c}));if(this.getGasTokenFeeLoading=!1,!Tt(m)&&m)return-1;if(!m){let{data:g}=p||{},{commonDexInfo:T}=g||{};Number(T?.code)===0&&T?.estimateReserveGasTokenFee!==""&&(d=T.estimateReserveGasTokenFee)}return this.setCacheNativeGasFee(d),d})}initQuoteStatus(){this.fetchQuoteStatus=0}updateQuoteStatus(t){this.fetchQuoteStatus=t}get computedSlippage(){let{computedIsSingleChain:t,computedDefaultAutoSlippageInfo:e}=this.fromToStore,o=this.rootStore.slippageStore,r=Uo({isSingleChain:t,autoSlippageInfo:e}),n=ye.AUTO;return o&&(r=o.computedRealSlippageValue,n=o.getSlippageType()),!this.slippageInfoFetched&&n===ye.AUTO&&(n=ye.DEFAULT),{slippage:r,slippageType:n}}getQuoteStoreUrl(){return this.outerStore.receiveQuoteUrl()}handleReverseQuoteErrorAndNull(){let{updateFromAmount:t,computedIsExactIn:e,updateTo:o}=this.fromToStore;e?o({amount:""}):t({amount:""})}getQuoteError(t){let{commonDexInfo:e,pathSelectionRouterList:o,singleChainSwapInfo:r}=t,{computedIsSingleChain:n}=this.fromToStore,i=Number(e?.code)===Mt.CROSS_CHAIN_INTERVAL,c=i?{crossMaxAmount:e?.crossMaxAmount,crossMiniAmount:e?.crossMiniAmount}:null;return this.setQuoteScope(c),{isAutoError:i||(n?!r:!o?.length)}}updateSlippageInfoFetched(t){let{autoSlippage:e,autoTotalSlippage:o}=t?.autoSlippageInfo||{};(e||o)&&(this.slippageInfoFetched=!0)}checkQuoteScopeLtMin(t,e){if(!t||!e)return!1;let{crossMiniAmount:o}=this.quoteScope||{};return!!I.BigNumber(e).lt(I.BigNumber(o))}get computedCurrentTimerQuoteState(){return new Ho(this).getCurrentTimerQuoteState()}get computedRouterForSmartRouterStore(){return this.fromToStore?.computedIsSingleChain?this.quote?.bestRoute:this.pickRouter}get computedMediaForChangeSmartRouterData(){return qa()?.media==="sm"||this.isDialog}get computedQuoteAmount(){let{computedIsExactIn:t}=this.fromToStore;return t?this.quote?.bestRoute?.fromTokenAmount:this.quote?.bestRoute?.payAmount}get computedQuoteIntervalIsEmpty(){return this.computedQuoteInterval.type===X.EMPTY}get computedQuoteInterval(){let{safeMoonStore:t,fromToStore:e,approveStore:o,swapBtnStore:r,swapDappStore:n}=this.rootStore;if(t.computedHoneypot||e.computedFormToTokenIsLeverageToken)return{type:X.EMPTY};let i=Va.handleQuoteErrorState({quote:this.quote,honeypotToken:S(this,"rootStore.safeMoonStore.computedHoneypot",!1)})||this.accountStore.computedNonsupportChain,{from:c,computedNonsupportFacetToken:d}=this.fromToStore;if(i||d)return{type:X.EMPTY};if(n.checkShouldJumpToDapp())return{type:X.SHOULD_JUMP_DAPPS};if(this.computedNotSupportBtcAddress&&this.accountStore.isConnectedWallet)return{type:X.NOT_SUPPORT_BTC_ADDRESS_TYPE,text:this.quote.bestRoute?.errorMsg};if(this.computedIsNoOkxLiquidity)return{type:X.NOT_OKX_LIQUIDITY};if((!this.quoteScope||!e.computedIfQuote)&&this.fetchQuoteStatus!==3&&!o.computedIsCancelApproveStatus&&!this.computedPriceWarn.show&&!this.quote?.bestRoute?.errorMsg)return{type:X.EMPTY};if(this.computedCrossAccuracyLimit)return{type:X.CROSS_CHAIN_ACCURACY,text:f("swaptrade_card_tooltips_adjust_pay_token_decimal",{fromToken:c.tokenSymbol,value:this.computedCrossAccuracyLimit}),equation:f("swaptrade_card_tooltips_adjust_pay_token_decimal",{fromToken:W(c.tokenSymbol),value:this.computedCrossAccuracyLimit})};if(this.computedFacetTokenTips)return{type:X.FACET_TOKEN_SWAP_ERROR,text:this.computedFacetTokenTips};let{crossMiniAmount:p,crossMaxAmount:g}=this.quoteScope||{};if(I.BigNumber(c.amount).lt(I.BigNumber(p))){let T=z(p,{cutPriceText:!0,isFloor:!1});return{type:X.CROSS_CHAIN_MIN,text:f("swaptrade_bridge_toast_min_amout_crosschain_swap",{value:T,symbol:c.tokenSymbol}),equation:f("swaptrade_bridge_toast_min_amout_crosschain_swap",{value:T,symbol:W(c.tokenSymbol)})}}if(I.BigNumber(c.amount).gt(I.BigNumber(g))){let T=z(g,{cutPriceText:!0});return{type:X.CROSS_CHAIN_MAX,text:f("swaptrade_bridge_toast_max_amout_crosschain_swap",{value:T,symbol:c.tokenSymbol}),equation:f("swaptrade_bridge_toast_max_amout_crosschain_swap",{value:T,symbol:W(c.tokenSymbol)})}}return this.quote?.bestRoute?.errorMsg?{type:X.CROSS_CHAIN_MORE_TIPS,text:this.quote?.bestRoute?.errorMsg}:this.computedIsNoLiquidity?{type:X.NOT_LIQUIDITY}:this.computedCrossChainIntervalOutOfRange?{type:X.NOT_LIQUIDITY}:o.computedIsCancelApproveStatus&&!r.computedTooBalance?{type:X.CANCEL_APPROVE_TIPS}:this.computedPriceWarn.show?{type:X.PROVIDER_PRICE_WARN}:{type:X.EMPTY}}get computedNotSupportFromBtcAddressType(){let t=this.quote?.bestRoute?.code;return Number(t)===Mt.NOT_SUPPORT_FROM_BTC_ADDRESS}get computedNotSupportToBtcAddressType(){let t=this.quote?.bestRoute?.code;return Number(t)===Mt.NOT_SUPPORT_TO_BTC_ADDRESS}get computedNotSupportBtcAddress(){return this.computedNotSupportFromBtcAddressType||this.computedNotSupportToBtcAddressType}get computedCrossChainIntervalOutOfRange(){let{from:t}=this.fromToStore,{crossMiniAmount:e,crossMaxAmount:o}=this.quoteScope||{};return I.BigNumber(t.amount).lte(o)&&I.BigNumber(t.amount).gte(e)}get computedIsNoLiquidity(){return this.fetchQuoteStatus===3&&this.quote.quoteNull}get computedIsNoOkxLiquidity(){let t=this.quote?.bestRoute?.defiPlatformInfoList;return this.enableQuoteAggregates&&t&&this.aggregateFetchStatus===3?!t.some(o=>o?.defiPlatformId===nt):!1}get computedCrossAccuracyLimit(){let{crossAccuracyLimit:t,code:e}=this.quote.bestRoute||{};return Number(e)===Mt.CROSS_CHAIN_ACCURACY?t:""}get computedFacetTokenTips(){let{errorMsg:t,code:e}=this.quote.bestRoute||{};return[od,rd,sd].includes(Number(e))&&t?t:""}get computedYouSaveVisible(){let{computedNowCurrencySymbol:t,currencyConversion:e,computedIsWalletEnv:o}=this.commonStore,{computedIsExactIn:r,computedIsCrossChain:n}=this.rootStore.fromToStore,{quoteError:i,quoteNull:c,bestRoute:d}=this.quote;if(!r||i||c||!d?.youSaveDTO||n)return{visible:!1};let{youSaveDTO:m,fromToken:p,toToken:g}=d,{topTenDexInfoList:T,youSaveMoney:A}=m,w=Number(A)>=.1&&T?.length>0&&!p.isHoneypot&&!g.isHoneypot,N=e(A).toString(),O=w?at(N,t,{isFloor:!1}):"",dt=w?T?.[1]?.dexName:"";return o&&(!n&&this.computedTopTenDexInfoList.length>0?w=!0:w=!1),{visible:w,youSaveStr:O,dexName:dt}}get computedHasYouSave(){let{computedIsCrossChain:t}=this.rootStore.fromToStore;return!!this.quote?.bestRoute?.youSaveDTO||t}get computedTopTenDexInfoList(){if(!this.rootStore.fromToStore?.computedIsExactIn||!this.computedHasYouSave)return[];let{computedNowCurrencySymbol:t,currencyConversion:e}=this.commonStore;return this.quote?.bestRoute?.youSaveDTO?.topTenDexInfoList?.map(({logoUrl:o,dexName:r,comparePercent:n,price:i,dexAmountOut:c,amountOutOfMoney:d,gasOfMoney:m,isOkxDex:p})=>{let g=e(d)?.toString(),T=e(m)?.toString();return{logoUrl:o,dexName:r,comparePercent:n,price:i,isOkxDex:p,formatPrice:z(i),dexAmountOut:I.BigNumber(c).toString(),formatDexAmountOut:z(c),amountOutOfMoney:g,formatAmountOutOfMoney:at(g,t,{needBillionMillionUnit:!1}),gasOfMoney:at(T,t),symbol:t||""}})??[]}get computedReferredFee(){let{bestRoute:t}=this.quote,{referredNetWorkFee:e,referredAmount:o}=t||{};if(!o||!e)return"";let{computedNowCurrencySymbol:r,currencyConversion:n}=this.commonStore,{from:i}=this.fromToStore;return f("swaptrade_modal_desc_crosschain_valuediff_variavle",{price:`${z(o)} ${i.tokenSymbol}`,fee:`${at(n(e).toString(),r)}`})}get computedIsUsingCentralizedBridge(){let t=["8"],e=String(this.quote.bestRoute?.bridge?.bridgeId);return t.includes(e)}get computedIsNoQuote(){return this.quote.quoteError||this.quote.quoteNull||!this.quote.bestRoute||this.rootStore.safeMoonStore?.computedHoneypot||this.fromToStore.computedFormToTokenIsLeverageToken||this.rootStore.outerStore.computedFeeConfigErrorTips||!this.fromToStore.computedTypedValueIsValid}get computedSupportDappTradeByQuote(){return Number(this.quote?.bestRoute?.isSupportDappTrade)===1}setAggregateFetchStatus(t){return t}setAggregateSelectStatus(t){return t}setAggregateSelectId(t){return t}get computedIsOfflineType(){let{computedIsCrossChain:t}=this.rootStore.fromToStore;return t?Number(this?.quote?.bestRoute?.bridge?.bridgeType)===Xa.INTENT_BRIDGE:this?.quote?.bestRoute?.offlineType===Ya.YES}get computedIsFreeNetworkFee(){return this?.quote?.bestRoute?.bridge?.isFreeNetworkFee===$a.FREE_NETWORK_FEE}get computedIsOkxProvider(){return!this?.quote?.bestRoute?.defiPlatformId||this?.quote?.bestRoute?.defiPlatformId===nt}get computedBridgeIsOkxProvider(){let{defiPlatformId:t}=this?.quote?.bestRoute?.bridge||{};return!t||t===nt}get computedPriceWarn(){let t=I.BigNumber(this?.quote?.bestRoute?.reducePercent),e=I.BigNumber(this?.quote?.bestRoute?.warnPercent);return{show:t&&t.isGreaterThan(e)}}get computedreducePercent(){return ma(this?.quote?.bestRoute?.reducePercent)}};u();l();P();var nd=a=>{let{quoteStore:t,swapStore:e}=U();!a&&t.bridgeQuoteSelectStatus!==0&&(t.setBridgeNoRouteTipStatus(e.confirmSwapVisible?2:1),t.setBridgeQuoteSelectStatus(0))},Ru=a=>Number(a.commonDexInfo?.code)===Mt.CROSS_CHAIN_INTERVAL,id=a=>!a.pathSelectionRouterList?.length,ad=a=>Ru(a)||id(a),cd=a=>{let{quoteStore:t}=U(),e=Ru(a)?{crossMaxAmount:a.commonDexInfo?.crossMaxAmount,crossMiniAmount:a.commonDexInfo?.crossMiniAmount}:null;t.setQuoteScope(e)},ud=a=>{let{quoteStore:t}=U(),e=t.bridgeSelectId===vt?a[0]:a?.find(o=>o.bridge.bridgeId===t.bridgeSelectId);return nd(e),e||a[0]},ld=({data:a})=>{let{commonDexInfo:t,singleChainSwapInfo:e,swapType:o,pathSelectionRouterList:r,intentCode:n,isSupportDappTrade:i,offlineType:c,traceData:d}=a||{},m=r?.map((A,w)=>({commonDexInfo:t,...A,isBest:w===0})),p={intentCode:n,offlineType:c,swapType:o,traceData:d},g={...e,...t,swapType:o,pathSelectionRouterList:m},T=m?.map(A=>({...t,...A,...p,isSupportDappTrade:i}));return{bestRoute:g,combineSelectionRouterList:T}},dd=a=>{let{quoteStore:t,smartRouterStore:e}=U();if(e.showXRouteModal!==pr.XROUTER)return;let o=a.find(r=>r?.bridge?.bridgeId===t.pickRouter?.bridge?.bridgeId);o&&t.setPickRouter(o)},md=({bestRoute:a,bridgeInfo:t,isAutoError:e,originData:o,combineSelectionRouterList:r},{fromToStore:n,quoteStore:i})=>{let c=wt({},a,t);i.updateSlippageInfoFetched(c),i.setBridgeSelectId(c?.bridge?.bridgeId),i.setQuote({...i.quote,bestRoute:c,quoteNull:e,quoteError:null,isFetchQuoting:!1}),cd(o),e&&i.setBridgeFetchStatus(3),n.quoteUpdateFromTo(c),n.computedIsCrossChain&&(i.setPathSelectionRouterList(r||[]),dd(r||[]))},bu=a=>{let{fromToStore:t,quoteStore:e,approveStore:o}=U(),{bestRoute:r,combineSelectionRouterList:n}=ld({data:a}),i=ud(r.pathSelectionRouterList),c=ad(a);e.setQuoteNumber(e.quoteNumber+1),md({bestRoute:r,bridgeInfo:i,isAutoError:c,originData:a,combineSelectionRouterList:n},{fromToStore:t,quoteStore:e}),Go({isAutoError:c},{approveStore:o}),Qo({isAutoError:c},{quoteStore:e})};var ns=class extends Ue{constructor(e){super();this.isEnableBridgeQuoteSearch=!0;this.bridgeList=[];this.bridgeListPending=!0;this.bridgeQuoteSelectStatus=0;this.bridgeFetchStatus=0;this.bridgeNoRouteTipStatus=0;this.compareVisible=!1;this.dialogGroupVisibleStatus=1;this.bridgeSortType=0;this.setBridgeSelectId=e=>{this.bridgeSelectId=e};this.setBridgeQuoteSelectStatus=e=>{this.bridgeQuoteSelectStatus=e};this.setBridgeFetchStatus=e=>{this.bridgeFetchStatus=e};this.setBridgeNoRouteTipStatus=e=>{this.bridgeNoRouteTipStatus=e};this.setBridgeList=e=>{this.bridgeList=e};this.setBridgeListPending=e=>{this.bridgeListPending=e};this.setBridgeSortType=e=>{this.bridgeSortType=e};this.setCompareVisible=e=>{this.compareVisible=e};this.setDialogGroupVisibleStatus=e=>{this.dialogGroupVisibleStatus=e};this.getQuoteData=e=>{let o=$c();return this.bridgeFetchStatus===0&&this.setBridgeFetchStatus(1),_(io(()=>C.get(this.getQuoteStoreUrl(),{params:o,signal:e,isolate:!0}).then(r=>(this.setBridgeFetchStatus(2),this.handleUpdateQuote(r),this.setQuoteNumber(this.quoteNumber+1),this.quotePending=!1,r)).catch(r=>{throw y.stuff(r),r}),Ht.NUM,Ht.TIMER))};this.handleUpdateQuote=e=>{if(e){let{data:o}=e;bu(o)}};this.updateBestRoute=e=>{let o={...this.quote.bestRoute,...e};this.setQuote({...this.quote,bestRoute:o}),this.rootStore.fromToStore?.quoteUpdateFromTo(o)};this.handleQuoteError=(e=null)=>{this.setQuote({...this.initQuote,quoteError:e}),this.handleReverseQuoteErrorAndNull(),this.setBridgeFetchStatus(4)};lt(this),Object.assign(this,e),this.rootStore=e}getQuoteStoreUrl(){return Ti}};u();l();P();var Sd="1",Td="2",vu={minValue:.01,maxValue:.5},Lu={minValue:.03,maxValue:.5},qe=class{constructor(t){s(this,"slippageSetting",{autoIsSelected:!1,inputSlippage:""});s(this,"configSingle",vu);s(this,"configCross",Lu);s(this,"inputValue","");s(this,"inputCache","");s(this,"inputSlippageFocus",!1);s(this,"slippageNotice","");s(this,"hasSlippageError",!1);s(this,"hasSafeMoonWarning",!1);s(this,"isFrozen",!1);s(this,"frozenTooltip","");s(this,"clearNoticeAndError",()=>{this.slippageNotice="",this.hasSlippageError=!1});s(this,"setFrozenInfo",({computedSafeMoonNotSupport:t,isCrossBridgeOnly:e})=>{this.isFrozen=t||e,t?this.frozenTooltip=f("swaptrade_dialog_modal_current_notsupport"):e?this.frozenTooltip=f("swaptrade_dialog_modal_crosschain_notsupport"):this.frozenTooltip=""});s(this,"refreshInfo",()=>{let{inputSlippage:t}=this.slippageSetting;if(this.inputValue=t||"",this.computedSafeMoonTips||t!==""&&t!==void 0){let{computedSafeMoonTips:e,minSlippageShow:o,maxSlippageShow:r,computedAutoSlippage:n}=this,i=this.rootStore.fromToStore.computedIsSingleChain,{notice:c,isError:d,isWarning:m}=zr({inputSlippageParams:this.computedSlippageValue,computedSafeMoonTips:e,minSlippageShow:o,maxSlippageShow:r,autoSlippageValue:n,isSingleChain:i});this.slippageNotice=c,this.hasSlippageError=d,this.hasSafeMoonWarning=m}});s(this,"onFocus",()=>{this.inputSlippageFocus=!0,this.hasSafeMoonWarning=!1,this.inputCache&&(this.onInput(null,this.inputCache),this.inputCache="")});s(this,"onInput",(t,e="")=>{let o=t||e;this.templeAutoSelected=!1;let{computedSafeMoonTips:r,minSlippageShow:n,maxSlippageShow:i,computedAutoSlippage:c}=this,d=this.rootStore.fromToStore.computedIsSingleChain,{notice:m,isError:p,isWarning:g}=zr({inputSlippageParams:o,computedSafeMoonTips:r,minSlippageShow:n,maxSlippageShow:i,autoSlippageValue:c,isSingleChain:d});if(!me(J(o))){let A=/^0{2,}/gm;o=o.replace(A,"0"),this.inputValue=o}let T=o||this.computedSafeMoonTips;this.slippageNotice=T?m:"",this.hasSlippageError=p,this.hasSafeMoonWarning=g});s(this,"onBlur",()=>{this.inputSlippageFocus=!1});s(this,"onSelectCustom",()=>{let t=this.inputValue,{computedSafeMoonTips:e,minSlippageShow:o,maxSlippageShow:r,computedAutoSlippage:n}=this,i=this.rootStore.fromToStore.computedIsSingleChain,{slippage:c,inputValue:d,notice:m,isError:p}=zr({inputSlippageParams:t,computedSafeMoonTips:e,minSlippageShow:o,maxSlippageShow:r,autoSlippageValue:n,isSingleChain:i}),g=this.getSafeMoonStore();if(g.checkIsChanged&&g.checkIsChanged(t),e?this.inputValue=Yt(c):this.inputValue&&(this.inputValue=Yt(c),this.slippageNotice=m,this.hasSlippageError=p,this.hasSafeMoonWarning=!!e),(Number(t)===0||me(t))&&(this.slippageNotice=""),p){this.onSelectAuto(),this.inputSlippageFocus=!1;return}Fs({custom_or_auto:d?"custom":"auto"}),this.setSlippageSetting({autoIsSelected:!d,inputSlippage:d}),this.rootStore.quoteStore.fetchQuoteDebounce()});s(this,"onReset",()=>{let{inputSlippage:t}=this.slippageSetting;this.inputValue=t,this.clearNoticeAndError(),this.inputSlippageFocus=!1});this.rootStore=t,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore,this.smartRouterStore=t.smartRouterStore,L(this,{},{autoBind:!0})}getSafeMoonStore(){return this.rootStore.safeMoonStore}getOrderSlippageInfo(){let{autoIsSelected:t}=this.slippageSetting,e=cn(this.rootStore);return t||this.isFrozen?{autoSlippageInfo:e}:{customSlippage:String(this.computedRealSlippageValue),autoSlippageInfo:e}}get minSlippage(){let t=this.rootStore.fromToStore.computedIsSingleChain,{computedSafeMoonToken:e}=this.getSafeMoonStore();if(e){let o=I.BigNumber.max(this.configCross.minValue,this.configSingle.minValue);return o.isNaN()?.011:o.toString()}return t?this.configSingle.minValue:this.configCross.minValue}get maxSlippage(){return this.rootStore.fromToStore.computedIsSingleChain?this.configSingle.maxValue:this.configCross.maxValue}get minSlippageShow(){return I.mul(this.minSlippage,100)}get maxSlippageShow(){return I.mul(this.maxSlippage,100)}get computedAutoSlippage(){let{computedHoneypot:t}=this.getSafeMoonStore();if(t){let e=S(this,"rootStore.quoteStore.quote.bestRoute.realSlippage",0);return I.mul(e,100)}return Xr(this.rootStore)}get computedSafeMoonNotSupport(){let{computedHoneypot:t,computedSlippageTips:e}=this.getSafeMoonStore();return!!(t||e?.overLimit||e?.equalLimit)}get computedSafeMoonSlippage(){return this.getSafeMoonStore().computedSlippage}get computedSafeMoonTips(){return this.getSafeMoonStore().computedSlippageTips}get computedSafeMoonTip(){return this.getSafeMoonStore().computedSlippageTips?.tip}get computedSafeMoonPairSlippage(){return this.getSafeMoonStore().computedPairSlippage}get computedSlippageValue(){return this.getSlippageValue()}get computedRealSlippageValue(){let t=this.getSlippageValue();return Number(I.div(t,100))||0}isValidVolatilityTip(){if(Number(this.computedSlippageValue)>this.computedAutoSlippage)return!1;let t=this.getSafeMoonStore(),e=this.smartRouterStore;return t.computedSafeMoonToken===null&&!e?.isCrossBridgeOnly}get computedVolatilityTips(){if(!this.isValidVolatilityTip())return null;let{computedAutoSlippage:t}=this,e=this.rootStore?.quoteStore?.quote?.bestRoute||{},{priceFluctuationMonitorTime:o,priceFluctuationThreshold:r,fromPriceFluctuation:n,toPriceFluctuation:i,rateFluctuationThreshold:c,slippageFluctuationhold:d,rateFluctuation:m}=e,{from:p,to:g}=this.fromToStore,T=g?.tokenSymbol||"",A=p?.tokenSymbol||"",w=I.mul(d,100),N=I.mul(r,100),O=I.mul(c,100),dt=Number(m),tt=Number(c);if(t>w){if(dt<tt)return null;let yt=this.slippageSetting.autoIsSelected;return{tip:f("swaptrade_settings_alert_both_exchange_tips",{payToken:A,receiveToken:T,value:O,min:o}),tipEquation:f("swaptrade_settings_alert_both_exchange_tips",{payToken:W(A),receiveToken:W(T),value:O,min:o}),swapInterceptorType:yt?Q.VOLATILITY_SLIPPAGE:null}}else if(t===w){let yt=Math.abs(n),Wt=Math.abs(i),Lt=Number(r);if(yt>Lt&&Wt>Lt)return{tip:f("swaptrade_placeorder_alert_both_volatility",{payToken:A,receiveToken:T,value:N,min:o}),tipEquation:f("swaptrade_placeorder_alert_both_volatility",{payToken:W(A),receiveToken:W(T),value:N,min:o})};if(yt>Lt)return{tip:f("swaptrade_placeorder_alert_pay_receive_volatility",{token:A,value:N,min:o}),tipEquation:f("swaptrade_placeorder_alert_pay_receive_volatility",{token:W(A),value:N,min:o})};if(Wt>Lt)return{tip:f("swaptrade_placeorder_alert_pay_receive_volatility",{token:T,value:N,min:o}),tipEquation:f("swaptrade_placeorder_alert_pay_receive_volatility",{token:W(T),value:N,min:o})};if(dt>=tt)return{tip:f("swaptrade_settings_alert_both_exchange",{payToken:A,receiveToken:T,value:O,min:o}),tipEquation:f("swaptrade_settings_alert_both_exchange",{payToken:W(A),receiveToken:W(T),value:O,min:o})}}return null}getDefaultSetting(){let t={inputSlippage:"",autoIsSelected:!0},e=this.getSafeMoonStore();if(e.computedSafeMoonToken){let o=e.computedSlippage,r=Yt(o);e.isChanged&&r&&(t.inputSlippage=r,t.autoIsSelected=!1)}return t}getSlippageType(){return this.slippageSetting.autoIsSelected||this.isFrozen?ye.AUTO:ye.CUSTOM}getSlippageValue(t=this.slippageSetting){let{autoIsSelected:e,inputSlippage:o}=t;return e||this.isFrozen?this.computedAutoSlippage:o||this.computedAutoSlippage}setSlippageSetting(t){let e={...t},o=this.getSafeMoonStore(),{computedSafeMoonToken:r}=o;if(!r){this.slippageSetting=e;return}let n=this.getSlippageValue(e);if(n===this.getSlippageValue(this.slippageSetting)||o.isAccessSlippage(n)||!o.getSafemoonIsChangedLocal()){e.inputSlippage="",e.autoIsSelected=!0;let i=Yt(n);o.isChanged&&i&&(e.inputSlippage=i,e.autoIsSelected=!1),o.setSafeMoonPairSlippage(n),this.slippageSetting=e}}async initSlippageConfigs(){try{let{data:t}=await C.get(Vi),e=t?.find(({configId:r})=>Sd===r),o=t?.find(({configId:r})=>Td===r);e&&(this.configSingle=e),o&&(this.configCross=o)}catch{this.configSingle=vu,this.configCross=Lu}}initSlippageSetting(){let t=this.getDefaultSetting(),e;t?e={...t}:e={autoIsSelected:!0,inputSlippage:""},this.setSlippageSetting(e)}initReactions(){Et(()=>{let{from:t,to:e}=this.fromToStore;return{chainId:t.chainId,toChainId:e.chainId,fromTokenAddress:t.tokenContractAddress,toTokenAddress:e.tokenContractAddress}},({fromTokenAddress:t,toTokenAddress:e})=>t&&e?(this.rootStore.quoteStore.slippageInfoFetched=!1,this.clearNoticeAndError(),this.initSlippageSetting()):!1,{equals:zt.shallow}),Et(()=>{let t=this.fromToStore.from.chainId,{computedSafeMoonSlippage:e}=this;return{fromId:t,computedSafeMoonSlippage:e}},this.clearNoticeAndError,{equals:zt.shallow}),Et(()=>{let{computedSafeMoonPairSlippage:t}=this;return{computedSafeMoonPairSlippage:t}},()=>{this.initSlippageSetting()},{equals:zt.shallow}),Et(()=>{let{isCrossBridgeOnly:t}=this.smartRouterStore,{computedSafeMoonNotSupport:e}=this;return{computedSafeMoonNotSupport:e,isCrossBridgeOnly:t}},this.setFrozenInfo,{equals:zt.shallow}),Et(()=>{let{slippageSetting:t,isFrozen:e,computedSafeMoonTip:o}=this;return{slippageSetting:t,isFrozen:e,computedSafeMoonTip:o}},this.refreshInfo,{equals:zt.shallow})}onSelectAuto(t=!1){Fs({custom_or_auto:"auto"}),!this.hasSlippageError&&!this.hasSafeMoonWarning&&this.inputValue?this.inputCache=this.inputValue:this.inputCache="";let e={autoIsSelected:!0,inputSlippage:""};if(this.inputValue="",this.slippageNotice="",this.hasSlippageError=!1,this.hasSafeMoonWarning=!1,!t){let o=this.getSafeMoonStore();o.computedSafeMoonToken&&o.setSafeMoonIsChanged(!1),this.setSlippageSetting(e),this.rootStore.quoteStore.fetchQuoteDebounce()}}get computedMinimumReceived(){let{quote:t,computedIsOfflineType:e}=this.rootStore.quoteStore,{receiveAmount:o,minimumReceived:r}=t?.bestRoute||{},n=this.fromToStore.to?.tokenSymbol;if(this.hasSlippageError||!jt(o))return"--";let i=this.inputValue?I.div(this.inputValue,100):this.computedRealSlippageValue,c=e?r:I.mul(o,1-(jt(i)?i:0));return`${z(c,{needBillionMillionUnit:!1})} ${n}`}get computedMinimumReceivedIsOrange(){let{quote:t}=this.rootStore.quoteStore,e=this.computedMinimumReceived,o=t?.bestRoute?.receiveAmount,r=I.BigNumber(o);return!r.isZero()&&!r.isNaN()&&I.div(I.sub(r,e),r)>=.1}};u();l();P();M();var Sn=class{constructor(t){s(this,"checkCrossChainParams",()=>{let{quoteStore:t,receiveAddressStore:e}=this.rootStore,{quote:o}=t,r=this.checkCommonParams(),{receiveAddrObj:n}=e,i=S(o.bestRoute,"quoteNetWorkFeeOfMoney"),c=o?.bestRoute?.bridge?.bridgeId,d=n?.specifiedAddress;return{...r,fromSwapFeeUsd:i,bridgeId:c,receiveWalletAddress:d}});s(this,"checkCommonParams",()=>{let{accountStore:t,fromToStore:e,quoteStore:o}=this.rootStore,{from:r,to:n}=e;return{fromChainId:r.chainId,fromTokenAddress:r.tokenContractAddress,amount:o?.computedQuoteAmount,toChainId:n.chainId,toTokenAddress:n.tokenContractAddress,userWalletAddress:t.address,accountId:t.computedAccountId}});s(this,"repeatOrder",null);s(this,"checkRepeatOrder",async()=>{this.repeatOrder=null;let{fromChainId:t,...e}=this.checkCommonParams(),{quoteStore:{quote:o}}=this.rootStore,r=S(o.bestRoute,"fromSwapFeeUsd"),n={...e,chainId:t,fromSwapFeeUsd:r},[i,c]=await _(C.get(Ri,{params:n}));!i&&[ge.COMMON_REPEAT,ge.BTC_REPEAT,ge.FACET_REPEAT].includes(c?.data.repeatFlag)&&ft(()=>{let{orderId:d,enoughFlag:m}=c?.data??{};this.repeatOrder={enoughFlag:m,repeatFlag:c?.data.repeatFlag,id:d}})});s(this,"checkSwapMoreInfo",null);s(this,"checkCrossChainSwap",async()=>{this.checkSwapMoreInfo=null;let t=this.checkCrossChainParams(),[e,o]=await _(C.post(bi,{...t}));e||ft(()=>{this.checkSwapMoreInfo=o?.data})});L(this),this.rootStore=t}},is=Sn;u();l();M();var Ve=class{constructor(t){s(this,"swapOnDappBtnLoading",!1);s(this,"setSwapOnDappBtnLoading",t=>{this.swapOnDappBtnLoading=t});s(this,"refreshing",!1);s(this,"setRefreshing",t=>{this.refreshing=t});s(this,"dappListContainerVisible",!1);s(this,"setDappListContainerVisible",t=>{this.dappListContainerVisible=t});s(this,"fetchDappListError",!1);s(this,"setFetchDappListError",t=>{this.fetchDappListError=t});s(this,"availableNoticeVisible",!1);s(this,"setAvailableNoticeVisible",t=>{this.availableNoticeVisible=t});s(this,"dappList",[]);s(this,"setDappList",t=>{this.dappList=t});s(this,"getFetchParam",()=>{let{from:t,to:e,computedIsSingleChain:o}=this.fromToStore||{},r={},n="";return o?(n=Ji,r={chainId:t?.chainId,tokenAddress:e?.tokenContractAddress}):(n=Zi,r={fromChainId:t?.chainId,fromTokenAddress:t?.tokenContractAddress,toChainId:e?.chainId,toTokenAddress:e?.tokenContractAddress}),{url:n,params:r}});s(this,"fetchDappList",async t=>{t?(this.setFetchDappListError(!1),this.setRefreshing(!0)):this.setSwapOnDappBtnLoading(!0);let{url:e,params:o}=this.getFetchParam(),[r,n]=await _(C.get(e,{params:o}));if(this.setRefreshing(!1),this.setSwapOnDappBtnLoading(!1),r){if(Number(r.code)===40008){this.setAvailableNoticeVisible(!0);return}this.setFetchDappListError(!0),this.setDappListContainerVisible(!0);return}this.setDappList(n.data),this.setDappListContainerVisible(!0)});s(this,"getSupportDetail",(t={},e=!1)=>{let o=this.chainIsSupportMarket(t),r=this.chainIsSupportDappTrade(t),n=!!this.quoteStore?.computedSupportDappTradeByQuote,i=!o&&r,c=o&&r,d=o&&!r;return{chainSupportMarket:o,chainSupportDappTrade:r,quoteSupportDappTrade:n,balance:c||d,kline:c||d,klineJumpMarket:c||d,costValue:e&&c||d,valueDifference:d,liquidity:d,disableInput:i||c,showMax:d,showAddFund:d}});s(this,"mergeCurrencyInputProps",(t,e)=>({balanceStatus:e.balance?t.balanceStatus:rt.BALANCE_NOT_SHOW,costValue:e.costValue?t.costValue:"",valueDifference:e.valueDifference?t.valueDifference:{},disableInput:e.disableInput,showMax:e.showMax?t.showMax:!1,showMaxIcon:e.showMax?t.showMaxIcon:!1,showAddFund:e.showAddFund?t.showAddFund:!1}));s(this,"getCurrentFromToChainConfig",()=>{let t=this.fromToStore.from.chainId,e=this.fromToStore.to.chainId,o=this.commonStore.getChainByID(t),r=this.commonStore.getChainByID(e);return[o,r]});s(this,"chainIsSupportMarket",t=>Number(t?.isSupportMarket)===1);s(this,"chainIsSupportDappTrade",t=>Number(t?.isSupportDappTrade)===1);s(this,"bridgeSupportDappTrade",t=>Number(t?.supportLinkDapp)===1);s(this,"getSupportDappTradeByToken",()=>{let t=this.quoteStore?.computedSupportDappTradeByQuote,e=this.liquidityChooseStore?.computedIsSelectedAllDex;return this.fromToStore.computedIsSingleChain&&t&&e});s(this,"checkShouldJumpToDapp",()=>this.fromToStore.computedFormToTokenIsLeverageToken?!1:this.computedSupportDappTradeByChain?!0:this.getSupportDappTradeByToken());this.rootStore=t,this.commonStore=t.commonStore,this.fromToStore=t.fromToStore,this.quoteStore=t.quoteStore,this.liquidityChooseStore=t.liquidityChooseStore,L(this,{},{autoBind:!0})}get computedFromToSupportMarketAndDappTrade(){let[t,e]=this.getCurrentFromToChainConfig();return{from:{...this.getSupportDetail(t,!0)},to:{...this.getSupportDetail(e)}}}get computedFromToSupportMarket(){let[t,e]=this.getCurrentFromToChainConfig();return this.chainIsSupportMarket(t)&&this.chainIsSupportMarket(e)}get computedSupportDappTradeByChain(){let t=this.fromToStore.from.chainId,e=this.fromToStore.to.chainId,o=this.commonStore.getChainByID(t);if(this.fromToStore.computedIsSingleChain)return this.chainIsSupportDappTrade(o);let r=o?.bridgeSupportChainInfoList,n=Array.isArray(r)&&r.find(i=>Number(i.chainId)===Number(e));return this.bridgeSupportDappTrade(n)}};var lo=class extends _e{constructor(){super();s(this,"reset",()=>{this.receiveAddressStore=new Yr(this),this.outerStore=new ss(this),this.fromToStore=new xe(this),this.approveStore=new Ee(this),this.quoteStore=new ns(this),this.tokenModalStore=new Zr(this),this.safeMoonStore=new Be(this),this.walletContractStore=new jr(this),this.sendTransactionStore=new co(this),this.intentSwapStore=new Kr(this),this.swapCheckStore=new is(this),this.swapStore=new De(this),this.swapBtnStore=new Ne(this),this.mevStore=new rs(this),this.recentTransactionStore=new br(this),this.facetStore=new ts(this),this.liquidityChooseStore=new Fe(this),this.swapDappStore=new Ve(this),this.smartRouterStore=new kr(this),this.slippageStore=new qe(this),this.oneMoreOrderStore=new es(this),this.gasDropStore=new os});this.reset()}},jo=lo;s(jo,"instance",null),s(jo,"getInstance",()=>(lo.instance||(lo.instance=new lo),lo.instance));var wu=jo;u();l();u();l();var as=class extends Me{constructor(t){super(t),lt(this)}getSearchParams(t){return this.singleSearchParams(t)}};u();l();P();M();u();l();P();var Id=a=>{let{quoteStore:t,swapStore:e}=U();!a&&t.aggregateSelectStatus!==0&&(t.setAggregateNoRouteTipStatus(e.confirmSwapVisible?2:1),t.setAggregateSelectStatus(0))},Cd=a=>{let{quoteStore:t}=U(),e=t.aggregateSelectId===vt?a[0]:a.find(r=>r.defiPlatformId===t.aggregateSelectId),o=S(a.find(r=>r.defiPlatformId===nt),"dexRouterList",[]);return Id(e),wt({},e||a[0],{dexRouterList:o})},yd=({data:a,isCompareResult:t})=>{let{commonDexInfo:e,singleChainSwapInfo:o,swapType:r,isSupportDappTrade:n,defiPlatformInfoList:i,traceData:c}=a,d=i.map((p,g)=>({...p,isBest:g===0}));return{bestRoute:{...o,...e,isSupportDappTrade:t?n:"0",swapType:r,defiPlatformInfoList:d,traceData:c}}},Ad=({bestRoute:a,aggregateInfo:t,isAutoError:e},{fromToStore:o,quoteStore:r})=>{let n=wt({},a,t);r.updateSlippageInfoFetched(n),r.setAggregateSelectId(n.defiPlatformId),r.setQuote({...r.quote,bestRoute:n,quoteNull:e,quoteError:null,isFetchQuoting:!1}),e&&r.setAggregateFetchStatus(4),o.quoteUpdateFromTo(n)},kd=a=>{let{solanaPriorityFeeStore:t}=U();t&&a?.jitoData&&t.setJitoData(a?.jitoData)},Ou=a=>{let{fromToStore:t,quoteStore:e,approveStore:o}=U(),r=e.aggregateFetchStatus===3,{bestRoute:n}=yd({data:a,isCompareResult:r}),i=Cd(n.defiPlatformInfoList),c=r&&n.defiPlatformInfoList.length===0;e.setQuoteNumber(e.quoteNumber+1),Ad({bestRoute:n,aggregateInfo:i,isAutoError:c},{fromToStore:t,quoteStore:e}),kd(a),Go({isAutoError:c},{approveStore:o}),Qo({isAutoError:c},{quoteStore:e})};var cs=class extends Ue{constructor(e){super();this.enableQuoteAggregates=!0;this.setAggregateSelectId=e=>{this.aggregateSelectId=e};this.aggregateSelectStatus=0;this.setAggregateSelectStatus=e=>{this.aggregateSelectStatus=e};this.aggregateFetchStatus=0;this.setAggregateFetchStatus=e=>{this.aggregateFetchStatus=e};this.fetchOKXQuote=({params:e,signal:o})=>{this.aggregateFetchStatus!==3&&C.get(this.outerStore.aggregatorQuoteUrl(),{params:wt({},e,{defiPlatformIds:nt}),signal:o}).then(r=>{this.aggregateFetchStatus===1&&(this.setAggregateFetchStatus(2),this.handleUpdateQuote(r),this.setQuoteNumber(this.quoteNumber+1),this.quotePending=!1)}).catch(r=>{y.stuff(r)})};this.getQuoteData=e=>{let o=Nt();return this.fetchOKXQuote({params:o,signal:e}),_(io(()=>this.fetchAggregatesQuote({params:o,signal:e}),Ht.NUM,Ht.TIMER))};this.handleUpdateQuote=e=>{if(e){let{data:o}=e;Ou(o)}};this.updateBestRoute=e=>{let o={...this.quote.bestRoute,...e};this.setQuote({...this.quote,bestRoute:o}),this.rootStore.fromToStore?.quoteUpdateFromTo(o)};this.aggregateNoRouteTipStatus=0;this.setAggregateNoRouteTipStatus=e=>{this.aggregateNoRouteTipStatus=e};this.handleQuoteError=(e=null)=>{this.setQuote({...this.initQuote,quoteError:e}),this.handleReverseQuoteErrorAndNull(),this.setAggregateFetchStatus(5)};this.aggregatorList=[];this.setAggregatorList=e=>{this.aggregatorList=e};this.aggregatorListPending=!0;this.setAggregatorListPending=e=>{this.aggregatorListPending=e};this.fetchAggregatorList=()=>(this.setAggregatorListPending(!0),C.get(Ci).then(e=>{this.setAggregatorList(e.data)}).catch(()=>{this.setAggregatorList([])}).finally(()=>{this.setAggregatorListPending(!1)}));this.compareVisible=!1;this.setCompareVisible=e=>{this.compareVisible=e};this.dialogGroupVisibleStatus=1;this.setDialogGroupVisibleStatus=e=>{this.dialogGroupVisibleStatus=e};lt(this),Object.assign(this,e),this.rootStore=e}fetchAggregatesQuote({params:e,signal:o}){return C.get(this.outerStore.aggregatorQuoteUrl(),{params:e,signal:o,isolate:!0}).then(r=>(this.aggregateFetchStatus===2&&this.setAggregateSelectId(vt),this.setAggregateFetchStatus(3),r))}};u();l();u();l();var Pu=a=>{if(!a)return[];let{solPrice:t,solTokenSymbol:e,solDecimals:o}=a;return Ka.map(r=>({type:r,fee:a[r],usd:a[`${r}Usd`],solPrice:t,solTokenSymbol:e,solDecimals:o}))};var Tn=class{constructor(t){s(this,"visible",!1);s(this,"setVisible",t=>{this.visible=t});s(this,"feeType",Us.MARKET);s(this,"setFeeType",t=>{this.feeType=t});s(this,"customFee",null);s(this,"setCustomFee",t=>{this.customFee=t});s(this,"jitoData",null);s(this,"setJitoData",t=>{this.jitoData=t});this.rootStore=t,lt(this)}get computedPriorityFeeList(){return Pu(this.jitoData)}get computedPriorityFeeAmount(){return this.jitoData?this.feeType===Us.CUSTOM?this.customFee:this.computedPriorityFeeList.find(e=>e.type===this.feeType)?.fee:null}get computedPriorityFeeOfUsd(){if(!this.jitoData)return null;let{solPrice:t}=this.jitoData;return I.mul(this.computedPriorityFeeAmount,t,{returnString:!0})}},xu=Tn;var mo=class extends _e{constructor(){super();s(this,"reset",()=>{this.receiveAddressStore=new Yr(this),this.outerStore=new ss(this),this.fromToStore=new xe(this),this.approveStore=new Ee(this),this.quoteStore=new cs(this),this.tokenModalStore=new as(this),this.safeMoonStore=new Be(this),this.walletContractStore=new jr(this),this.sendTransactionStore=new co(this),this.intentSwapStore=new Kr(this),this.swapCheckStore=new is(this),this.swapStore=new De(this),this.swapBtnStore=new Ne(this),this.solanaPriorityFeeStore=new xu(this),this.mevStore=new rs(this),this.recentTransactionStore=new br(this),this.facetStore=new ts(this),this.liquidityChooseStore=new Fe(this),this.swapDappStore=new Ve(this),this.smartRouterStore=new kr(this),this.slippageStore=new qe(this),this.oneMoreOrderStore=new es(this)});this.reset()}},Ko=mo;s(Ko,"instance",null),s(Ko,"getInstance",()=>(mo.instance||(mo.instance=new mo),mo.instance));var Nu=Ko;u();l();var le=b(x());u();l();var Dt=b(x());u();l();var Du=b(x());M();var _d=(a,t)=>(0,Du.useCallback)(Fn(a,t),[a]),Mu=_d;u();l();P();M();u();l();async function YL(a){return await C.post("/priapi/v1/dx/trade/multi/meme/callData",a)}async function Fu(a){return await C.get("/priapi/v1/dx/trade/multi/tokens/meme/search",{params:a})}async function Bu(a){return await C.post("/priapi/v1/dx/trade/multi/order/meme/broadcast",a)}async function Uu(a){return await C.get("/priapi/v1/dx/trade/multi/tokens/meme/supportTokenInfo",{params:a})}var rw=async({inputContent:a,accountId:t,userUniqueId:e,walletId:o})=>{let[r,n]=await _(Fu({inputContent:a,accountId:t,userUniqueId:e,walletId:o,includeMarketInfo:!0}));return r?null:Is(S(n,"data.tokenInfo",{}),S(n,"data.marketTokenInfo",{}))},sw=async({chainId:a,accountId:t,userUniqueId:e,walletId:o})=>{let[r,n]=await _(Uu({chainId:a,accountId:t,userUniqueId:e,walletId:o,includeMarketInfo:!0}));return r?null:Is(S(n,"data",{}),S(n,"data.marketTokenInfo",{}))},qu=async(a,t)=>{let[e,o]=await _(C.get(gr,{params:a,signal:t}));return e?null:S(o,"data",{})};var Vu=()=>{let{memeBuyStore:a,memeSellStore:t}=G(),{isSellRoute:e}=qt(),o=(0,Dt.useCallback)(c=>{e?t.onSocketUpdateFromTokenBalance(c):a.onSocketUpdateFromTokenBalance(c)},[e,t,a]),r=t.fromToken?.tokenContractAddress,n=a.fromToken?.tokenContractAddress,i=(0,Dt.useMemo)(()=>e?r:n,[r,n,e]);return{updateTokenBalance:o,currentTokenAddress:i}},Ed=()=>{let a=(0,Dt.useRef)(null),t=(0,Dt.useRef)(null),{updateTokenBalance:e,currentTokenAddress:o}=Vu(),r=nc(),{chainId:n,accountId:i,userUniqueId:c,walletId:d,userWalletAddress:m,businessType:p}=r,g=(0,Dt.useCallback)(()=>{t.current&&clearInterval(t.current),typeof a.current?.abort=="function"&&a.current.abort()},[]);return{pollingTokenBalance:(0,Dt.useCallback)(()=>{g(),t.current=setInterval(async()=>{if(o&&n&&i&&c&&d&&m){a.current=$();let A=await qu({tokenAddress:o,chainId:n,accountId:i,userUniqueId:c,walletId:d,userWalletAddress:m,businessType:p},a.current.signal);A&&e(A)}},10*1e3)},[n,o,i,c,d,m,p,e,g]),cancelPolling:g}},Rd=()=>{let{memeAccountStore:a,memePositionStore:t,memeConfigStore:e,memeCommonStore:o}=G(),{computedAccountId:r,computedAccountWalletAddresses:n}=a,{userUniqueId:i}=o,{config:c}=e,{nativeTokenConfig:d}=c||{},{chainId:m}=d||{},{fetchPositionList:p}=t,g=Mu(p,300),{updateTokenBalance:T}=Vu(),{pollingTokenBalance:A,cancelPolling:w}=Ed();(0,Dt.useEffect)(()=>(n&&(ct.addListen("error",()=>{A()}),ct.addListen("connect",()=>{w()}),ct.addListen(Ro.WALLET_ASSET,N=>{N&&(g({chainId:m,accountId:r,userUniqueId:i}),T(N))}),ct.init(n)),()=>{ct.removeAll(),ct.wsInstance&&n&&ct.logout(n)}),[m,r,i,n,g,T,A,w])},Wu=Rd;u();l();u();l();var Hu=b(x());u();l();function us(){let{memeBuyStore:a,memeSellStore:t}=G(),{isSellRoute:e}=qt();return(e?t.fromToken:a.toToken)||{}}u();l();var Gu=(a,t)=>{let e={userUniqueId:a,tokenDetailList:[{chainId:t.chainId,contractAddress:t.tokenContractAddress,tokenSymbol:t.tokenSymbol,precision:t.decimals}]};return C.post(hr,e)},Qu=a=>(Array.isArray(a)?a:[a]).map(e=>({channel:Qa,chainId:e?.chainId,tokenAddress:e?.tokenContractAddress}));var bd=()=>{let a=us(),{memeCommonStore:t}=G();(0,Hu.useEffect)(()=>{!a.tokenContractAddress||!a.chainId||!t.userUniqueId||Gu(t.userUniqueId,a)},[t.userUniqueId,a.tokenContractAddress,a.chainId])},ju=bd;u();l();var In=b(x());u();l();var $u=b(x());u();l();M();var Ku=async({tokenContractAddress:a,accountId:t,chainId:e})=>{let[o,r]=await _(C.get(ea,{params:{tokenContractAddress:a,accountId:t,chainId:e}}));return!o&&r?r.data:{error:o}};u();l();var Yu=b(x());var vd=()=>{let{memeBuyStore:a,memeSellStore:t}=G(),{isSellRoute:e}=qt();return(0,Yu.useCallback)((o,r)=>{if(Ut(o,r)){let n={...o,chainId:Number(o.chainId)};e?t.onSocketUpdateFromToken(n):a.onSocketUpdateToToken(n)}},[e,t,a])},ls=vd;var Ld=()=>{let{memeAccountStore:a}=G(),{computedAccountId:t}=a,e=ls();return(0,$u.useCallback)(o=>{Ku({tokenContractAddress:o.tokenContractAddress,chainId:o.chainId,accountId:t}).then(r=>{if(r?.error)return;let n={...o,price:r.price,marketCap:r.marketCap};e(n,o)}).catch(()=>{})},[e,t])},Xu=Ld;var wd=()=>{let a=us(),{memeCommonStore:t}=G(),{marketWsIsConnected:e}=t,o=ls(),r=Xu();(0,In.useEffect)(()=>{Ha.connect(()=>{t.setMarketWsIsConnected(!0)})},[]),(0,In.useEffect)(()=>{if(!a.tokenContractAddress||!a.chainId)return()=>{};if(!e)return()=>{};let n=Qu(a),i=ja({subscribeParams:n,onListenData:c=>{o(c[0],a)},onListenError:()=>{r(a)},onListenReconnected:()=>{r(a)}});return()=>{i()}},[a.tokenContractAddress,a.chainId,e,o])},zu=wd;var Od=()=>{ju(),zu()},Ju=Od;u();l();var We=b(x()),Zu=b(Ot());var Pd=({currency:a,currentWallet:t,walletInfo:e,keyringIdentityTypeEnum:o,addressBookList:r,walletList:n,t:i,dispatch:c,onBack:d})=>{let{memeCommonStore:m,memeAccountStore:p,reset:g}=G(),T=(0,Zu.useHistory)();(0,We.useEffect)(()=>{R.setRuntimeContext({history:T,toLocale:i,dispatch:c,walletInfo:e,onBack:d})},[i,T,c,e,d]),(0,We.useEffect)(()=>{t&&p.setWalletConfig(t)},[t]),(0,We.useEffect)(()=>(m.getUserUnit(a),()=>{g()}),[]),(0,We.useEffect)(()=>{p.setAddressBookList(r)},[r]),(0,We.useEffect)(()=>{p.setWalletList(n)},[n]),(0,We.useEffect)(()=>{p.setKeyringIdentityTypeEnum(o)},[o])},tl=Pd;u();l();var Ct=b(x()),po=b(Ot());M();u();l();var ue=b(x()),ms=b(Ot()),nl=b(Da());u();l();var el=b(x());var Yo=class extends el.PureComponent{constructor(t){super(t),this.state={hasError:!1,error:void 0,errorInfo:{}}}static getDerivedStateFromError(){return{hasError:!0}}componentDidCatch(t,e){this.setState({error:t,errorInfo:e}),y.error(v.ERROR_BOUNDARY,{error:t,errorInfo:e}),this.props.onError&&this.props.onError(t,e)}render(){let{error:t,errorInfo:e,hasError:o}=this.state;return o?this.props.fallbackComponent({error:t,errorInfo:e}):this.props.children}};u();l();var Cn=b(x());M();var xd=()=>Cn.default.createElement("div",{className:"mt-50"},Cn.default.createElement(Qn,{pastDelay:!1,error:!0,delayTime:1e4,alt:"dexGenericError",retry:()=>{qn(Un().pathname,"_self")}})),ol=xd;u();l();var ds=b(x());u();l();function rl(){let{memeBuyStore:a,memeSellStore:t}=G(),{isSellRoute:e}=qt(),o=(e?t.fromToken:a.fromToken)||{},r=(e?t.toToken:a.toToken)||{};return{fromToken:o,toToken:r}}var Nd=()=>{let{memeCommonStore:a}=G(),{fromToken:t}=rl(),{isSellRoute:e}=qt(),{chainId:o,isNativeToken:r,tokenContractAddress:n}=t,{visibleAddFunds:i,setAddFundsVisible:c}=a,d=Ta(),m=(0,ds.useMemo)(()=>d?!0:!!e,[d,e]);return ds.default.createElement(Mr,{visible:i,params:{chainId:o,tokenContractAddress:r?"":n,receiveOnly:m},onBack:()=>{c(!1)}})},sl=et(Nd);var Dd=[Ie,Je],Md=({children:a,onBack:t})=>{let{showNavigator:e,title:o,closeable:r}=Fr(!1),n=(0,ms.useLocation)(),i=(0,ms.useHistory)(),{isTelegramMiniApp:c}=R.global,{Navigator:d}=R.components,{memeCommonStore:m}=G(),{setAddFundsVisible:p}=m;(0,ue.useEffect)(()=>{p(!1)},[]),za();let g=()=>{t?t(i.goBack,Dd.includes(n.pathname)):i.goBack()};return ue.default.createElement(Yo,{fallbackComponent:ol},ue.default.createElement("div",{className:(0,nl.default)("universe-swap background-base-primary",Vt.wrapper)},e?ue.default.createElement(d,{title:o,onBack:g,closeable:r}):null,ue.default.createElement("div",{id:"meme-swap-container",className:c?Vt.memeTelegramContainer:Vt.extensionContainer},a)),ue.default.createElement(sl,null))},il=et(Md);var al=(0,Ct.lazy)(()=>import("./Buy-LW76XXM4.js")),Fd=(0,Ct.lazy)(()=>import("./Sell-TT4THT7A.js")),Bd=(0,Ct.lazy)(()=>import("./Configure-BSCSKTGB.js")),Ud=(0,Ct.lazy)(()=>import("./TokenList-X3IWUTRT.js")),qd=(0,Ct.lazy)(()=>import("./HighRisk-4Q7MEADX.js")),Vd=({onBack:a})=>Ct.default.createElement(il,{onBack:a},Ct.default.createElement(Ct.Suspense,null,Ct.default.createElement(po.Switch,null,[{path:Ie,component:al,exact:!0},{path:Je,component:Fd,exact:!0},{path:dr,component:Bd,exact:!0},{path:lr,component:Ud,exact:!0},{path:mr,component:qd,exact:!0}].map(e=>Ct.default.createElement(po.Route,{key:e.path,path:e.path,component:e.component,exact:e.exact})),Ct.default.createElement(po.Redirect,{from:Ie,to:{pathname:al,search:new Vn().getAll()},strict:!0,exact:!0})))),cl=Vd;var Wd=({currency:a,currentWallet:t,keyringIdentityTypeEnum:e,addressBookList:o,walletList:r,walletInfo:n,onBack:i,t:c,dispatch:d})=>{tl({currency:a,currentWallet:t,walletInfo:n,keyringIdentityTypeEnum:e,addressBookList:o,walletList:r,t:c,dispatch:d,onBack:i}),Wu(),Ju();let{memeAccountStore:{address:m,setFromChainId:p},memeConfigStore:{fetchConfig:g,config:T},memeBuyStore:{setSelectBuyValue:A},memeSellStore:{setSelectSellValue:w}}=G();(0,le.useEffect)(()=>{y.setTags({address:m})},[m]),(0,le.useEffect)(()=>{g()},[]),(0,le.useEffect)(()=>{T&&(w(T.defaultSellPercentList[0]),A(T.defaultBuyAmountList[0]),p(T?.nativeTokenConfig?.chainId))},[T]);let{initialized:N}=Nr();return N?le.default.createElement(cl,{onBack:i}):null},ul=(0,le.memo)(et(Wd));u();l();u();l();P();M();var ps=class{constructor(){this.loading=!0;this.setLoading=t=>{this.loading=t};this.fromToken=null;this.setFromToken=t=>{this.fromToken=t};this.toToken=null;this.setToToken=t=>{this.toToken=t};this.onSocketUpdateToToken=t=>{Ut(t,this.toToken)&&this.setToToken({...this.toToken,...t})};this.onSocketUpdateFromTokenBalance=t=>{Ut(t,this.fromToken)&&this.setFromToken({...this.fromToken,amountNum:t.coinAmountOriginalDec})};this.selectBuyValue="0";this.setSelectBuyValue=t=>{this.selectBuyValue=t};this.inputBuyValue="";this.setInputBuyValue=t=>{this.inputBuyValue=t};L(this)}get computedBuyNumber(){try{return this.selectBuyValue===Lo?this.inputBuyValue?parseFloat(this.inputBuyValue):"0":this.selectBuyValue||"0"}catch(t){return y.stuff(t),"0"}}get computedBuyTokenSymbol(){return S(this,"toToken.tokenSymbol")}get computedBuyNumberIsValid(){return new Gt.BigNumber(this.computedBuyNumber).gt(0)}};u();l();M();var hs=class{constructor(){this.config=null;this.setConfig=t=>{this.config=t};this.initLoading=!0;this.setInitLoading=t=>{this.initLoading=t};this.fetchConfig=async()=>{let[t,e]=await _(C.get(oa));t||e&&e.data&&(this.setConfig(e.data),this.setInitLoading(!1))};L(this)}};u();l();M();var fs=class{constructor(){this.initState=!1;this.setInitState=t=>{this.initState=t};this.positionList=[];this.setPositionList=t=>{this.positionList=t};this.fetchPositionLoading=!0;this.setFetchPositionLoading=t=>{this.fetchPositionLoading=t};this.cancelFetchRef=null;this.fetchPositionList=async({accountId:t,userUniqueId:e,chainId:o})=>{if(!t||!e||!o)return;this.cancelFetchRef&&this.cancelFetchRef.abort(),this.setFetchPositionLoading(!0),this.cancelFetchRef=$();let[r,n]=await _(C.get(ra,{params:{accountId:t,userUniqueId:e,chainId:o},signal:this.cancelFetchRef?.signal}));r&&y.stuff(r),n&&n.data&&this.setPositionList(n?.data),this.setFetchPositionLoading(!1),this.setInitState(!0)};L(this)}isCancel(t){return Tt(t)}};u();l();P();M();var yn=class{constructor(){this.quoteLoading=!1;this.quoteData=yn.INIT_QUOTE_DATA;this.isAutoQuote=!0;this.cancelRef=null;this.cleanMemeQuoteTimer=()=>{this.cancelRef&&this.cancelRef.abort(),this.timerRef&&clearTimeout(this.timerRef),this.setQuoteLoading(!0)};this.initLoading=!0;this.slippage={value:"0.1",type:"low",config:{low:"0.1",medium:"0.15",high:"0.5"},min:"0.05",max:"0.5"};this.setSlippage=t=>{this.slippage=t};this.priorityFee={value:"",type:"market",config:{market:"",fast:"",turbo:""},max:"5"};this.setPriorityFee=t=>{this.priorityFee=t};this.isQuoteImmediate=t=>!!t.chainId&&!!t.fromTokenAddress&&!!t.toTokenAddress&&Number(t.amount)>0;this.timerRef=null;this.startingPoll=async t=>{if(this.timerRef&&clearTimeout(this.timerRef),!this.isQuoteImmediate(t)){this.setIsInitLoading(!1);return}await this.fetchQuoteData(t),this.timerRef=setTimeout(async()=>{await this.startingPoll({...t,isAuto:!0})},5e3)};this.fetchMemeQuote=Qe(this.startingPoll,cr);L(this,{},{autoBind:!0})}setQuoteLoading(t){this.quoteLoading=t}setQuoteData(t){this.quoteData=t}setIsAutoQuote(t){this.isAutoQuote=t}setIsInitLoading(t){this.initLoading=t}async fetchQuoteData({isAuto:t,...e}){this.setQuoteLoading(!0),this.setIsAutoQuote(t),this.cleanMemeQuoteTimer(),this.cancelRef=$();let[o,r]=await _(C.get(ia,{params:e,signal:this.cancelRef.signal}));if(!Tt(o)&&o){let n={...r||{},...o};this.setQuoteData(n)}else this.setQuoteData(r||{});this.setIsInitLoading(!1),this.setQuoteLoading(!1),this.setIsAutoQuote(!1)}get computedPriorityFeeInfo(){return S(this.quoteData,"data.memeModeCommonDexInfo.priorityFeeInfo",{})}get computedSlippage(){return S(this.quoteData,"data.memeModeCommonDexInfo.slippage","--")}get computedFromTokenValue(){return S(this.quoteData,"data.memeModeCommonDexInfo.fromTokenPrice","0")}get computedToTokenAmount(){return S(this.quoteData,"data.memeModeSingleChainSwapInfo.receiveAmount","0")}get computedToTokenValue(){return S(this.quoteData,"data.memeModeSingleChainSwapInfo.toTokenPrice","0")}get computedQuoteErrorMsg(){return S(this.quoteData,"error_message","")}get computedQuoteErrorCode(){return S(this.quoteData,"error_code")}get computedQuoteIsError(){return this.computedQuoteErrorCode&&this.computedQuoteErrorCode!=="0"}get computedQuoteNetworkError(){return!this.computedQuoteErrorCode&&this.quoteData.err}get computedQuoteLiquidityError(){return this.computedQuoteErrorCode&&!S(this.quoteData,"data.memeModeSingleChainSwapInfo")}get computedQuoteIsHoneypot(){return this.computedQuoteErrorCode&&(S(this.quoteData,"data.memeModeSingleChainSwapInfo.toToken.isHoneypot")||S(this.quoteData,"data.memeModeSingleChainSwapInfo.fromToken.isHoneypot"))}get computedGetRouterList(){return S(this.quoteData,"data.memeModeSingleChainSwapInfo.dexRouterList")}get computedGetEstimateGasFee(){return S(this.quoteData,"data.memeModeSingleChainSwapInfo.estimateGasFee")}get computedGetQuoteFrom(){return S(this.quoteData,"data.memeModeCommonDexInfo.fromToken",{})}get computedGetQuoteTo(){return S(this.quoteData,"data.memeModeCommonDexInfo.toToken",{})}get computedGetQuoteFromAmount(){return S(this.quoteData,"data.memeModeCommonDexInfo.fromTokenAmount")}get computedGetQuoteToAmount(){return S(this.quoteData,"data.memeModeSingleChainSwapInfo.receiveAmount")}get computedQuoteTraceData(){return S(this.quoteData,"data.traceData")}get computedGetQuoteTokenTax(){return S(this.quoteData,"data.memeModeCommonDexInfo.tokenTax","")}get computedCustomQuoteLoading(){return!this.isAutoQuote&&this.quoteLoading}get computedQuoteIsInvalid(){return this.computedQuoteIsError||this.computedQuoteNetworkError||this.computedQuoteLiquidityError||this.computedQuoteIsHoneypot}},$o=yn;$o.INIT_QUOTE_DATA={data:null,detailMsg:"",code:void 0,error_code:"",error_message:"",msg:"",err:null};u();l();P();M();var gs=class{constructor(){this.loading=!0;this.setLoading=t=>{this.loading=t};this.fromToken=null;this.setFromToken=t=>{this.fromToken=t};this.onSocketUpdateFromToken=t=>{Ut(t,this.fromToken)&&this.setFromToken({...this.fromToken,...t})};this.onSocketUpdateFromTokenBalance=t=>{Ut(t,this.fromToken)&&this.setFromToken({...this.fromToken,amountNum:t.coinAmountOriginalDec})};this.toToken=null;this.setToToken=t=>{this.toToken=t};this.selectSellValue="0";this.setSelectSellValue=t=>{this.selectSellValue=t};this.inputSellValue="";this.setInputSellValue=t=>{this.inputSellValue=t};this.isInputPercent=!0;this.setIsInputPercent=t=>{this.isInputPercent=t};L(this)}get computedSellNumber(){try{let t=Math.min(this.fromToken?.decimals||0,12),e=new Gt.BigNumber(this.inputSellValue||"0");if(this.selectSellValue===Lo&&!this.isInputPercent)return this.inputSellValue?parseFloat(this.inputSellValue):"0";let o=new Gt.BigNumber(this.fromToken?.amountNum||"0");if(this.selectSellValue===Lo&&this.isInputPercent){let i=e.multipliedBy(o).dividedBy(100);return parseFloat(i.toFixed(t,Gt.BigNumber.ROUND_DOWN)).toString()}let n=new Gt.BigNumber(this.selectSellValue).multipliedBy(o);return parseFloat(n.toFixed(t,Gt.BigNumber.ROUND_DOWN)).toString()}catch(t){return y.stuff(t),"0"}}get computedSellTokenSymbol(){return S(this,"fromToken.tokenSymbol")}get computedSellTokenBalanceLessAmount(){return S(this,"fromToken.computedSellNumber")>S(this,"fromToken.amountNum")}get computedSellNumberIsValid(){return new Gt.BigNumber(this.computedSellNumber).gt(0)}};u();l();M();var Ss=class{constructor(){this.searchValue="";this.setSearchValue=t=>{this.searchValue=t};this.defaultSearchLoading=!0;this.setDefaultSearchLoading=t=>{this.defaultSearchLoading=t};this.searchLoading=!1;this.setSearchLoading=t=>{this.searchLoading=t};this.commonSearchState=!1;this.setCommonSearchState=t=>{this.commonSearchState=t};this.normalTokenList=[];this.unsupportedTokenList=[];this.fetchDefaultTokenList=async({chainId:t,computedAccountId:e,userUniqueId:o})=>{this.setDefaultSearchLoading(!0),this.setCommonSearchState(!1);let[r,n]=await _(C.get(sa,{params:{chainId:t,accountId:e,userUniqueId:o}}));if(this.searchValue){this.setDefaultSearchLoading(!1);return}r&&(y.stuff(r),this.normalTokenList=[],this.unsupportedTokenList=[]),n&&n.data&&(this.normalTokenList=n?.data||[],this.unsupportedTokenList=[]),this.setDefaultSearchLoading(!1)};this.cancelSearchRef=null;this.fetchSearchTokenList=async({chainId:t,computedAccountId:e,userUniqueId:o})=>{if(!this.searchValue)return;this.cancelSearchRef&&this.cancelSearchRef.abort(),this.setSearchLoading(!0),this.setCommonSearchState(!0),this.cancelSearchRef=$();let[r,n]=await _(C.get(na,{params:{chainId:t,accountId:e,userUniqueId:o,inputContent:this.searchValue},signal:this.cancelSearchRef?.signal}));if(!this.searchValue){this.setSearchLoading(!1);return}r&&!this.isCancel(r)&&(y.stuff(r),this.normalTokenList=[],this.unsupportedTokenList=[]),n&&n.data&&(this.normalTokenList=n?.data?.memeList,n?.data?.memeUnsupportList?this.unsupportedTokenList=n?.data?.memeUnsupportList.map(i=>{let c=i;return c.unSupportedMeme=!0,c}):this.unsupportedTokenList=[]),this.setSearchLoading(!1)};this.highRiskToken=null;this.setHighRiskToken=t=>{this.highRiskToken=t};this.highRiskCallBack=()=>{};this.setHighRiskCallBack=t=>{this.highRiskCallBack=t};L(this)}isCancel(t){return Tt(t)}};u();l();P();var Ts=class{constructor(){this.isSwapLoading=!1;L(this,{},{autoBind:!0})}setIsSwapLoading(t){this.isSwapLoading=t}getSolanaUnsignedTx(t){let e=S(t,"calldataParams.enableJito"),o=t?.unsignedTx||"{}";try{return e?JSON.parse(o).array:[JSON.parse(o)]}catch(r){throw new Error(r)}}getJitoTxData(t){let e=new ve,o=this.getSolanaUnsignedTx(t);return Promise.all(o.map(e.txData))}async onSolanaSwap({data:t,signedTransactions:e,txArray:o}){try{let r=S(t,"calldataParams.enableJito"),n=await $s({walletId:t.walletId,swapParams:t.calldataParams,signedTransactions:e,txArray:o,enableJito:r,isMemeMode:!0});y.info(v.MEME_SWAP_BROADCAST_PARAMS,{data:{...t,solanaBroadcastParams:n,unsignedTxArray:o,signedTransactions:e}});let i=await Bu(n);return y.info(v.MEME_SWAP_BROADCAST_SUCCESS,{data:{...t,solanaBroadcastParams:n,unsignedTxArray:o,signedTransactions:e,broadcastRes:i}}),i}catch(r){throw y.error(v.MEME_SWAP_BROADCAST_ERROR,{data:{error:r,...t,unsignedTxArray:o,signedTransactions:e}}),this.broadcastErrorMessage(r),new Error(r?.error_message)}}broadcastErrorMessage(t){let e=null;try{e=JSON.parse(t?.error_message)}catch{e=""}Qt.error({title:e||f("swaptrade_home_toast_broadcast_failed")})}};var de=class{constructor(){this.reset=()=>{this.memeCommonStore=new ke(this),this.memeAccountStore=new qr(this),this.sendTransactionStore=new co,this.memeConfigStore=new hs,this.memeBuyStore=new ps,this.memeSellStore=new gs,this.memePositionStore=new fs,this.memeQuoteStore=new $o,this.memeTokenListStore=new Ss,this.memeSwapStore=new Ts};this.reset()}static getInstance(){return de.instance||(de.instance=new de),de.instance}},ll=de;var Qd=({localeData:a,...t})=>{let e=(0,dl.useLocation)(),o;return e.pathname.includes(St)?o=E.BRIDGE:e.pathname.includes(ua)?o=E.LIMIT_ORDER:e.pathname.includes("/dex-swap/meme")?o=E.MEME_SWAP:e.pathname===pt&&(o=E.SWAP),o===E.MEME_SWAP?Ge.default.createElement(Or,{localeData:a,isDev:!0,noRemoteData:!0},Ge.default.createElement(la.Provider,{value:ll.getInstance()},Ge.default.createElement(ul,{...t}))):Ge.default.createElement(Or,{localeData:a,isDev:!0,noRemoteData:!0},Ge.default.createElement(cc,{swapRootStore:Nu,bridgeRootStore:wu,initTab:o},Ge.default.createElement(Wc,{currentTab:o,...t})))};var sN=et(Qd);export{Mu as a,YL as b,rw as c,sw as d,qu as e,rl as f,sN as g};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-IHQQQ2WB.js.map
