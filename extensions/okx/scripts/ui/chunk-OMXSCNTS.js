import{a as it}from"./chunk-HTSNA4MQ.js";import{a as at}from"./chunk-JMUBF4HO.js";import{a as et,b as ot,c as nt}from"./chunk-BSTZKYKS.js";import{a as Qe,e as $e}from"./chunk-74FDEN4I.js";import{a as rt}from"./chunk-34SDSJSV.js";import{a as Je}from"./chunk-BWEVT6TQ.js";import{a as tt}from"./chunk-YUU6WMAM.js";import{a as je}from"./chunk-WJYVGS4V.js";import{a as re}from"./chunk-CSJR56CD.js";import{a as st}from"./chunk-UR2TI236.js";import{a as Ze}from"./chunk-XWRXEU7I.js";import{e as Ke,g as He,h as Xe}from"./chunk-3V4N3SLP.js";import{a as Se}from"./chunk-GANFA4Y3.js";import{e as j}from"./chunk-75JFJJ6E.js";import{d as z}from"./chunk-MUF5KFVU.js";import{b as ae}from"./chunk-33CD6775.js";import{i as Ve}from"./chunk-3MOQA4IF.js";import{h as Ue,i as We}from"./chunk-NRDSUSOX.js";import{a as ve}from"./chunk-SF4X4VPT.js";import{i as qe}from"./chunk-DS7KEGTF.js";import{o as Wt}from"./chunk-XHNZXPBB.js";import{G as Me,Ga as X,Ha as ye,Ia as Z,Ja as De,Ka as Ge,La as ze,U as be,ac as ne}from"./chunk-ZTS7374H.js";import{Na as te,Ra as Ee}from"./chunk-EY7FXYAJ.js";import{d as Re,f as Ut}from"./chunk-B26CCOB3.js";import{e as Ye}from"./chunk-XIAMW27T.js";import{D as k,Z as W}from"./chunk-QYHQY2ME.js";import{$ as ee,A as H,Db as Fe,Fb as v,Jb as pe,Kb as fe,Mb as xe,U as Ae,Wc as Le,Xa as _e,Xc as zt,cc as de}from"./chunk-IS2B3ORW.js";import{c as Pe}from"./chunk-TDPA2BUG.js";import{K as $,a as Ie,f as Ne,pa as me}from"./chunk-BJO2AFCW.js";import{M as le,l as we,w as U}from"./chunk-OIAB2YVD.js";import{a as b}from"./chunk-DAL2TMJA.js";import{T as Te,V as Oe,_ as Be,aa as ge,t as Ce,u as ke,v as oe}from"./chunk-IEDGM2AY.js";import{b as Vt}from"./chunk-HUENZ3FY.js";import{f as N,m as c,o as u}from"./chunk-JEQEC2HU.js";c();u();var he=N(b());c();u();var mt=N(b());c();u();var ct=N(ne());c();u();Ut();function ie(t){return async()=>await Re().handleTxBySigner(t)}_e();function Yt({walletId:t,method:r,message:n,onConfirm:o}){let e=(0,ct.useDispatch)();return async()=>{let s=await e(ie({walletId:t,localType:ee,method:r,params:{message:n}})),{publicKey:m,signature:i}=s||{},l=Ge(De(m),i);return o(l)}}var ut=Yt;var lt=t=>{let{walletId:r,method:n,params:o,source:e,onConfirm:a,onCancel:s}=t,m=typeof o?.message=="string"?o?.message:new TextDecoder().decode(o?.message),i=at({unapproved:t}),l=ut({walletId:r,method:n,message:m,onConfirm:a}),S,p,d;return e!=="dapp"&&(S=l,p=!0,d=s),mt.default.createElement(rt,{message:m,unapproved:t,tipMessage:i,onConfirm:S,onConfirmReplace:p,onCancel:d})};c();u();var kt=N(b());c();u();var V=N(b());me();le();Ae();c();u();var gt=N(b());me();c();u();var L=N(b());de();c();u();var pt=N(Vt());zt();de();async function ft(t){let{SolWallet:r}=await Ve(),n=new r,o=[];try{let e=(t||[]).filter(Boolean);e.length>0&&(o=await n.deserializeMessages({data:e}))}catch{}return(o||[]).reduce(({totalPriorityFee:e,priorityFees:a},s,m)=>{let{deserialized:i,computeUnitLimit:l,computeUnitPrice:S}=s||{};if(i){let p=ze(l,S);e=v(e,p),a[m]=p}else a[m]="0";return{totalPriorityFee:e,priorityFees:a}},{totalPriorityFee:"0",priorityFees:[]})}var qt="SetComputeUnitLimit",vt="SetComputeUnitPrice";function dt(t,r,n){if(pe(r||0,0)||pe(n||0,0)||t.some(m=>{try{let i=Be.decodeInstructionType(m);return i===qt||i===vt}catch{return!1}}))return t;let e=[...t],a=ge.setComputeUnitPrice({microLamports:r});e.unshift(a);let s=ge.setComputeUnitLimit({units:n});return e.unshift(s),e}async function Kt(t,r,n){let o=new Oe(Le.requestSolanaMethodUrlToFullnode);o._rpcRequest=be;let e=await Promise.all((t.message?.addressTableLookups||[]).map(i=>o.getAccountInfo(i.accountKey).then(l=>new Te({key:i.accountKey,state:Te.deserialize(l.data)})))),a=ke.decompile(t.message,{addressLookupTableAccounts:e});a.instructions=dt(a.instructions,r,n);let s=new oe(a.compileToV0Message(e)),m=Z(s);return X(s,m)}async function Ct(t,r,n){return new Promise(o=>{try{let e=pt.base.fromBase58(t);try{e=Ce.from(e)}catch{e=oe.deserialize(e)}if(e.signatures&&e.signatures.length>1){o(t);return}if(e instanceof Ce){e.instructions=dt(e.instructions,r,n);let a=Z(e);o(X(e,a))}else e instanceof oe?Kt(e,r,n).then(o).catch(()=>{o(t)}):o(t)}catch{o(t)}})}function Ht({coinId:t,transactions:r,address:n,replace:o,disabled:e,unitLimits:a,signInfo:s}){let[m,i]=(0,L.useState)(0),[l,S]=(0,L.useState)(null),[p,d]=(0,L.useState)([]),[g,f]=(0,L.useState)("0"),[h,y]=(0,L.useState)([]),[F,T]=(0,L.useState)(!1),I=l?.fee||"0",[O,w]=(0,L.useState)(r),x=st(),B=z(t),{disabledSignInfo:G=!1,disabledPreExecute:R=!1}=e||{},A=E=>{i(E?C=>C+1:C=>C-1)};return(0,L.useEffect)(()=>{a&&d(a)},[a]),(0,L.useEffect)(()=>{s&&S(s)},[s]),(0,L.useEffect)(()=>{(async function(){if(!(G||!t)){A(!0);try{let{data:C={}}=await Me({coinId:t,address:n}),{info:_={}}=C;S(_),T(!1)}catch{T(!0)}finally{A(!1)}}})()},[n,t,G]),(0,L.useEffect)(()=>{(async function(){if(!(R||!t)&&!(!o||!B?.chainId)){A(!0);try{let C=await x({coinId:t,from:n,chainId:B.chainId,simulateTransactionParamList:r.map(({serializedMessage:_})=>({transaction:_,sigVerify:!1,replaceRecentBlockhash:!0}))});d(C.unitLimits),T(!1)}catch{T(!0)}finally{A(!1)}}})()},[...r,o,n,B?.chainId,R,t]),(0,L.useEffect)(()=>{(async function(){if(!(o&&(!l||!p?.length))){A(!0);try{let C=r;o&&(C=await Promise.all(C.map(async(M,q)=>{let{serializedMessage:se,...Q}=M,ce=await Ct(se,l.computeUnitPrice,p[q]);return{...Q,serializedMessage:ce}})));let{totalPriorityFee:_,priorityFees:Y}=await ft(C.map(({serializedMessage:M})=>M));f(_),w(C),y(Y)}finally{A(!1)}}})()},[...r,o,l,p]),{loading:m>0,baseFee:I,totalPriorityFee:g,priorityFees:h,totalFee:v(Fe(I,r.length),g),signInfo:l,estimateFailed:F,replacedTransactions:O}}var Tt=Ht;de();var Xt=({fromAddress:t,coinId:r,preExecuteResult:n,walletId:o,transactions:e,addPriorityFee:a})=>{let{loading:s,preExecuteRet:m}=n,i=m?.[W.TX_ANALYZE]||{},l=(i.simulateTransactionResultList||[]).find(R=>$(R?.unitGasLimit)||xe(R?.unitGasLimit,"0")),S=(0,gt.useMemo)(()=>(i.simulateTransactionResultList||[]).map(R=>R?.unitGasLimit),[i.simulateTransactionResultList]),{loading:p,totalFee:d,baseFee:g,priorityFees:f,estimateFailed:h,signInfo:y,replacedTransactions:F}=Tt({coinId:r,transactions:e||[],address:t,replace:a,unitLimits:S,disabled:{disabledPreExecute:!0}}),T=y?.solRent||"0",I=h||!s&&!!l,O=je(r,o)||{},{coinAmountInt:w}=O,x=$(w)||fe(w,d)||s,B=$(w)||fe(w,v(d,T))||s;return{loading:p,networkFeeProps:{loading:p,networkFee:d,estimateFailed:I,coinId:r},isSufficientGas:x,baseFee:g,priorityFees:f,networkFee:d,estimateFailed:I,estimateFailedMsg:l?.msg,isSufficientBalance:B,selfRent:T,replacedTransactions:F,coinWithBalance:O}},yt=Xt;c();u();var J=N(b()),St=N(Wt());le();function Zt({txId:t,fromAddress:r,coinId:n,walletId:o,feeLoading:e,estimateFailed:a,preExecuteRet:s,chainConfirmDisabled:m=!1,isSufficientGas:i,isSufficientBalance:l,networkFee:S,replacedTransactions:p,onConfirm:d,onCancel:g,transactions:f,coinWithBalance:h={}}){let{isBalanceLoadError:y,isBalanceLoading:F,requestBalance:T}=h,{loading:I=!1,verifyGasLimitRet:O={}}=s,w=!i||!l||He(O),x=e||a||I||Xe(O)||m,{loading:B,onClick:G}=Se(g),R={onClick:G,loading:B,actionType:j.ACTION_TYPE.CANCEL,btnText:U("wallet_dapp_connection_btn_reject")},A=(0,St.useMemoizedFn)(async()=>{await d({serviceCharge:S,replacedTransactions:p,serializedTransactions:f})}),{loading:E,onClick:C}=Se(A),_=(0,J.useMemo)(()=>({disabled:x,loading:E||F,onClick:C,actionType:j.ACTION_TYPE.CONFIRM}),[x,F,E,C]),Y=(0,J.useMemo)(()=>({actionType:j.ACTION_TYPE.FILL_UP,txId:t,coinId:n,walletId:o,address:r}),[r,n,t,i,o]),M=(0,J.useMemo)(()=>({onClick:T,btnText:U("wallet_extension_transfer_error_text_reload"),actionType:j.ACTION_TYPE.CONFIRM}),[T]),q=(0,J.useMemo)(()=>x?_:y&&!F?M:w?Y:_,[x,_,Y,w,y,M,F]);return{buttonGroup:[R,q],handleCancel:g}}var ht=Zt;c();u();var D=N(b());me();le();function jt({coinId:t,fromAddress:r,domain:n,transactions:o=[]}){let e=z(t)||{},a=Ze(),[s,m]=(0,D.useState)(!1),[i,l]=(0,D.useState)({}),S=(0,D.useCallback)(async g=>{try{m(!0);let f=await a({checkTypes:[W.TX_ANALYZE,W.KYS],from:r,chainId:g.chainId,domain:n,coinId:g.coinId,bizLine:6,simulateTransactionParamList:o.map(h=>({transaction:h.serializedMessage,sigVerify:!1,replaceRecentBlockhash:!0}))});l(f)}catch(f){console.log(f)}finally{m(!1)}},[r,n,o.length,a]),p=(0,D.useMemo)(()=>{let g=i?.[W.TX_ANALYZE]||{},f=g.simulateTransactionResultList,h=f?.length;if(Ie(f)&&h>0){if(h===1)return f[0];let y={};if(f.every(T=>!T.result)){y.result=!1,y.msg=U("wallet_extension_transaction_text_thirdparty_contract_failed");let T=f.some(I=>I.addFundsFlag);y.addFundsFlag=T,y.resultCode=T?Ke:""}else y.result=!0,y.msg="",y.addFundsFlag=!1,y.resultCode="";return y}return g},[i]),d=(0,D.useMemo)(()=>({loading:s,...i?.[W.KYS]||{}}),[s,i]);return(0,D.useEffect)(()=>{e.coinId&&S(e)},[S,e.coinId]),{loading:s,kysRet:d,verifyGasLimitRet:p,preExecuteRet:i}}var It=jt;function Jt({txId:t,coinId:r,walletId:n,transactions:o=[],dappInfo:e={},showDappInfo:a=!0,addPriorityFee:s=!0,showSwitchNetwork:m=!0,onConfirm:i,onCancel:l,onAddressCopy:S=Ne,onNetworkChange:p,slot:d={}}){let g=ae(H),f=r||g?.coinId,h=z(f)||{},y=h.localType,F=qe(n),T=ve(y,n),I=(0,V.useMemo)(()=>o.map(K=>{try{if(K.serializedMessage)return K;let ue=Z(K);return{instanceType:ue,serializedMessage:X(K,ue),needToReplaceRecentBlockhash:!K.recentBlockhash}}catch{return null}}).filter(Boolean),[o.length]),O=It({coinId:f,fromAddress:T,domain:e?.host,transactions:I}),{verifyGasLimitRet:w,kysRet:x}=O,{baseFee:B,priorityFees:G,networkFee:R,isSufficientGas:A,networkFeeProps:E,estimateFailed:C,estimateFailedMsg:_,loading:Y,isSufficientBalance:M,selfRent:q,replacedTransactions:se,coinWithBalance:Q}=yt({fromAddress:T,coinId:f,preExecuteResult:O,walletId:n,transactions:I,addPriorityFee:s}),ce=(0,V.useCallback)(()=>!M&&A?{type:Pe.TYPE.warn,message:U("walletextension_toast_text_reserve_rent_exempt",{number:we.div(q,10**h?.decimals)})}:null,[A,M,q,h?.decimals]),Bt=Qe({initialType:F.initialType}),Mt=$e({verifyGasLimitRet:w}),bt=et({baseCoin:h,estimateFailed:C,isSufficientGas:A,verifyGasLimitRet:w,estimateFailedMsg:_,kysRet:x,coinWithBalance:Q},{pre:[Bt,Mt],post:[ce]}),{handleCancel:Dt,buttonGroup:Gt}=ht({txId:t,fromAddress:T,coinId:f,transactions:I,walletId:n,feeLoading:Y,estimateFailed:C,preExecuteRet:O,chainConfirmDisabled:Ye(F.initialType),isSufficientGas:A,isSufficientBalance:M,baseFee:B,priorityFees:G,networkFee:R,replacedTransactions:se,onConfirm:i,onCancel:l,coinWithBalance:Q});return Je({kysRet:x,handleCancel:Dt,coinId:f}),V.default.createElement(ot,{slot:{...d,top:d.top||m&&V.default.createElement(it,{providerType:H,chainName:h?.chainName,onNetworkChange:p})},kysRet:x,dappInfo:e,showDappInfo:a,walletId:n,fromAddress:T,tipMessage:bt,buttonGroup:Gt,networkFee:E,onAddressCopy:S})}var Nt=Jt;c();u();var wt=N(b()),At=N(ne());Ee();function Qt({walletId:t,localType:r,id:n,origin:o}){let e=(0,At.useDispatch)(),a=re(t);return(0,wt.useCallback)(async()=>{a({trade:"contract_interaction",all_confirmation:"cancel",network:r,dapp_url:o}),await e(Ue(n)),await te(e)},[a,n,r,o])}var _t=Qt;c();u();var Ft=N(b()),xt=N(ne());Ee();function $t({coinId:t,id:r,walletId:n,localType:o,origin:e}){let a=(0,xt.useDispatch)(),s=re(n);return(0,Ft.useCallback)(async({replacedTransactions:m,serviceCharge:i})=>{let l={coinId:t,replacedTransactions:m,serviceCharge:i};s({page_type:"contract_interaction",all_confirmation:"confirm",network:o,dapp_url:e}),await a(We(r,l)),await te(a)},[s,o,e])}var Pt=$t;c();u();Ae();function eo(t){let n=ae(H)?.coinId,{coinId:o,showSwitchNetwork:e=!0}=t?.params?.extParams||{};return{coinId:o||n,showSwitchNetwork:e}}var Lt=eo;c();u();var Rt=N(ne());_e();function to({coinId:t,walletId:r,method:n,okxArgs:o,onConfirm:e}){let a=(0,Rt.useDispatch)();return async({replacedTransactions:s,serviceCharge:m,serializedTransactions:i})=>{let p=await a(ie({walletId:r,localType:ee,method:n,params:{message:i,okxArgs:o},extraParams:{coinId:t,replacedTransactions:s,serviceCharge:m}})),d;if(n===k.SIGN_ALL_TRANSACTIONS)d=(p.signedTransactionResults||[]).map(({serializedTransaction:g,type:f})=>ye(g,f));else if(n===k.SIGN_TRANSACTION){let{instanceType:g}=i[0]||{};d=ye(p.serializedTransaction,g)}else n===k.SIGN_AND_SEND_TRANSACTION&&(d=p);return e(d)}}var Et=to;var Ot=t=>{let{id:r,coinId:n,method:o,params:e,walletId:a,origin:s,source:m,dappInfo:i,showDappInfo:l=!0,addPriorityFee:S=!0,showSwitchNetwork:p,onConfirm:d,onCancel:g,onAddressCopy:f,okxArgs:h}=t,{coinId:y,showSwitchNetwork:F}=Lt(t),T=tt(t),I=n||y,w=(z(I)||{}).localType,x=e?.message||[],B=Pt({coinId:I,id:r,walletId:a,localType:w,origin:s}),G=_t({walletId:a,localType:w,id:r,origin:s}),R=nt({walletId:a}),A=Et({coinId:I,walletId:a,method:o,okxArgs:h,onConfirm:d}),E,C,_;return m==="dapp"?(E=B,C=G,_=R):(E=A,C=g,_=f),kt.default.createElement(Nt,{coinId:I,showSwitchNetwork:typeof p=="boolean"?p:F,txId:r,walletId:a,transactions:x,dappInfo:i||T,showDappInfo:l,addPriorityFee:S,onConfirm:E,onCancel:C,onAddressCopy:_})};function oo(t){switch(t.method){case k.SIGN_TRANSACTION:case k.RPC_SIGN_TRANSACTION:case k.SIGN_AND_SEND_TRANSACTION:case k.RPC_SIGN_AND_SEND_TRANSACTION:case k.SIGN_ALL_TRANSACTIONS:case k.RPC_SIGN_ALL_TRANSACTIONS:return he.default.createElement(Ot,{...t});case k.SIGN_MESSAGE:case k.RPC_SIGN_MESSAGE:return he.default.createElement(lt,{...t});default:return""}}var fr=oo;export{ft as a,fr as b};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-OMXSCNTS.js.map
