import{a as Ee}from"./chunk-PZBW56OA.js";import{a as be}from"./chunk-5IZQ5YDG.js";import{b as Te,d as xe}from"./chunk-HQU64EZU.js";import{b as ke}from"./chunk-V22Z2X6F.js";import{a as bt}from"./chunk-NWOIYLOG.js";import{a as ct}from"./chunk-JLHU3WBU.js";import{b as Xt,c as te,d as ee,e as oe,f as re,g as se,l as ae,m as ie,n as ne,o as le}from"./chunk-K77FV23O.js";import{a as xt,b as ge}from"./chunk-O2BGLKEM.js";import{L as Ut,j as X}from"./chunk-NPTEYWCZ.js";import{a as Pe}from"./chunk-HVTBGIF3.js";import{e as we}from"./chunk-R7FTGP7E.js";import{a as fe,b as _e,c as ue,d as de,e as ye}from"./chunk-X4NIGZMX.js";import{a as j}from"./chunk-NZ4SV4UK.js";import{h as Rt}from"./chunk-AVQA7GPY.js";import{a as he}from"./chunk-YFSBCNC7.js";import{l as Yt,m as Ht,n as Gt,o as $t}from"./chunk-OFUXQTAD.js";import{a as it}from"./chunk-NRCRSATA.js";import{b as nt,c as lt}from"./chunk-LANQTZFO.js";import{h as H,i as G}from"./chunk-NZHMCNZN.js";import{C as jt,F as Pt,L as qt,Sa as Jt,a as Y,ga as Qt,x as zt,y as Zt}from"./chunk-4HJMB7P7.js";import{q as A}from"./chunk-U7RD3Z4E.js";import{o as Tt}from"./chunk-XHNZXPBB.js";import{ac as Et,mb as ce,qb as at}from"./chunk-ZTS7374H.js";import{ta as Vt,ya as He}from"./chunk-EY7FXYAJ.js";import{d as K,f as ht}from"./chunk-B26CCOB3.js";import{g as pe}from"./chunk-XJYCT5UP.js";import{a as me}from"./chunk-FT7VATMT.js";import{a as kt}from"./chunk-YYAHGUV5.js";import{c as y}from"./chunk-HBMVMNWX.js";import{Fc as Kt,Lc as Ge,dc as Q,ec as Ke,fc as st,lc as Ot,m as St,n as Lt,o as Bt,q as wt,u as rt,y as gt}from"./chunk-IS2B3ORW.js";import{D as V,H as J,d as Ft,o as Wt,q as Z,r as Dt}from"./chunk-TDPA2BUG.js";import{F as et,pa as Ve}from"./chunk-BJO2AFCW.js";import{M as ot,w as s}from"./chunk-OIAB2YVD.js";import{T as Mt,U as vt,c as Ye,ca as m}from"./chunk-VXVCGVBA.js";import{a as q}from"./chunk-DAL2TMJA.js";import{f as E,m as p,o as f}from"./chunk-JEQEC2HU.js";p();f();var r=E(q()),ut=E(Et()),At=E(kt()),z=E(Tt()),Be=E(Ye());ot();ht();p();f();var R=E(q()),mt=E(Tt());ht();Ke();gt();p();f();var M=E(q());ot();p();f();var $={root:"_root_15akf_1",image:"_image_15akf_4",title:"_title_15akf_7",desc:"_desc_15akf_15",btns:"_btns_15akf_23","cancel-width":"_cancel-width_15akf_26",cancelWidth:"_cancel-width_15akf_26"};function It({type:a,step:o,onCancel:t,onRetry:T}){let w=pe({light:"./static/images/passkey-light-big.png",dark:"./static/images/passkey-dark-big.png"}),e={["create"]:{title:{text:"wallet_extension_biometrics_drawer_title_verification",keys:{num:1,total:2},color:"var(--okd-color-content-primary)"},desc:"wallet_extension_biometrics_drawer_desc_verification",cancel:"commonall_text_btn_cancel",onCancel:t},["verify"]:{title:{text:a==="create"?"wallet_extension_biometrics_drawer_title_verification":"wallet_extension_biometrics_drawer_title_unlock",keys:{num:2,total:2},color:"var(--okd-color-content-primary)"},desc:a==="create"?"wallet_extension_biometrics_drawer_desc_verification":"wallet_extension_biometrics_drawer_desc_unlock",cancel:"commonall_text_btn_cancel",onCancel:t},["error"]:{title:{text:"wallet_extension_biometrics_drawer_title_fail_setup",color:"var(--okd-color-semantic-negative)"},desc:"wallet_extension_biometrics_drawer_desc_fail_setup",confirm:"commonall_emptystate_text_try_again",onConfirm:T,cancel:"commonall_text_btn_cancel",onCancel:t},["init"]:null,["success"]:null}[o];return e?M.default.createElement(y.Container,{className:$.root},M.default.createElement(y.FlexBox,{className:$.image,align:y.ALIGN.center,justify:"center"},M.default.createElement(Ft,{src:w,width:120,height:120})),M.default.createElement(A.Text,{strong:700,className:$.title,style:{color:e.title.color}},s(e.title.text,e.title.keys)),M.default.createElement(A.Text,{strong:400,className:$.desc},s(e.desc)),M.default.createElement(y.FlexBox,{className:$.btns,align:y.ALIGN.center,justify:"center"},M.default.createElement(m,{block:e.confirm,category:m.CATEGORY.fill,type:m.TYPE.gray,size:m.SIZE.lg,onClick:()=>{e.onCancel()},className:we({[$.cancelWidth]:!e.confirm})},s(e.cancel)),e.confirm?M.default.createElement(m,{block:!0,category:m.CATEGORY.fill,type:m.TYPE.highlight,size:m.SIZE.lg,onClick:()=>{e.onConfirm()}},s(e.confirm)):null)):null}function Ct(){let[a]=lt(nt.credentialId),[o,t]=(0,R.useState)("init"),[T,w]=(0,R.useState)("init"),l=(0,R.useRef)(null),e=(0,R.useRef)(u=>u),h=async u=>{try{w("create"),t("create"),e.current=u,await bt(500);let{password:C,credential:v,credentialId:N}=await ue();if(t("verify"),!await de({credential:v,password:C})){t("error"),await u(null);return}l.current?.destroy(),t("success"),await u({password:C,credentialId:N})}catch{t("error"),await u(null)}},x=async u=>{try{w("verify"),t("verify"),e.current=u;let{password:C}=await ye(a);await K().verifyPassword(C),l.current?.destroy(),t("success"),await u(!!C)}catch{t("error"),await u(!1)}},b=()=>{t("init"),w("init"),l.current?.destroy()},I=()=>{T==="create"&&h(e.current),T==="verify"&&x(e.current)},c=async()=>{Q()!==rt&&(l.current||(l.current=Wt.action({mask:!1})),await bt(100),l.current.update({visible:!0,mask:!0,onClose:()=>{b()},children:R.default.createElement(It,{step:o,type:T,onRetry:()=>{I()},onCancel:()=>{b()}})}))};return(0,mt.useUpdateEffect)(()=>{if(o==="init"||o==="success"){l.current?.destroy();return}c()},[o]),(0,mt.useUnmount)(()=>{l.current?.destroy()}),{create:h,verify:x}}Ot();gt();p();f();var _=E(q()),ft=E(Tt());ot();p();f();var pt={root:"_root_cl85f_1",passwordInput:"_passwordInput_cl85f_6"};var Ie=({onBack:a,onComplete:o})=>{let w=ct().get("from")===g.HARDWARE,l=V.useForm(),[e,h]=(0,_.useState)({}),[x,{setTrue:b,setFalse:I}]=(0,ft.useBoolean)(!1),c=!e.password||!e.confirm||e.password?.length<xt||e.confirm?.length<xt||e.password!==e.confirm,u=(0,ft.useMemoizedFn)(async()=>{let{password:N,confirm:S}=e;if(!(x||c)){if(N!==S){l.setErrors({confirm:s("wallet_settings_reset_passord_errortip_input_error")});return}Ut(),b(),await o(S),I()}},[c,e]),C=(0,_.useCallback)(async N=>{(N?.key==="Enter"||N?.keyCode===13)&&await u()},[]),v=Ee();return(0,_.useEffect)(()=>(document.addEventListener("keydown",C),()=>{document.removeEventListener("keydown",C)}),[]),_.default.createElement(ke,{className:pt.root,title:s("wallet_signup_maintitle_set_password"),desc:s(w?"wallet_extension_signup_subtitle_set_password_hardware":"wallet_extension_subtitle_password_unlock"),onBack:a},({formClass:N,formErrorClass:S,itemClass:U})=>_.default.createElement(V,{form:l,size:Z.SIZE.lg,validateTrigger:["onChange","onBlur"],className:N,errorClassName:S,onSubmit:u,onValuesChange:(L,B)=>{h(B)}},_.default.createElement(V.Item,{name:"password",style:{marginBottom:0},className:U,label:s("wallet_set_password_subtitle_password")},_.default.createElement(Z.Password,{autoComplete:"off",size:Z.SIZE.xl,inputClassName:pt.passwordInput,placeholder:s("wallet_settings_reset_passord_placeholder_input_desc")})),_.default.createElement(V.Item,{noStyle:!0,shouldUpdate:(L,B)=>L.password!==B.password},({getFieldValue:L})=>{let B=L("password");return _.default.createElement(ge,{password:B})}),_.default.createElement(V.Item,{name:"confirm",className:U,label:s("wallet_settings_reset_passord_subtitle_password_confirmation"),style:{flex:1,marginTop:"32px"}},_.default.createElement(Z.Password,{autoComplete:"off",size:Z.SIZE.xl,inputClassName:pt.passwordInput,placeholder:s("wallet_settings_reset_passord_placeholder_input_password_confirmation"),onChange:()=>{l.cleanErrors("confirm")}})),_.default.createElement(it.FooterActions,{usePortal:!0,affixStyle:v},_.default.createElement(V.Item,{noStyle:!0},_.default.createElement(m,{block:!0,htmlType:"submit",loading:x,disabled:c,category:m.CATEGORY.fill,type:m.TYPE.highlight,size:m.SIZE.lg},s("wallet_set_password_btn_confirm"))))))};p();f();var Nt=E(Et());var Ce=E(kt());function Ne(){let a=(0,Ce.useHistory)(),o=(0,Nt.useSelector)(at),t=(0,Nt.useSelector)(ce);o&&!t&&a.replace(Y)}p();f();var k={root:"_root_1ybp2_1",content:"_content_1ybp2_4",title:"_title_1ybp2_7",desc:"_desc_1ybp2_15",list:"_list_1ybp2_22",item:"_item_1ybp2_25","item-select":"_item-select_1ybp2_42",itemSelect:"_item-select_1ybp2_42","item-title":"_item-title_1ybp2_45",itemTitle:"_item-title_1ybp2_45","item-desc":"_item-desc_1ybp2_53",itemDesc:"_item-desc_1ybp2_53",link:"_link_1ybp2_60",anchor:"_anchor_1ybp2_64",icon:"_icon_1ybp2_65",forgot:"_forgot_1ybp2_78"};p();f();var Ae=E(q()),_t=E(Et()),Se=E(kt());Ve();ot();ht();Ot();gt();Ge();He();var Le=a=>{let o=(0,Se.useHistory)(),t=(0,_t.useDispatch)(),{seedPhrase:T,privateKey:w,mpcInfo:l,unlockHardwareWallets:e,chooseNetworkList:h,isTonMnemonic:x}=(0,_t.useSelector)(n=>({seedPhrase:Xt(n),isTonMnemonic:se(n),privateKey:te(n),chooseNetworkList:re(n),mpcInfo:oe(n),unlockHardwareWallets:ee(n)})),{setValue:b}=xe(),{value:I}=Te();(a===g.SEED&&!T||a===g.KEY&&!w||a===g.BULK&&!I||a===g.MPC&&(!l||et(l))||a===g.HARDWARE&&(!e||et(e)))&&o.push(Y);let c=n=>{let P=`${Pt}/${a}`,{keyringName:d="",walletName:F=""}=n||{},W=`${d}-${F}`;o.push({pathname:P,state:{walletName:W,anim:"1",next:Y}})},u=async n=>{await t(Yt(n)),await t(j()),o.push({pathname:Qt,search:`?type=${Kt.INITIALIZE}`,state:{hasPassword:!0}})},C=async n=>{let P=T?.trim().toLowerCase().match(/\w+/gu)?.join(" ")||"",d=await t(Ht(n,P,{isTonMnemonic:x}));t(ae()),await t(j()),c(d)},v=async n=>{let P=await t(Gt(n,h,w));t(ie()),await t(j()),c(P)},N=n=>{b(n),o.push(Jt)},S=async(n,P)=>{et(e)||(await K().setPassword(n),await t(H(P?2:1)),await t(G(P)),await t(be(e)),await t(j()),t(ne()));let d=`${Pt}/${g.HARDWARE}`;st()===Bt&&globalThis.platform.openExtensionInPopup(`${d}?anim=1`)},U=async n=>{let{cipherText:P,privateKey:d,mpcId:F,userInfo:W}=l;if(P&&d&&F){let dt=await t($t(n,{cipherText:P,privateKey:d},{mpcId:F,userInfo:W},!0));t(le()),await t(j()),c(dt)}},L={[g.CREATE]:u,[g.SEED]:C,[g.KEY]:v,[g.BULK]:N,[g.HARDWARE]:S,[g.MPC]:U};return(0,Ae.useCallback)(async(n,P)=>{try{await L[a](n,P)}catch(d){let F=s("wallet_extension_toast_text_unknown_error");d.message===Vt&&(F=s("wallet_home_toast_network_error")),J.error(d.message?d.message:JSON.stringify(d))}},[a])};var g={SEED:"seed",KEY:"key",HARDWARE:"hardware",CREATE:"create",MPC:"mpc",BULK:"bulk"},ze=()=>{let a=(0,At.useHistory)(),o=st(),t=o===St||o===wt,T=o===Lt,w=o===wt;return{openNotification:()=>{let{pathname:h,search:x}=a.location,b=x?"&":"?",I="openFromThisPage=1";globalThis.platform.openExtensionInPopup(`${h}${x}${b}${I}`,null,!w)},closeNotification:()=>{window.close()},needOpenNotification:t,isNotification:T}};function Ze(){let a=(0,At.useHistory)(),o=(0,ut.useDispatch)(),{needOpenNotification:t,isNotification:T,openNotification:w,closeNotification:l}=ze(),e=()=>{t?a.goBack():a.push(Y)},[h]=lt(nt.passwordType),[x,b]=(0,r.useState)(2),I=(0,r.useMemo)(()=>Q()===rt?"telegram":"extension",[Q]);(0,z.useMount)(async()=>{await _e(h)||b(1)});let c=(0,ut.useSelector)(at);Ne();let[u,C]=(0,r.useState)(!1);(0,z.useAsyncEffect)(async()=>{try{if(await fe(h))return;let O=c?qt:jt;a.replace({pathname:O,search:a.location.search})}finally{C(!0)}},[]);let v=ct(),N=v.get("from")||g.CREATE,S=Le(N),U=v.get("openFromThisPage")==="1",L=i=>c?h===i:x===i,{create:B,verify:n}=Ct(),[P,{toggle:d}]=(0,z.useToggle)(!1),[F,{toggle:W}]=(0,z.useToggle)(!1),dt=async()=>{if(t){w();return}await B(async i=>{if(i){let{password:O,credentialId:tt}=i;await S(O,tt),await o(H(2)),await o(G(tt)),X({button_name:"biometric",platform:I})}})},Oe=async()=>{W()},Me=async()=>{d(),await B(async i=>{if(i){let{password:O,credentialId:tt}=i;await K().modifyPassword(O)&&(J.success(s("wallet_edit_wallet_toast_renamed_success")),await o(H(2)),await o(G(tt)),X({button_name:"biometric",platform:I}),T&&U&&l())}})},ve=async i=>{W(),await K().modifyPassword(i)&&(J.success(s("wallet_edit_wallet_toast_renamed_success")),await o(H(1)),await o(G(void 0)),X({button_name:"password",platform:I}),T&&U&&l())},Fe=()=>{if(!c){b(2);return}if(c&&h===2){a.goBack();return}if(t){w();return}d()},We=async()=>{if(!c){b(1);return}if(c&&h===1){a.goBack();return}if(t){w();return}await n(i=>{i&&W()})},[De,yt]=(0,r.useState)(!1),Re=async()=>{try{yt(!0),x===2?await dt():await Oe()}catch{yt(!1)}finally{yt(!1)}},Ue=[{type:2,title:"wallet_extension_biometrics_radio_title_authentication",desc:"wallet_extension_biometrics_radio_desc_authentication",onClick:Fe},{type:1,title:"wallet_extension_biometrics_radio_title_password",desc:"wallet_extension_biometrics_radio_desc_password",onClick:We,link:c&&h===1?{url:Zt,text:"wallet_extension_biometrics_btn_change_password"}:null}];return u?P?r.default.createElement(Pe,{onBack:d,callback:Me}):F?r.default.createElement(Ie,{onBack:W,onComplete:async i=>{c?await ve(i):(await S(i),await o(H(1)),await o(G(void 0)),X({button_name:"password",platform:I}))}}):r.default.createElement(y.Box,{className:k.root},r.default.createElement(he,{bordered:!1,closeable:!1,onBack:e}),r.default.createElement(y.Container,{className:k.content},r.default.createElement(A.Text,{className:k.title},s("wallet_extension_biometrics_header_title_unlock")),r.default.createElement(A.Text,{className:k.desc},s("wallet_extension_biometrics_desc_unlock")),r.default.createElement(y.Box,{className:k.list},Ue.map(i=>r.default.createElement(y.FlexBox,{className:(0,Be.default)(k.item,{[k.itemSelect]:L(i.type)}),direction:y.DIRECTION.horizontal,align:y.ALIGN.center,justify:"space-between",onClick:()=>{i.onClick()}},r.default.createElement(y.Box,{className:k.itemContent},r.default.createElement(A.Text,{className:k.itemTitle},s(i.title)),r.default.createElement(A.Text,{className:k.itemDesc},s(i.desc)),i.link?r.default.createElement(y.FlexBox,{className:k.link,direction:y.DIRECTION.horizontal,align:y.ALIGN.center},r.default.createElement(vt,{alt:s(i.link.text),rel:"nofollow",onClick:O=>{O.stopPropagation(),O.preventDefault(),Rt(),a.push(i.link.url)},className:k.anchor},s(i.link.text)),r.default.createElement(Mt,{iconName:"okds-arrow-chevron-right-centered-md",className:k.icon})):null),L(i.type)?r.default.createElement(Dt.Circle,{checked:!0}):null))),r.default.createElement(it.FooterActions,null,c?r.default.createElement(r.default.Fragment,null,r.default.createElement(me,{to:zt,className:k.forgot},r.default.createElement(A.Text,{strong:!0,size:A.SIZE.sm,type:A.TYPE.secondary},s("wallet_footer_subtitle_forgot_password")))):r.default.createElement(m,{block:!0,category:m.CATEGORY.fill,type:m.TYPE.highlight,size:m.SIZE.lg,loading:De,onClick:()=>{Re()}},s("commonall_button_text_next"))))):null}export{g as a,Ze as b};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=chunk-SGYOI5IA.js.map
