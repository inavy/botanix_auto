import{a as pe,b as ge}from"./chunk-O7QCW5DJ.js";import{a as ue,b as de}from"./chunk-YN5DFOQA.js";import{a as le}from"./chunk-3FFSKRM6.js";import{a as me}from"./chunk-BSTZKYKS.js";import"./chunk-74FDEN4I.js";import{a as ce}from"./chunk-BWEVT6TQ.js";import"./chunk-34U7HVOO.js";import"./chunk-O2ZAUKTP.js";import{a as fe}from"./chunk-YUU6WMAM.js";import"./chunk-URHEQFFQ.js";import"./chunk-QEKVDPIG.js";import{a as ie}from"./chunk-WJYVGS4V.js";import{a as ae}from"./chunk-CSJR56CD.js";import"./chunk-YC3K6KSF.js";import"./chunk-5VYKPDIW.js";import{a as U}from"./chunk-T4SJQSS7.js";import{a as ne}from"./chunk-XWRXEU7I.js";import"./chunk-3V4N3SLP.js";import"./chunk-CHH4UZQE.js";import"./chunk-JTVJ673F.js";import"./chunk-MIZXVXK6.js";import"./chunk-GNBB55K5.js";import"./chunk-EC67JB7S.js";import"./chunk-WINPS5JO.js";import"./chunk-GANFA4Y3.js";import{a as se}from"./chunk-BNPYGBEA.js";import"./chunk-75JFJJ6E.js";import"./chunk-WOF2MG5G.js";import"./chunk-6QV7GAE5.js";import"./chunk-QT2MBFKK.js";import{d as J}from"./chunk-MUF5KFVU.js";import"./chunk-BSWNOA7X.js";import"./chunk-NWOIYLOG.js";import"./chunk-JLHU3WBU.js";import{a as R}from"./chunk-RV4CTONM.js";import"./chunk-WPUSOCZ5.js";import"./chunk-6NFIXY6G.js";import"./chunk-IGLJY5RQ.js";import"./chunk-BOYKE4FM.js";import"./chunk-UF32D7MW.js";import"./chunk-CR7XMKUK.js";import"./chunk-SSZF4QIS.js";import"./chunk-M24SOKF4.js";import"./chunk-SSTSMCPU.js";import"./chunk-LF7H3MNC.js";import"./chunk-KCCATSGJ.js";import"./chunk-BQUWM53Y.js";import"./chunk-XEXJRJUY.js";import"./chunk-3DNJNRLL.js";import"./chunk-FPIWIEGC.js";import{f as oe}from"./chunk-3MOQA4IF.js";import"./chunk-2I7TRLZ4.js";import"./chunk-5D6FMALX.js";import"./chunk-WNBXIYVP.js";import"./chunk-25SZ52UW.js";import"./chunk-3VDT32YX.js";import"./chunk-RNBNCNHM.js";import"./chunk-ZUBJ4HSQ.js";import"./chunk-NRDSUSOX.js";import"./chunk-OLBL2ESK.js";import"./chunk-WFHUBXJH.js";import"./chunk-YL2OEBEM.js";import"./chunk-UBREW6HU.js";import"./chunk-33LBA2KN.js";import"./chunk-NPTEYWCZ.js";import"./chunk-BYUE2OWP.js";import"./chunk-PCTAUYQN.js";import"./chunk-ZW25VTKR.js";import"./chunk-OZL64JKT.js";import"./chunk-SF4X4VPT.js";import"./chunk-EUVFIXQT.js";import"./chunk-WJQMDYRJ.js";import"./chunk-OANAR4PZ.js";import"./chunk-DY3DHSF2.js";import"./chunk-LZKLGZM5.js";import"./chunk-DM55GZK5.js";import"./chunk-OVX2PTCV.js";import"./chunk-Y57SQLFF.js";import"./chunk-C6D3UGMF.js";import"./chunk-VHMLJAAA.js";import"./chunk-DS7KEGTF.js";import"./chunk-GWV4SS46.js";import"./chunk-YFSBCNC7.js";import"./chunk-OFUXQTAD.js";import"./chunk-AJGKE3VO.js";import"./chunk-NRCRSATA.js";import"./chunk-LANQTZFO.js";import"./chunk-NZHMCNZN.js";import"./chunk-CBDQQ72I.js";import"./chunk-4HJMB7P7.js";import"./chunk-A2W6OJDL.js";import"./chunk-U7RD3Z4E.js";import"./chunk-CJVER5MJ.js";import"./chunk-S5IEFQ34.js";import{o as Le}from"./chunk-XHNZXPBB.js";import{Ea as te,Fa as re,ac as Ge}from"./chunk-ZTS7374H.js";import"./chunk-QXE433GW.js";import{Na as ee,Ra as ve}from"./chunk-EY7FXYAJ.js";import{d as $,f as De}from"./chunk-B26CCOB3.js";import"./chunk-D2RJYC6D.js";import"./chunk-VMA4KAKW.js";import"./chunk-XJYCT5UP.js";import"./chunk-XIAMW27T.js";import{Z as L}from"./chunk-QYHQY2ME.js";import"./chunk-FT7VATMT.js";import"./chunk-YYAHGUV5.js";import"./chunk-QJGSL63Z.js";import"./chunk-7ZE3XWQE.js";import"./chunk-42AETIVN.js";import"./chunk-DKCCIZ3Q.js";import"./chunk-C77R5D6K.js";import"./chunk-HBMVMNWX.js";import{Lb as Q,Na as M,Xa as z,cc as Re}from"./chunk-IS2B3ORW.js";import"./chunk-YGSCKFAL.js";import{H as j}from"./chunk-TDPA2BUG.js";import{K,pa as he}from"./chunk-BJO2AFCW.js";import{M as Y,w as u}from"./chunk-OIAB2YVD.js";import"./chunk-QHMZGTYF.js";import"./chunk-X5EUMZZI.js";import"./chunk-PJSODKKF.js";import"./chunk-VXVCGVBA.js";import"./chunk-G6JM4G2M.js";import{a as G}from"./chunk-DAL2TMJA.js";import"./chunk-IEDGM2AY.js";import"./chunk-DAX5D55P.js";import"./chunk-UAZMAR7J.js";import"./chunk-BQF3XODK.js";import"./chunk-I5RKKMWZ.js";import"./chunk-4LMFSJNF.js";import"./chunk-VNO3IDCT.js";import"./chunk-P5TEJB3G.js";import"./chunk-AXAVBTOG.js";import"./chunk-SEHRB2F7.js";import"./chunk-IH7OWVTK.js";import"./chunk-RF2WJL7B.js";import"./chunk-K5MXWGTT.js";import"./chunk-OTDALOBJ.js";import"./chunk-JCKY6H7C.js";import"./chunk-6AWMYHRK.js";import"./chunk-5VBNU5MN.js";import{f as k,m as f,o as l}from"./chunk-JEQEC2HU.js";f();l();var Fe=k(G());f();l();var E=k(G()),Se=k(Ge());Y();De();ve();z();f();l();var I=k(G());he();Y();Re();var Ne=({code:e,data:n,error_message:s,error:a})=>{if(e!==0||!n||n.queryGasLimitErrorUseDefault||a)return{fee:0,feeError:!0,feeErrorMsg:s};let{gasLimit:r="0"}=n;return{...n,fee:r,feeError:!1,feeErrorMsg:""}},Be=e=>e?.feeError&&e?.feeErrorMsg?u("wallet_extension_alert_estimate_unavailable_error",{errorMsg:e.feeErrorMsg}):"",be=(e,n)=>{let s=K(e)||Q(e,n),a=K(e)||Q(e,0);return{isSufficientGas:s,isSufficientBalance:a}},Oe=({coinId:e,unapproved:n,paramsInfo:s})=>{let{coin:a,toAdr:r,fromAddr:t,walletId:i,messages:o,network:c,validUntil:d}=s,{chainId:T,localType:m}=a||{},p=ie(e,n.walletId)||{},{coinAmountInt:S}=p,h=U(),A=(0,I.useRef)(null),[C,x]=(0,I.useState)(!0),[g,F]=(0,I.useState)({}),[_,B]=(0,I.useState)({});(0,I.useEffect)(()=>{m&&e&&t&&i&&o&&(async()=>{try{x(!0);let w=await h({coinId:e,address:t,toAddr:r,fromAddr:t}),y=await pe({nonce:w?.nonce,localType:m,fromAddr:t,walletId:i,messages:o,network:c,validUntil:d});B({signInfo:w,sequence:w?.nonce,inputData:JSON.stringify(y?.stringInputParams),transactionParams:y?.transactionParams})}catch(w){x(!1),F({feeError:!0,feeErrorMsg:w?.message||u("wallet_extension_alert_estimate_unavailable_error")})}})()},[m,e,t,i,o]),(0,I.useEffect)(()=>((()=>{let{inputData:w}=_;if(x(!0),w){let y=async()=>{let O=await ge({fromAddr:t,chainId:T,coinId:e,inputData:w}),q=Ne(O);x(!1),F(q)};(()=>{clearInterval(A.current),y(),A.current=setInterval(y,7e3)})()}})(),()=>{clearInterval(A.current)}),[_.inputData,T,t,e]);let{isSufficientGas:b,isSufficientBalance:V}=be(S,g?.fee),D=Be(g);return{networkFeeProps:{coinId:e,loading:C,estimateFailed:g?.feeError,estimateFailedMsg:D,networkFee:g?.fee},isSufficientGas:b,isSufficientBalance:V,estimateFailed:g?.feeError,estimateFailedMsg:D,extParams:{coinId:e,coinAmount:0,inputData:_?.inputData,fromAdr:t,toAdr:r,serviceCharge:g?.fee,extJson:JSON.stringify({nonce:_?.sequence}),txSource:2,accountId:n?.walletId,walletType:2,transactionParams:_?.transactionParams},coinWithBalance:p}},_e=Oe;f();l();z();function We(e){let n=J(M)||{},{address:s,walletId:a}=R(e),r=e?.params?.transaction||{},t=r?.messages||[],i=r?.network,o=r?.valid_until,{address:c}=t[0]||{};return{toAdr:c,coin:n,fromAddr:s,walletId:a,messages:t,validUntil:o,network:i}}var we=We;f();l();var P=k(G());var Je=({origin:e,walletId:n,localType:s})=>{let a=ne(),[r,t]=(0,P.useState)(!0),{host:i}=fe({origin:e}),o=R({walletId:n,localType:s}),[c,d]=(0,P.useState)({}),T=(0,P.useCallback)(async(S,h,A)=>{let C="";try{C=JSON.stringify(A)}catch{}let{coinId:x,chainId:g}=S,F=await a({coinId:x,checkTypes:[L.KYS,L.VERIFY_GAS_LIMIT],amount:0,from:o.address,to:"",txType:3,domain:i,tokenAddress:"",inputData:h,chainId:g,additionalData:{tonSignData:C}});d(F),t(!1)},[i,a,o.address]),m=(0,P.useMemo)(()=>({loading:r,...c[L.KYS]||{}}),[r,c]),p=(0,P.useMemo)(()=>c[L.VERIFY_GAS_LIMIT]||{},[c]);return{kysRet:m,loading:r,preExecute:T,preExecuteRet:c,verifyGasLimitRet:p}},Ee=Je;f();l();var xe=k(G()),Ie=k(Le());Y();z();function Ue({transaction:e,fromAddress:n}){let{valid_until:s,network:a,from:r,messages:t}=e,[i,o]=(0,xe.useState)("");return(0,Ie.useAsyncEffect)(async()=>{if(a!==te.MAINNET)o(u("wallet_extension_error_incorrect_destination_network"));else if(s<Math.floor(Date.now()/1e3))o(u("wallet_extension_error_expired_transaction"));else if(!t||t.length===0)o(u("wallet_extension_error_invalid_transaction_parameter"));else{let{TonWallet:c}=await oe(),d=new c;for(let p=0;p<t.length;p++){let S=t[p]?.address;if(!await se(S,M)){o(u("wallet_extension_error_incorrect_destination_network"));return}}let T=await d.convertAddress({address:n}),m=await d.convertAddress({address:r});T?.raw!==m?.raw&&o(u("wallet_extension_error_incorrect_receiving_address"))}},[s,a,r,n]),{checkParamsTipMessage:i?{message:i}:null,code:i?re.BAD_REQUEST_ERROR:null}}var Te=Ue;var Ve=(0,E.memo)(({unapproved:e})=>{let n=(0,Se.useDispatch)(),s=J(M)||{},a=s?.coinId||M,{walletId:r,address:t}=R(e),i=ae(r),o=we(e),[c,d]=(0,E.useState)(!1),T=U(),{networkFeeProps:m,isSufficientGas:p,estimateFailed:S,estimateFailedMsg:h,isSufficientBalance:A,extParams:C,coinWithBalance:x}=_e({coinId:a,unapproved:e,paramsInfo:o}),{id:g,origin:F,localType:_}=e,B=Ee({origin:F,walletId:r,localType:_}),{inputData:b,transactionParams:V}=C,D=(0,E.useRef)(),{preExecute:H,kysRet:v,verifyGasLimitRet:w}=B,y=e?.params?.transaction||{};(0,E.useEffect)(()=>{s?.coinId&&!m?.loading&&!D.current&&(D.current=!0,H(s,b,y))},[s?.coinId,m?.loading,b]);let X=me({kysRet:v,baseCoin:s,estimateFailed:S,estimateFailedMsg:h,isSufficientGas:p,isSufficientBalance:A,verifyGasLimitRet:w,coinWithBalance:x}),{checkParamsTipMessage:O,code:q}=Te({transaction:y,fromAddress:t}),ye=ue({id:g,walletId:r,origin:F,localType:_,extraParams:{code:q}}),Pe=O||X,Ce=async()=>{d(!0),i({trade:"contract_interaction",all_confirmation:"confirm",network:_,dapp_url:F});try{let W=await T({coinId:a,address:o?.fromAddr,toAddr:o?.toAdr,fromAddr:o?.fromAddr}),Z=await $().approveDappRequest(g,{...C,transactionParams:{...V,seqno:W?.nonce},extJson:JSON.stringify({nonce:W?.nonce})});if(Z.code===10009){j.error(Z?.msg||u("wallet_extension_failure_subtitle_fail_resend")),d(!1);return}await ee(n),d(!1)}catch(W){d(!1),j.error(W?.msg||u("wallet_extension_failure_subtitle_fail_resend"))}},{buttonGroup:ke,handleCancel:Me}=de({coinId:a,unapproved:e,preExecuteRet:B,feeLoading:m?.loading||c,estimateFailed:S,isSufficientGas:p,isSufficientBalance:A,disabledConfirmBtn:!!O,onConfirm:Ce,onCancel:ye,coinWithBalance:x});return ce({kysRet:v,handleCancel:Me}),E.default.createElement(le,{kysRet:v,unapproved:e,tipMessage:Pe,buttonGroup:ke,networkFee:m})}),Ae=Ve;var Vt=({unapproved:e})=>Fe.default.createElement(Ae,{unapproved:e});export{Vt as default};

window.inOKXExtension = true;
window.inMiniApp = false;
window.ASSETS_BUILD_TYPE = "publish";

//# sourceMappingURL=Ton-X4MJLGEJ.js.map
